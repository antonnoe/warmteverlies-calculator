<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Energie- & Kostencalculator Frankrijk | InfoFrankrijk.com</title>
  <!-- Preview-safe: pure HTML + vanilla JS, geen Babel/TSX nodig -->
  <!-- Belangrijk: geen 'defer' zodat Tailwind direct styled rendert -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --brand-color: #800000; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background:#f9fafb; }
    .tooltip { position: relative; display: inline-flex; }
    .tooltip .tooltip-text { visibility: hidden; width: 260px; background:#333; color:#fff; text-align:left; border-radius:6px; padding:8px; position:absolute; z-index:10; bottom:125%; left:50%; margin-left:-130px; opacity:0; transition:opacity .2s; font-weight:400; }
    .tooltip:hover .tooltip-text { visibility: visible; opacity: 1; }
    .btn { background: var(--brand-color); color: #fff; border-radius:.5rem; padding:.5rem 1rem; border:0; cursor:pointer; }
    #fab-cost { position: fixed; right: 16px; bottom: 16px; z-index: 60; }
    @media print { body * { visibility: hidden; } #pdf-summary, #pdf-summary * { visibility: visible; } #pdf-summary { position:absolute; left:0; top:0; width:100%; padding:1rem; } .no-print{ display:none !important; } }
  </style>
</head>
<body class="pb-28">
  <header class="bg-white border-b border-gray-200 p-4 no-print">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
      <div>
        <h1 class="text-2xl font-bold text-[var(--brand-color)]">Energie- & Kostencalculator Frankrijk</h1>
        <p class="text-gray-600">Een compleet model voor uw woning: van isolatie tot zonnepanelen.</p>
      </div>
      <button class="btn" onclick="window.print()">Download / Print Samenvatting</button>
    </div>
  </header>

  <main class="max-w-7xl mx-auto p-4 grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2 space-y-4">
      <!-- 1. Klimaat & Woning -->
      <section class="bg-white border border-gray-200 rounded-xl shadow-sm no-print">
        <div class="w-full flex items-center justify-between p-4">
          <div class="flex items-center gap-4">
            <div class="w-8 h-8 flex items-center justify-center bg-gray-100 rounded-full text-[var(--brand-color)]">üè†</div>
            <span class="font-semibold text-lg text-gray-800">1. Klimaat & Woning</span>
          </div>
        </div>
        <div class="p-4 pt-0">
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Klimaatzone</label>
              <select id="zone" class="w-full p-2 border-gray-300 border rounded-md text-sm"></select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Binnen temperatuur</label>
              <div class="flex"><input id="setpoint" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="20"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">¬∞C</span></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Verwarmd volume</label>
              <div class="flex"><input id="volume" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="250"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">m¬≥</span></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Luchtwisseling (n)</label>
              <div class="flex"><input id="ach" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="0.5"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">1/uur</span></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Ventilatie</label>
              <select id="ventType" class="w-full p-2 border-gray-300 border rounded-md text-sm">
                <option value="natural">Natuurlijk</option>
                <option value="mech">Mechanisch</option>
                <option value="hrv">WTW/HRV</option>
              </select>
            </div>
            <div id="hrvWrap" class="hidden">
              <label class="block text-sm font-medium text-gray-700 mb-1">HRV rendement</label>
              <div class="flex"><input id="hrvEta" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="0.75"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">Œ∑</span></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Aanwezigheidsdagen/jaar</label>
              <input id="presentDays" class="w-full p-2 border-gray-300 border rounded-md text-sm" value="260">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Afwezig-setpoint</label>
              <div class="flex"><input id="awaySetpoint" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="12"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">¬∞C</span></div>
            </div>
          </div>

          <div class="mt-4 p-4 bg-gray-50 rounded-lg border">
            <h3 class="text-md font-semibold mb-3">Isolatie (Oppervlakte & U-waarde)</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
              <!-- Muur -->
              <div>
                <div class="grid grid-cols-2 gap-2">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Muur (A)</label>
                    <div class="flex"><input id="wallA" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="120"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">m¬≤</span></div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">U-waarde</label>
                    <div class="flex"><input id="wallU" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="0.5"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">U</span></div>
                  </div>
                </div>
                <div id="wallPresets" class="flex flex-wrap gap-1 mt-2"></div>
              </div>
              <!-- Dak -->
              <div>
                <div class="grid grid-cols-2 gap-2">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Dak (A)</label>
                    <div class="flex"><input id="roofA" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="100"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">m¬≤</span></div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">U-waarde</label>
                    <div class="flex"><input id="roofU" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="0.25"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">U</span></div>
                  </div>
                </div>
                <div id="roofPresets" class="flex flex-wrap gap-1 mt-2"></div>
              </div>
              <!-- Vloer -->
              <div>
                <div class="grid grid-cols-2 gap-2">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Vloer (A)</label>
                    <div class="flex"><input id="floorA" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="100"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">m¬≤</span></div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">U-waarde</label>
                    <div class="flex"><input id="floorU" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="0.35"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">U</span></div>
                  </div>
                </div>
                <div id="floorPresets" class="flex flex-wrap gap-1 mt-2"></div>
              </div>
              <!-- Ramen -->
              <div>
                <div class="grid grid-cols-2 gap-2">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Ramen (A)</label>
                    <div class="flex"><input id="winA" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="20"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">m¬≤</span></div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">U-waarde</label>
                    <div class="flex"><input id="winU" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="1.6"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">U</span></div>
                  </div>
                </div>
                <div id="winPresets" class="flex flex-wrap gap-1 mt-2"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 2. Verwarming & Tapwater -->
      <section class="bg-white border border-gray-200 rounded-xl shadow-sm no-print">
        <div class="w-full flex items-center justify-between p-4">
          <div class="flex items-center gap-4">
            <div class="w-8 h-8 flex items-center justify-center bg-gray-100 rounded-full text-[var(--brand-color)]">üî•</div>
            <span class="font-semibold text-lg text-gray-800">2. Verwarming & Tapwater</span>
          </div>
        </div>
        <div class="p-4 pt-0 grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 class="font-semibold mb-2">Ruimteverwarming</h3>
            <div class="space-y-3">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Hoofdverwarming</label>
                <select id="mainType" class="w-full p-2 border-gray-300 border rounded-md text-sm"></select>
              </div>
              <div id="mainScopWrap" class="hidden">
                <label class="block text-sm font-medium text-gray-700 mb-1">SCOP Hoofd-WP</label>
                <input id="mainScop" class="w-full p-2 border-gray-300 border rounded-md text-sm" value="3.2">
              </div>
              <div id="mainEtaWrap" class="hidden">
                <label class="block text-sm font-medium text-gray-700 mb-1">Rendement Œ∑ Hoofd</label>
                <input id="mainEta" class="w-full p-2 border-gray-300 border rounded-md text-sm" value="0.9">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Bijverwarming</label>
                <select id="auxType" class="w-full p-2 border-gray-300 border rounded-md text-sm"></select>
              </div>
              <div id="auxShareWrap" class="hidden">
                <label class="block text-sm font-medium text-gray-700 mb-1">Aandeel bijverwarming</label>
                <select id="auxSharePreset" class="w-full p-2 border-gray-300 border rounded-md text-sm">
                  <option value="10">Incidenteel (~10%)</option>
                  <option value="25">Regelmatig (~25%)</option>
                  <option value="50">Vaak (~50%)</option>
                  <option value="70">Bijna dagelijks (~70%)</option>
                  <option value="custom">Zelf invullen‚Ä¶</option>
                </select>
                <div id="auxShareCustomWrap" class="hidden mt-2">
                  <div class="flex"><input id="auxShareCustom" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="25"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">%</span></div>
                </div>
              </div>
              <div id="auxScopWrap" class="hidden">
                <label class="block text-sm font-medium text-gray-700 mb-1">SCOP Bij‚ÄëWP (Airco)</label>
                <input id="auxScop" class="w-full p-2 border-gray-300 border rounded-md text-sm" value="3.2">
              </div>
              <div id="auxEtaWrap" class="hidden">
                <label class="block text-sm font-medium text-gray-700 mb-1">Rendement Œ∑ Bij</label>
                <input id="auxEta" class="w-full p-2 border-gray-300 border rounded-md text-sm" value="0.85">
              </div>
            </div>
          </div>
          <div>
            <h3 class="font-semibold mb-2">Warm Tapwater (ECS)</h3>
            <div class="space-y-3">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1"># personen</label>
                <input id="persons" class="w-full p-2 border-gray-300 border rounded-md text-sm" value="2">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Douches per persoon/dag</label>
                <input id="showersPerPerson" class="w-full p-2 border-gray-300 border rounded-md text-sm" value="1">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Liters per douche</label>
                <div class="flex"><input id="litersPer" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="55"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">L</span></div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Type tapwater systeem</label>
                <select id="dhwType" class="w-full p-2 border-gray-300 border rounded-md text-sm"></select>
              </div>
              <div id="dhwScopWrap" class="hidden">
                <label class="block text-sm font-medium text-gray-700 mb-1">SCOP WP‚Äëboiler</label>
                <input id="dhwScop" class="w-full p-2 border-gray-300 border rounded-md text-sm" value="2.5">
              </div>
              <div id="dhwEtaWrap" class="hidden">
                <label class="block text-sm font-medium text-gray-700 mb-1">Rendement Œ∑</label>
                <input id="dhwEta" class="w-full p-2 border-gray-300 border rounded-md text-sm" value="0.9">
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 3. Elektra: PV, Apparaten & AC -->
      <section class="bg-white border border-gray-200 rounded-xl shadow-sm no-print">
        <div class="w-full flex items-center justify-between p-4">
          <div class="flex items-center gap-4">
            <div class="w-8 h-8 flex items-center justify-center bg-gray-100 rounded-full text-[var(--brand-color)]">‚ö°Ô∏è</div>
            <span class="font-semibold text-lg text-gray-800">3. Elektra: PV, Apparaten & AC</span>
          </div>
        </div>
        <div class="p-4 pt-0 grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 class="font-semibold mb-2">Zonnepanelen (PV)</h3>
            <div class="space-y-3">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">PV Systeem</label>
                <div class="flex"><input id="pvKwp" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="3"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">kWp</span></div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Eigenverbruik</label>
                <div class="flex"><input id="pvSelfUse" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="60"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">%</span></div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Exportvergoeding</label>
                <select id="pvExportMode" class="w-full p-2 border-gray-300 border rounded-md text-sm">
                  <option value="nvt" selected>NVT (geen verkoop)</option>
                  <option value="vente">Vente du surplus ‚â§9 kWc (Q3 2025)</option>
                  <option value="custom">Custom tarief‚Ä¶</option>
                </select>
              </div>
              <div id="pvExportTariffWrap" class="hidden">
                <label class="block text-sm font-medium text-gray-700 mb-1">Tarief export</label>
                <div class="flex"><input id="pvExportTariff" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="0.04"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">‚Ç¨/kWh</span></div>
              </div>
              <p id="pvNote" class="text-xs text-neutral-500 hidden">PV: n.v.t. (geen kWp ingevuld)</p>
              <p id="pvWarn9" class="text-xs text-amber-700 hidden">Let op: tarief ‚â§9 kWc. Bij >9 kWc kies custom of NVT.</p>
            </div>
            <h3 class="font-semibold mb-2 mt-6">Airconditioning (optie)</h3>
            <label class="flex items-center gap-2 mb-2">
              <input type="checkbox" id="acOn"> AC actief?
            </label>
            <div id="seerWrap" class="hidden">
              <label class="block text-sm font-medium text-gray-700 mb-1">SEER (seizoensrendement)</label>
              <input id="seer" class="w-full p-2 border-gray-300 border rounded-md text-sm" value="4.0">
            </div>
          </div>
          <div>
            <h3 class="font-semibold mb-2">Apparaten & Verlichting</h3>
            <p class="text-xs text-neutral-500 mb-2">Sommige posten schalen met huishoudgrootte en aanwezigheid.</p>
            <div id="appliances" class="space-y-2"></div>
          </div>
        </div>
      </section>

      <!-- 4. Zwembad -->
      <section class="bg-white border border-gray-200 rounded-xl shadow-sm no-print">
        <div class="w-full flex items-center justify-between p-4">
          <div class="flex items-center gap-4">
            <div class="w-8 h-8 flex items-center justify-center bg-gray-100 rounded-full text-[var(--brand-color)]">üß™</div>
            <span class="font-semibold text-lg text-gray-800">4. Optioneel: Zwembad</span>
          </div>
        </div>
        <div class="p-4 pt-0">
          <label class="flex items-center gap-2 mb-4">
            <input type="checkbox" id="poolHas"> Activeer zwembadmodule
          </label>
          <div id="poolInputs" class="grid grid-cols-2 md:grid-cols-4 gap-4 hidden">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Volume</label>
              <div class="flex"><input id="poolVol" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="30"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">m¬≥</span></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Doel temperatuur</label>
              <div class="flex"><input id="poolTargetT" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="27"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">¬∞C</span></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Seizoen</label>
              <div class="flex"><input id="poolSeason" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="5"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">mnd</span></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Verwarming</label>
              <select id="poolHeatType" class="w-full p-2 border-gray-300 border rounded-md text-sm"></select>
            </div>
            <div id="poolScopWrap" class="hidden">
              <label class="block text-sm font-medium text-gray-700 mb-1">SCOP WP</label>
              <input id="poolHpScop" class="w-full p-2 border-gray-300 border rounded-md text-sm" value="4">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Pomp vermogen</label>
              <div class="flex"><input id="poolPumpW" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="450"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">W</span></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Pomp uren/dag</label>
              <div class="flex"><input id="poolPumpH" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="8"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">uur</span></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Afdekking</label>
              <select id="poolCover" class="w-full p-2 border-gray-300 border rounded-md text-sm">
                <option value="true">Ja</option>
                <option value="false">Nee</option>
              </select>
            </div>
          </div>
        </div>
      </section>

      <!-- 5. Energieprijzen -->
      <section class="bg-white border border-gray-200 rounded-xl shadow-sm no-print">
        <div class="w-full flex items-center justify-between p-4">
          <div class="flex items-center gap-4">
            <div class="w-8 h-8 flex items-center justify-center bg-gray-100 rounded-full text-[var(--brand-color)]">üí∂</div>
            <span class="font-semibold text-lg text-gray-800">5. Energieprijzen</span>
          </div>
        </div>
        <div id="prices" class="p-4 pt-0 grid grid-cols-2 md:grid-cols-4 gap-4"></div>
      </section>

      <!-- 6. Debug Paneel -->
      <section class="bg-white border border-gray-200 rounded-xl shadow-sm no-print">
        <div class="w-full flex items-center justify-between p-4">
          <div class="flex items-center gap-4">
            <div class="w-8 h-8 flex items-center justify-center bg-gray-100 rounded-full text-[var(--brand-color)]">üõ†Ô∏è</div>
            <span class="font-semibold text-lg text-gray-800">6. Debug Paneel (voor controle)</span>
          </div>
        </div>
        <div class="p-4 pt-0">
          <div class="text-xs font-mono bg-gray-900 text-white p-4 rounded-lg overflow-x-auto" id="debugPanel">‚Äî</div>
          <div id="diagnostics" class="mt-3 text-xs text-neutral-700"></div>
        </div>
      </section>

      <!-- 7. Grondslagen & FAQ -->
      <section id="grondslagen" class="bg-white border border-gray-200 rounded-xl shadow-sm">
        <div class="w-full flex items-center justify-between p-4">
          <div class="flex items-center gap-4">
            <div class="w-8 h-8 flex items-center justify-center bg-gray-100 rounded-full text-[var(--brand-color)]">‚ùì</div>
            <span class="font-semibold text-lg text-gray-800">7. Berekeningsgrondslagen & Veelgestelde Vragen</span>
          </div>
        </div>
        <div class="p-4 pt-0 text-sm text-neutral-800">
          <h4 class="font-semibold mb-2">Kernformules</h4>
          <ul class="list-disc pl-6 space-y-1">
            <li>Transmissie: H<sub>tr</sub> = Œ£(U¬∑A) [W/K]</li>
            <li>Ventilatie: H<sub>vent</sub> = 0,34 ¬∑ n ¬∑ V [W/K]; met HRV: H<sub>vent,eff</sub> = H<sub>vent</sub>¬∑(1‚àíŒ∑)</li>
            <li>H totaal: H = H<sub>tr</sub> + H<sub>vent,eff</sub></li>
            <li>HDD(setpoint): HDD(s) ‚âà HDD(18¬∞C) ¬∑ (s ‚àí T<sub>ref</sub>)/(18 ‚àí T<sub>ref</sub>)</li>
            <li>Warmtevraag: E ‚âà H ¬∑ HDD ¬∑ 24 / 1000 [kWh/j]; aanwezigheid weegt HDD-present/afwezig</li>
            <li>Bronnen: input = E / SCOP (WP/airco) of E / Œ∑ (ketel/kachel)</li>
            <li>Tapwater: Q = m¬∑c¬∑ŒîT; m = personen √ó douches/pers √ó L/douche √ó 365</li>
            <li>Koeling: E<sub>therm</sub> ‚âà k<sub>cool</sub>¬∑H¬∑CDD¬∑24/1000; elektra = E<sub>therm</sub>/SEER</li>
            <li>PV: eigenverbruik = min(opbrengst√ó%, bruto-elektra); export = max(0, opbrengst ‚àí eigenverbruik)</li>
            <li>Kosten: net‚Äëelektra √ó prijs ‚àí export √ó tarief + overige brandstoffen (via ‚Ç¨/kWh)</li>
          </ul>

          <h4 class="font-semibold mt-4 mb-2">Wanneer zie je weinig verschil?</h4>
          <ul class="list-disc pl-6 space-y-1">
            <li><b>Hoge bijverwarming</b>: groot aux‚Äëaandeel maskeert het effect van de hoofdbron.</li>
            <li><b>Lage warmtevraag</b>: door lage setpoints of lange afwezigheid zijn ‚Ç¨‚Äëverschillen klein.</li>
          </ul>

          <h4 class="font-semibold mt-4 mb-2">FAQ (harmonica)</h4>
          <details class="mb-2"><summary class="cursor-pointer font-medium">Hoe betrouwbaar is de uitkomst?</summary><div class="mt-2 text-sm text-neutral-700 pl-4 border-l-2 ml-2">Transparante fysica met eenvoudige aannames. Onzekerheden: HDD/CDD, n (ACH), SCOP/SEER. Reken met ¬±15‚Äì25% bandbreedte bij globale invoer.</div></details>
          <details class="mb-2"><summary class="cursor-pointer font-medium">Wat betekenen U-waarde, R-waarde en Œ£(U¬∑A)?</summary><div class="mt-2 text-sm text-neutral-700 pl-4 border-l-2 ml-2"><b>U-waarde</b> (W/m¬≤K): warmtedoorgang; hoe lager, hoe beter. <b>R-waarde</b> (m¬≤K/W): warmteweerstand; hoe hoger, hoe beter. <b>Htr = Œ£(U ¬∑ A)</b>.</div></details>
          <details class="mb-2"><summary class="cursor-pointer font-medium">Wat is n (ACH) en Hvent?</summary><div class="mt-2 text-sm text-neutral-700 pl-4 border-l-2 ml-2">n (ACH) = luchtwisselingen per uur. Ventilatieverlies: <b>Hvent = 0,34 ¬∑ n ¬∑ V</b>. Met HRV: <b>Hvent,eff = Hvent¬∑(1‚àíŒ∑)</b>.</div></details>
          <details class="mb-2"><summary class="cursor-pointer font-medium">Wat zijn HDD/CDD?</summary><div class="mt-2 text-sm text-neutral-700 pl-4 border-l-2 ml-2">HDD = Heating Degree Days; CDD = Cooling Degree Days.</div></details>
          <details class="mb-2"><summary class="cursor-pointer font-medium">Wat is SCOP/SEER?</summary><div class="mt-2 text-sm text-neutral-700 pl-4 border-l-2 ml-2">SCOP = seizoensrendement verwarmen (WP). SEER = seizoensrendement koelen (AC).</div></details>
        </div>
      </section>
    </div>

    <!-- Sidebar -->
    <aside class="lg:col-span-1 space-y-4 lg:sticky top-4 self-start no-print">
      <div class="bg-white p-4 rounded-xl border border-gray-200 shadow-lg">
        <div class="text-center">
          <div class="text-sm text-gray-600">Totale Geschatte Jaarkosten</div>
          <div id="totalCost" class="text-4xl font-bold my-2 text-[var(--brand-color)]">‚Ç¨¬†‚Äî</div>
          <div id="perMonth" class="text-gray-500">‚Ç¨¬†‚Äî / maand</div>
        </div>
        <div class="mt-4 space-y-2 border-t pt-4" id="costBreakdown"></div>
      </div>

      <div class="bg-white p-4 rounded-xl border border-gray-200">
        <h3 class="font-semibold mb-2">Energiebalans (per jaar)</h3>
        <div class="space-y-3">
          <div class="bg-white p-3 rounded-lg border border-gray-200">
            <div class="text-xs text-gray-600">Netto Elektra van net</div>
            <div><span id="netElec" class="text-xl font-bold text-[var(--brand-color)]">‚Äî</span> <span class="text-sm text-gray-500">kWh</span></div>
            <div class="text-xs text-gray-500 mt-1">Bruto: <span id="grossElec">‚Äî</span> kWh | PV Eigen: <span id="pvSelf">‚Äî</span> kWh | PV Export: <span id="pvExport">‚Äî</span> kWh</div>
          </div>
          <div class="bg-white p-3 rounded-lg border border-gray-200">
            <div class="text-xs text-gray-600">Warmte (input, hoofd+bij)</div>
            <div><span id="heatInput" class="text-xl font-bold text-[var(--brand-color)]">‚Äî</span> <span class="text-sm text-gray-500">kWh eq.</span></div>
            <div class="text-xs text-gray-500 mt-1">Hoofd: <span id="heatMain">‚Äî</span> kWh ¬∑ Bij: <span id="heatAux">‚Äî</span> kWh</div>
          </div>
          <div class="bg-white p-3 rounded-lg border border-gray-200">
            <div class="text-xs text-gray-600">Tapwater (input)</div>
            <div><span id="dhwInputVal" class="text-xl font-bold text-[var(--brand-color)]">‚Äî</span> <span class="text-sm text-gray-500">kWh</span></div>
          </div>
          <div class="bg-white p-3 rounded-lg border border-gray-200">
            <div class="text-xs text-gray-600">EV</div>
            <div><span id="evInputVal" class="text-xl font-bold text-[var(--brand-color)]">‚Äî</span> <span class="text-sm text-gray-500">kWh</span></div>
          </div>
          <div class="bg-white p-3 rounded-lg border border-gray-200">
            <div class="text-xs text-gray-600">Overig (App, AC, Zwembad)</div>
            <div><span id="otherInput" class="text-xl font-bold text-[var(--brand-color)]">‚Äî</span> <span class="text-sm text-gray-500">kWh</span></div>
          </div>
        </div>
      </div>
    </aside>
  </main>

  <!-- Print-samenvatting -->
  <div id="pdf-summary" class="p-8 bg-white text-black">
    <h2 class="text-2xl font-bold mb-6 text-black">Samenvatting Energiecalculator</h2>
    <div class="grid grid-cols-2 gap-x-8 gap-y-3 text-sm">
      <div class="col-span-2 border-t pt-3 space-y-1">
        <h3 class="text-lg font-semibold text-black">Resultaten</h3>
        <p><b>Totale Jaarkosten:</b> <span id="printTotal">‚Äî</span></p>
        <p><b>Warmtevraag:</b> <span id="printHeat">‚Äî</span> kWh/jaar</p>
        <p><b>Netto Elektra van Net:</b> <span id="printNetElec">‚Äî</span> kWh/jaar</p>
      </div>
      <div class="col-span-2 border-t pt-3 space-y-1">
        <h3 class="text-lg font-semibold text-black">Invoer (samenvatting)</h3>
        <p><b>Klimaatzone:</b> <span id="printZone">‚Äî</span></p>
        <p><b>Hoofdverwarming:</b> <span id="printMain">‚Äî</span></p>
        <p><b>Huishouden:</b> <span id="printPersons">‚Äî</span> pers ¬∑ aanwezig <span id="printDays">‚Äî</span> d/jaar</p>
      </div>
      <div class="col-span-2 border-t pt-3">
        <h3 class="text-lg font-semibold text-black">Isolatie (U-waarden)</h3>
        <p>Muur: <span id="printUWall">‚Äî</span> | Dak: <span id="printURoof">‚Äî</span> | Vloer: <span id="printUFloor">‚Äî</span> | Ramen: <span id="printUWin">‚Äî</span></p>
      </div>
    </div>
  </div>

  <!-- FAB -->
  <button id="fab-cost" class="no-print px-4 py-3 rounded-full shadow-lg border bg-white text-gray-900 font-semibold flex items-center gap-2">‚Ç¨¬†‚Äî ¬∑ Grondslagen</button>

  <script>
    // ===== Data & constants =====
    const ZONES = [
      { id: 'med',   name: 'M√©diterran√©e (zacht)',            hdd: 1400, cdd: 700,  pool_temp: 22, Tref: 12 },
      { id: 'ouest', name: 'Zuid‚ÄëWest / Atlantisch',          hdd: 1900, cdd: 350,  pool_temp: 20, Tref: 10 },
      { id: 'paris', name: 'Noord / Parijs (√éle‚Äëde‚ÄëFrance)',  hdd: 2200, cdd: 250,  pool_temp: 19, Tref: 7  },
      { id: 'centre',name: 'Centraal / Bourgogne',            hdd: 2500, cdd: 200,  pool_temp: 19, Tref: 6  },
      { id: 'est',   name: 'Oost / Elzas‚ÄëLotharingen',        hdd: 2800, cdd: 150,  pool_temp: 18, Tref: 5  },
      { id: 'mont',  name: 'Bergen (koel)',                   hdd: 3400, cdd:  50,  pool_temp: 17, Tref: 2  }
    ];
    const PV_YIELD = { med: 1450, ouest: 1250, paris: 1150, centre: 1200, est: 1150, mont: 1100 };
    const DEFAULT_APPLIANCES = [
      { key: 'fridge', label: 'Koelkast/vriezer',       kwh: 250, on: true,  scales: false },
      { key: 'wash',   label: 'Wassen/drogen',          kwh: 220, on: true,  scales: true  },
      { key: 'dish',   label: 'Vaatwasser',             kwh: 160, on: true,  scales: true  },
      { key: 'it',     label: 'IT & randapparatuur',    kwh: 150, on: true,  scales: true  },
      { key: 'tv',     label: 'TV & media',             kwh: 120, on: true,  scales: true  },
      { key: 'small',  label: 'Kleine verbruikers',     kwh: 150, on: true,  scales: true  },
      { key: 'lighting', label: 'Verlichting (LED)',    kwh: 180, on: true,  scales: true  }
    ];
    const PRICE_DEFAULTS_USER = { elec: 0.25, gas: 1.20, fioul: 1.15, pellet: 0.60, wood: 85, propaan: 1.80, petroleum: 2.00 };
    const ENERGY_UNITS = { elec: '‚Ç¨/kWh', gas: '‚Ç¨/m¬≥', fioul: '‚Ç¨/L', pellet: '‚Ç¨/kg', wood: '‚Ç¨/st√®re', propaan: '‚Ç¨/L', petroleum: '‚Ç¨/L' };
    const KWH_CONVERSION = { elec: 1, gas: 10, fioul: 10, pellet: 5, wood: 1800, propaan: 7.1, petroleum: 10 };
    const HEAT_MAIN_DEF = [
      { key: 'elec',   label: 'Elektrisch (direct)',   priceKey: 'elec'   },
      { key: 'hp',     label: 'Warmtepomp (SCOP)',     priceKey: 'elec'   },
      { key: 'gas',    label: 'Aardgas (ketel Œ∑)',     priceKey: 'gas'    },
      { key: 'fioul',  label: 'Fioul/mazout (Œ∑)',      priceKey: 'fioul'  },
      { key: 'pellet', label: 'Houtpellets‚ÄëCV (Œ∑)',    priceKey: 'pellet' },
      { key: 'wood',   label: 'Hout‚ÄëCV (Œ∑)',           priceKey: 'wood'   }
    ];
    const HEAT_AUX_DEF = [
      { key: 'none',      label: 'Geen bijverwarming',      priceKey: null       },
      { key: 'inverter',  label: 'Inverter‚Äëairco (SCOP)',   priceKey: 'elec'     },
      { key: 'elec',      label: 'Elektrisch (direct)',     priceKey: 'elec'     },
      { key: 'pellet',    label: 'Houtpelletkachel (Œ∑)',    priceKey: 'pellet'   },
      { key: 'wood',      label: 'Houtkachel (Œ∑)',          priceKey: 'wood'     },
      { key: 'petroleum', label: 'Petroleumkachel (Œ∑)',     priceKey: 'petroleum'}
    ];
    const DHW_TYPES_DEF = [
      { key: 'elec',  label: 'Boiler elektrisch',   priceKey: 'elec' },
      { key: 'gas',   label: 'Gasgeiser/ketel (Œ∑)', priceKey: 'gas'  },
      { key: 'hp',    label: 'WP‚Äëboiler (SCOP)',    priceKey: 'elec' },
      { key: 'solar', label: 'Zonneboiler',         priceKey: null   }
    ];
    const POOL_HEAT_DEF = [
      { key: 'none', label: 'Geen verwarming',   priceKey: null },
      { key: 'elec', label: 'Elektrisch',        priceKey: 'elec' },
      { key: 'gas',  label: 'Gas (Œ∑)',           priceKey: 'gas'  },
      { key: 'hp',   label: 'Warmtepomp (SCOP)', priceKey: 'elec' }
    ];
    const U_PRESETS = {
      wall: { 'Onge√Øsoleerd (~1975)': 2.0, 'Matig (~5cm)': 0.8, 'Goed (~10cm)': 0.4, 'Zeer goed (15cm+)': 0.25 },
      roof: { 'Onge√Øsoleerd': 3.0, 'Matig (~10cm)': 0.5, 'Goed (~20cm)': 0.25, 'Zeer goed (30cm+)': 0.15 },
      floor:{ 'Op zand': 2.2, 'Kruipruimte': 1.2, 'Matig ge√Øsoleerd': 0.8, 'Goed ge√Øsoleerd': 0.3 },
      win:  { 'Enkel glas': 5.5, 'Oud dubbelglas': 2.8, 'Modern HR(+)': 1.6, 'Triple HR++': 1.0 }
    };

    // ===== Helpers =====
    const fmt0 = new Intl.NumberFormat('nl-NL', { maximumFractionDigits: 0 });
    const eur0 = (x) => new Intl.NumberFormat('nl-NL', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 }).format(x||0);
    const num = (v, d=0) => { const n = parseFloat(String(v).replace(',', '.')); return Number.isFinite(n) ? n : d; };
    const clamp = (x, a, b) => Math.min(b, Math.max(a, x));

    function personsMultiplier(p){ return Math.max(0.5, Math.min(3, p/2)); }

    function buildSelect(el, options, valueKey='key', labelKey='label', selected){
      el.innerHTML = options.map(o => `<option value="${o[valueKey]}">${o[labelKey]}</option>`).join('');
      if (selected!=null) el.value = selected;
    }

    function buildPriceInputs(container){
      const map = {elec:'Elektriciteit',gas:'Gas',fioul:'Fioul',pellet:'Houtpellets',wood:'Stookhout',propaan:'Propaan',petroleum:'Petroleum'};
      container.innerHTML = Object.keys(map).map(k => `
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">${map[k]}</label>
          <div class="flex"><input id="price_${k}" class="w-full p-2 border-gray-300 border rounded-l-md text-sm" value="${PRICE_DEFAULTS_USER[k]}"><span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">${ENERGY_UNITS[k]}</span></div>
        </div>`).join('');
    }

    function buildApplianceList(container){
      container.innerHTML = DEFAULT_APPLIANCES.map((a,i)=>`
        <div class="flex items-center justify-between bg-gray-50 p-2 rounded-md border">
          <label class="flex items-center gap-2 text-sm">
            <input type="checkbox" id="appl_on_${i}" ${a.on?'checked':''}> ${a.label}
          </label>
          <input type="text" id="appl_kwh_${i}" value="${a.kwh}" class="w-20 p-1 border rounded text-sm text-right">
        </div>
      `).join('');
    }

    function buildPresets(containerId, presets, targetInputId){
      const c = document.getElementById(containerId);
      c.innerHTML = Object.entries(presets).map(([label,val])=>`<button type="button" class="text-xs px-2 py-1 bg-gray-200 hover:bg-gray-300 rounded border border-gray-300" data-target="${targetInputId}" data-val="${val}">${label}</button>`).join(' ');
      c.querySelectorAll('button').forEach(btn=>{
        btn.addEventListener('click',()=>{ const t = document.getElementById(btn.dataset.target); t.value = String(btn.dataset.val); computeAndRender(); });
      });
    }

    function gatherState(){
      const prices = {};
      Object.keys(PRICE_DEFAULTS_USER).forEach(k=> prices[k] = num(document.getElementById('price_'+k).value));
      const appls = DEFAULT_APPLIANCES.map((a,i)=> ({
        key:a.key, label:a.label, scales:a.scales,
        on: document.getElementById('appl_on_'+i).checked,
        kwh: num(document.getElementById('appl_kwh_'+i).value, a.kwh)
      }));
      return {
        // Klimaat & woning
        zone: document.getElementById('zone').value,
        setpoint: num(document.getElementById('setpoint').value,20),
        volume: num(document.getElementById('volume').value,250),
        ach: num(document.getElementById('ach').value,0.5),
        ventType: document.getElementById('ventType').value,
        hrvEta: num(document.getElementById('hrvEta').value,0.75),
        wallA:num(document.getElementById('wallA').value,120), wallU:num(document.getElementById('wallU').value,0.5),
        roofA:num(document.getElementById('roofA').value,100), roofU:num(document.getElementById('roofU').value,0.25),
        floorA:num(document.getElementById('floorA').value,100), floorU:num(document.getElementById('floorU').value,0.35),
        winA:num(document.getElementById('winA').value,20),   winU:num(document.getElementById('winU').value,1.6),
        presentDays: clamp(num(document.getElementById('presentDays').value,260),0,365),
        awaySetpoint: num(document.getElementById('awaySetpoint').value,12),
        // Verwarming/tapwater
        mainType: document.getElementById('mainType').value,
        mainScop: num(document.getElementById('mainScop').value,3.2),
        mainEta:  num(document.getElementById('mainEta').value,0.9),
        auxType:  document.getElementById('auxType').value,
        auxSharePreset: document.getElementById('auxSharePreset').value,
        auxShareCustom: num(document.getElementById('auxShareCustom').value,25),
        auxScop: num(document.getElementById('auxScop').value,3.2),
        auxEta:  num(document.getElementById('auxEta').value,0.85),
        persons: num(document.getElementById('persons').value,2),
        showersPerPerson: num(document.getElementById('showersPerPerson').value,1),
        litersPer: num(document.getElementById('litersPer').value,55),
        dhwType: document.getElementById('dhwType').value,
        dhwScop: num(document.getElementById('dhwScop').value,2.5),
        dhwEta:  num(document.getElementById('dhwEta').value,0.9),
        // PV & AC
        pvKwp: num(document.getElementById('pvKwp').value,3),
        pvSelfUse: num(document.getElementById('pvSelfUse').value,60),
        pvExportMode: document.getElementById('pvExportMode').value,
        pvExportTariff: num(document.getElementById('pvExportTariff').value,0.04),
        acOn: document.getElementById('acOn').checked,
        seer: num(document.getElementById('seer').value,4.0),
        // Apparaten/EV
        appls,
        evKmWeek: num(document.getElementById('evKmWeek')?.value || 100, 100),
        evKwh100: num(document.getElementById('evKwh100')?.value || 18, 18),
        evLoss: num(document.getElementById('evLoss')?.value || 10, 10),
        // Zwembad
        poolHas: document.getElementById('poolHas').checked,
        poolVol: num(document.getElementById('poolVol').value,30),
        poolTargetT: num(document.getElementById('poolTargetT').value,27),
        poolSeason: num(document.getElementById('poolSeason').value,5),
        poolHeatType: document.getElementById('poolHeatType').value,
        poolHpScop: num(document.getElementById('poolHpScop').value,4),
        poolPumpW: num(document.getElementById('poolPumpW').value,450),
        poolPumpH: num(document.getElementById('poolPumpH').value,8),
        poolCover: document.getElementById('poolCover').value,
        poolWind:  num(document.getElementById('poolWind')?.value || 1, 1),
        // Prijzen
        userPrices: prices
      };
    }

    function computeResults(s){
      const z = ZONES.find(x => x.id === s.zone) || ZONES[2];
      const pricesKwh = {}; Object.keys(s.userPrices).forEach(k=> pricesKwh[k] = s.userPrices[k]/(KWH_CONVERSION[k]||1));
      const UA = s.wallA*s.wallU + s.roofA*s.roofU + s.floorA*s.floorU + s.winA*s.winU;
      const Hvent = 0.34 * s.volume * s.ach;
      const etaHRV = s.ventType==='hrv' ? clamp(s.hrvEta,0,0.95) : 0;
      const HventEff = s.ventType==='hrv' ? Hvent*(1-etaHRV) : Hvent;
      const H = UA + HventEff;
      const scale = (sp) => Math.max(0, (sp - z.Tref) / (18 - z.Tref));
      const HDD_present = z.hdd * scale(s.setpoint);
      const HDD_away    = z.hdd * scale(s.awaySetpoint);
      const daysPresent = s.presentDays; const daysAway = 365 - daysPresent;
      const heatDemand = H * ((HDD_present*(daysPresent/365)) + (HDD_away*(daysAway/365))) * 24 / 1000;
      // hoofd/bij
      const auxSharePct = (s.auxSharePreset==='custom' ? s.auxShareCustom : Number(s.auxSharePreset));
      const auxFrac = s.auxType==='none' ? 0 : Math.min(0.9, Math.max(0, auxSharePct/100));
      const mainFrac = 1 - auxFrac;
      const mainDef = HEAT_MAIN_DEF.find(h=>h.key===s.mainType);
      const auxDef  = HEAT_AUX_DEF.find(h=>h.key===s.auxType) || {priceKey:null};
      const effOf = (def, scop, eta) => def?.label?.includes('SCOP') ? Math.max(1, scop||3) : (def?.label?.includes('Œ∑') ? Math.max(0.5, eta||0.9) : 1);
      const mainEff = effOf(mainDef, s.mainScop, s.mainEta);
      const auxEff  = effOf(auxDef,  s.auxScop,  s.auxEta);
      const mainInput = heatDemand * mainFrac / mainEff;
      const auxInput  = auxDef.key==='none' ? 0 : (heatDemand * auxFrac / auxEff);
      // tapwater
      const ppl = Math.max(1, s.persons);
      const dpp = Math.max(0, s.showersPerPerson);
      const liters = Math.max(1, s.litersPer);
      const dhwThermal = (ppl * dpp * liters * 365 * (40-12) * 4.186) / 3600;
      const dhwDef = DHW_TYPES_DEF.find(d=>d.key===s.dhwType) || {priceKey:null};
      const dhwEff = effOf(dhwDef, s.dhwScop, s.dhwEta);
      const dhwInput = dhwDef.priceKey ? (dhwThermal / dhwEff) : 0;
      // apparaten
      const m = personsMultiplier(ppl);
      const applKwhRaw = s.appls.reduce((sum,a)=> sum + (a.on ? a.kwh*(a.scales?m:1) : 0), 0);
      const applKwh = applKwhRaw * (daysPresent/365);
      // EV
      const evKwhYear = (s.evKmWeek * 52) * (s.evKwh100/100) * (1 + s.evLoss/100);
      // Zwembad
      let pool = {kwh:0, cost:0, elec:0, gas:0};
      if (s.poolHas){
        const days = s.poolSeason * 30;
        const pumpKwh = (s.poolPumpW/1000) * s.poolPumpH * days;
        const ambient = z.pool_temp;
        const deltaT = Math.max(0, s.poolTargetT - ambient);
        const thermalDaily = s.poolVol * deltaT * 1.16 * (s.poolCover==='true'?0.5:1.0) * (s.poolWind||1);
        const thermal = thermalDaily * days;
        const def = POOL_HEAT_DEF.find(h=>h.key===s.poolHeatType);
        const eff = def?.label.includes('SCOP') ? Math.max(1, s.poolHpScop||4) : (def?.label.includes('Œ∑') ? Math.max(0.5, 0.9) : 1);
        const input = def?.key==='none' ? 0 : (thermal / eff);
        let elecUse = pumpKwh, gasUse = 0;
        if (def?.priceKey==='elec') elecUse += input;
        if (def?.priceKey==='gas')  gasUse  += input;
        const poolCost = elecUse*(pricesKwh.elec||0) + gasUse*(pricesKwh.gas||0);
        pool = {kwh:pumpKwh+input, cost:poolCost, elec:elecUse, gas:gasUse};
      }
      // Koeling (AC)
      let coolTherm = 0, coolEl = 0;
      if (s.acOn){
        const kCool = 0.6; // grove factor
        const CDD = z.cdd * (daysPresent/365);
        const SEER = Math.max(2.5, s.seer||4);
        coolTherm = kCool * H * CDD * 24 / 1000;
        coolEl = coolTherm / SEER;
      }
      // Bruto elektra (onafhankelijk van PV)
      const elecHeatingInput = (mainDef?.priceKey==='elec'?mainInput:0) + (auxDef?.priceKey==='elec'?auxInput:0);
      const elecDhwInput = (dhwDef?.priceKey==='elec' ? dhwInput : 0);
      const elecTotalGross = elecHeatingInput + elecDhwInput + applKwh + evKwhYear + pool.elec + coolEl;
      // PV (cap + export)
      const pvYield = s.pvKwp>0 ? s.pvKwp * (PV_YIELD[s.zone] || 1150) : 0;
      const pvSelfMax = pvYield * (s.pvSelfUse/100);
      const pvSelf = Math.min(pvSelfMax, elecTotalGross); // cap op zelfverbruik
      const pvExport = Math.max(0, pvYield - pvSelf);
      // Exportvergoeding
      let exportTariff = 0;
      if (s.pvExportMode==='vente') exportTariff = 0.04; // Q3 2025
      if (s.pvExportMode==='custom') exportTariff = Math.max(0, s.pvExportTariff||0);
      const elecNet = Math.max(0, elecTotalGross - pvSelf);
      // Kosten
      const mainCost = (pricesKwh[mainDef?.priceKey]||0) * mainInput;
      const auxCost  = (pricesKwh[auxDef?.priceKey] ||0) * auxInput;
      const dhwCost  = (pricesKwh[dhwDef?.priceKey] ||0) * dhwInput;
      const coolCost = coolEl * (pricesKwh.elec||0);
      const nonElecMain = mainDef?.priceKey!=='elec' ? mainCost : 0;
      const nonElecAux  = auxDef?.priceKey!=='elec' ? auxCost  : 0;
      const nonElecDhw  = dhwDef?.priceKey!=='elec' ? dhwCost  : 0;
      const elecCost    = elecNet * (pricesKwh.elec||0) - pvExport * exportTariff;
      const totalCost   = elecCost + nonElecMain + nonElecAux + nonElecDhw + (pool.gas * (pricesKwh.gas||0));
      const costs = {
        verwarming: mainCost + auxCost,
        tapwater: dhwCost,
        koeling: coolCost,
        apparaten: applKwh * (pricesKwh.elec||0),
        ev: evKwhYear * (pricesKwh.elec||0),
        zwembad: pool.cost,
        pvWaarde: -(pvSelf * (pricesKwh.elec||0)),
        pvExportOpbrengst: pvExport * exportTariff * -1 // tonen als negatieve kosten (opbrengst)
      };
      // Audit elektra
      const elecParts = { hp: elecHeatingInput, dhw: elecDhwInput, appl: applKwh, ev: evKwhYear, pool: pool.elec, cool: coolEl };
      const elecPartsSum = Object.values(elecParts).reduce((a,b)=>a+b,0);
      const mismatch = Math.abs(elecPartsSum - elecTotalGross) > 0.05 * Math.max(1, elecTotalGross);
      return { totalCost, perMonth: totalCost/12, heatDemand, costs, verbruik:{nettoElec:elecNet, brutoElec:elecTotalGross, pvEigen:pvSelf, pvExport, warmte: mainInput+auxInput, heatMain: mainInput, heatAux: auxInput, tapwater:dhwInput, koelingEl:coolEl, ev: evKwhYear, overig: applKwh + coolEl + pool.kwh}, debug:{ UA,Hvent,HventEff,H,HDD_present,HDD_away,daysPresent,daysAway, mainFrac,auxFrac, mainEff,auxEff, mainInput,auxInput, elecTotalGross, pvYield, pvSelf, pvExport, elecNet, exportTariff, totalCost, elecParts, elecPartsSum, mismatch } };
    }

    function render(results){
      // Sidebar total
      document.getElementById('totalCost').textContent = eur0(results.totalCost);
      document.getElementById('perMonth').textContent = `${eur0(results.perMonth)} / maand`;
      // FAB
      const fab = document.getElementById('fab-cost');
      fab.textContent = `${eur0(results.totalCost)} ¬∑ Grondslagen`;
      fab.onclick = ()=> document.getElementById('grondslagen').scrollIntoView({behavior:'smooth'});
      // Breakdown
      const cb = document.getElementById('costBreakdown');
      cb.innerHTML = '';
      Object.entries(results.costs).forEach(([k,v])=>{
        const row = document.createElement('div'); row.className='flex justify-between text-sm';
        const name = document.createElement('span'); name.className='text-gray-600';
        const labelMap = { pvWaarde:'PV eigen (waarde)', pvExportOpbrengst:'PV export (opbrengst)' };
        name.textContent = labelMap[k] || (k.charAt(0).toUpperCase()+k.slice(1));
        const val = document.createElement('span'); val.className = `font-medium ${v<0?'text-green-600':'text-gray-800'}`; val.textContent = eur0(v);
        row.appendChild(name); row.appendChild(val); cb.appendChild(row);
      });
      // Cards
      document.getElementById('netElec').textContent = fmt0.format(results.verbruik.nettoElec);
      document.getElementById('grossElec').textContent = fmt0.format(results.verbruik.brutoElec);
      document.getElementById('pvSelf').textContent = fmt0.format(results.verbruik.pvEigen);
      document.getElementById('pvExport').textContent = fmt0.format(results.verbruik.pvExport);
      document.getElementById('heatInput').textContent = fmt0.format(results.verbruik.warmte);
      document.getElementById('heatMain').textContent = fmt0.format(results.verbruik.heatMain);
      document.getElementById('heatAux').textContent = fmt0.format(results.verbruik.heatAux);
      document.getElementById('dhwInputVal').textContent = fmt0.format(results.verbruik.tapwater);
      document.getElementById('evInputVal').textContent = fmt0.format(results.verbruik.ev);
      document.getElementById('otherInput').textContent = fmt0.format(results.verbruik.overig);
      // Print summary
      document.getElementById('printTotal').textContent = eur0(results.totalCost);
      document.getElementById('printHeat').textContent = fmt0.format(results.heatDemand);
      document.getElementById('printNetElec').textContent = fmt0.format(results.verbruik.nettoElec);
      document.getElementById('printZone').textContent = (ZONES.find(z=>z.id===document.getElementById('zone').value)||{}).name || '‚Äî';
      const mainLbl = (HEAT_MAIN_DEF.find(h=>h.key===document.getElementById('mainType').value)||{}).label || '‚Äî';
      document.getElementById('printMain').textContent = mainLbl;
      document.getElementById('printPersons').textContent = document.getElementById('persons').value;
      document.getElementById('printDays').textContent = document.getElementById('presentDays').value;
      document.getElementById('printUWall').textContent = document.getElementById('wallU').value;
      document.getElementById('printURoof').textContent = document.getElementById('roofU').value;
      document.getElementById('printUFloor').textContent = document.getElementById('floorU').value;
      document.getElementById('printUWin').textContent = document.getElementById('winU').value;
      // PV notes
      document.getElementById('pvNote').classList.toggle('hidden', !(num(document.getElementById('pvKwp').value)<=0));
      const mode = document.getElementById('pvExportMode').value; const kwp = num(document.getElementById('pvKwp').value,0);
      document.getElementById('pvWarn9').classList.toggle('hidden', !(mode==='vente' && kwp>9));
      // Debug panel
      const d = results.debug;
      const debugEl = document.getElementById('debugPanel');
      debugEl.innerHTML = `
        <h4 class="font-semibold mb-2 text-yellow-400">Reken-Audit</h4>
        <p>UA (transmissie): ${d.UA.toFixed(2)} W/K</p>
        <p>Hvent (bruto): ${d.Hvent.toFixed(2)} W/K</p>
        <p>Hvent effectief: ${d.HventEff.toFixed(2)} W/K</p>
        <p>H totaal: ${(d.UA + d.HventEff).toFixed(2)} W/K</p>
        <p>HDD(setpoint): ${d.HDD_present.toFixed(0)} | HDD(afwezig): ${d.HDD_away.toFixed(0)}</p>
        <p>Present/Afwezig (d): ${d.daysPresent} / ${d.daysAway}</p>
        <p>Warmtevraag: ${fmt0.format(results.heatDemand)} kWh</p>
        <p>Verdeling H/B: ${(d.mainFrac*100).toFixed(0)}% / ${(d.auxFrac*100).toFixed(0)}%</p>
        <p>Effici√´ntie Hoofd/Bij: ${(d.mainEff||0).toFixed(2)} / ${(d.auxEff||0).toFixed(2)}</p>
        <p>Input Hoofd: ${fmt0.format(d.mainInput)} kWh</p>
        <p>Input Bij: ${fmt0.format(d.auxInput)} kWh</p>
        <p class="mt-2 border-t border-gray-600 pt-2">Elektra bruto (som deelposten): ${fmt0.format(d.elecPartsSum)} kWh</p>
        <p>Elektra bruto (balans): ${fmt0.format(results.verbruik.brutoElec)} kWh</p>
        ${d.mismatch?'<p class="text-red-400">‚ö† Inconsistentie: deelposten ‚â† balans (&gt;5%).</p>':''}
        <p>PV Opbrengst: ${fmt0.format(d.pvYield)} kWh ¬∑ Eigen: ${fmt0.format(d.pvSelf)} ¬∑ Export: ${fmt0.format(d.pvExport)} @ ‚Ç¨${d.exportTariff.toFixed(2)}/kWh</p>
        <p>Koeling (el): ${fmt0.format(results.verbruik.koelingEl)} kWh ¬∑ EV: ${fmt0.format(results.verbruik.ev)} kWh</p>
        <p class="border-t border-gray-600 pt-2 font-bold text-green-400">Eindkosten: ${eur0(results.totalCost)}</p>`;
      // Diagnostics (contextuele hints)
      const di = document.getElementById('diagnostics');
      const hints = [];
      if (d.auxFrac > 0.5) hints.push('Bijverwarming dekt >50%: effect hoofdbron kan gemaskeerd worden.');
      if (results.heatDemand < 5000) hints.push('Lage warmtevraag: ‚Ç¨‚Äëverschillen tussen bronnen blijven beperkt.');
      if (d.pvSelf >= results.verbruik.brutoElec) hints.push('PV dekt vrijwel alle elektra: extra PV levert vooral export op.');
      di.innerHTML = hints.length ? `<div class="p-3 rounded bg-amber-50 border border-amber-200"><b>Context:</b> <ul class="list-disc pl-5 mt-1">${hints.map(h=>`<li>${h}</li>`).join('')}</ul></div>` : '';
    }

    function computeAndRender(){ const state = gatherState(); const res = computeResults(state); render(res); }

    function setVisibility()
    {
      const mainType = document.getElementById('mainType').value;
      document.getElementById('mainScopWrap').classList.toggle('hidden', mainType!=='hp');
      document.getElementById('mainEtaWrap').classList.toggle('hidden', !/Œ∑/.test((HEAT_MAIN_DEF.find(h=>h.key===mainType)||{}).label||''));
      const auxType = document.getElementById('auxType').value;
      document.getElementById('auxShareWrap').classList.toggle('hidden', auxType==='none');
      document.getElementById('auxScopWrap').classList.toggle('hidden', auxType!=='inverter');
      document.getElementById('auxEtaWrap').classList.toggle('hidden', !/Œ∑/.test((HEAT_AUX_DEF.find(h=>h.key===auxType)||{}).label||''));
      const dhwType = document.getElementById('dhwType').value;
      document.getElementById('dhwScopWrap').classList.toggle('hidden', dhwType!=='hp');
      document.getElementById('dhwEtaWrap').classList.toggle('hidden', !/Œ∑/.test((DHW_TYPES_DEF.find(d=>d.key===dhwType)||{}).label||''));
      const ventType = document.getElementById('ventType').value;
      document.getElementById('hrvWrap').classList.toggle('hidden', ventType!=='hrv');
      const poolHas = document.getElementById('poolHas').checked;
      document.getElementById('poolInputs').classList.toggle('hidden', !poolHas);
      const poolHeatType = document.getElementById('poolHeatType').value;
      document.getElementById('poolScopWrap').classList.toggle('hidden', poolHeatType!=='hp');
      const acOn = document.getElementById('acOn').checked;
      document.getElementById('seerWrap').classList.toggle('hidden', !acOn);
      const auxPreset = document.getElementById('auxSharePreset').value;
      document.getElementById('auxShareCustomWrap').classList.toggle('hidden', auxPreset!=='custom');
      const pvMode = document.getElementById('pvExportMode').value;
      document.getElementById('pvExportTariffWrap').classList.toggle('hidden', pvMode!=='custom');
    }

    function addInputListeners(){
      const ids = [ 'zone','setpoint','volume','ach','ventType','hrvEta','wallA','wallU','roofA','roofU','floorA','floorU','winA','winU','presentDays','awaySetpoint','mainType','mainScop','mainEta','auxType','auxSharePreset','auxShareCustom','auxScop','auxEta','persons','showersPerPerson','litersPer','dhwType','dhwScop','dhwEta','pvKwp','pvSelfUse','pvExportMode','pvExportTariff','acOn','seer','poolHas','poolVol','poolTargetT','poolSeason','poolHeatType','poolHpScop','poolPumpW','poolPumpH','poolCover','evKmWeek','evKwh100','evLoss' ];
      ids.forEach(id=>{
        const el = document.getElementById(id); if (!el) return;
        el.addEventListener('input', ()=>{ setVisibility(); computeAndRender(); });
        el.addEventListener('change', ()=>{ setVisibility(); computeAndRender(); });
      });
      // prices
      Object.keys(PRICE_DEFAULTS_USER).forEach(k=>{
        const el = document.getElementById('price_'+k);
        el.addEventListener('input', computeAndRender);
      });
      // appliances
      DEFAULT_APPLIANCES.forEach((a,i)=>{
        document.getElementById('appl_on_'+i).addEventListener('change', computeAndRender);
        document.getElementById('appl_kwh_'+i).addEventListener('input', computeAndRender);
      });
    }

    function initUI(){
      // zones
      buildSelect(document.getElementById('zone'), ZONES.map(z=>({key:z.id,label:z.name})), 'key','label','paris');
      // selects heat
      buildSelect(document.getElementById('mainType'), HEAT_MAIN_DEF);
      document.getElementById('mainType').value = 'hp';
      buildSelect(document.getElementById('auxType'), HEAT_AUX_DEF);
      document.getElementById('auxType').value = 'none'; // default: geen bijverwarming
      buildSelect(document.getElementById('dhwType'), DHW_TYPES_DEF);
      document.getElementById('dhwType').value = 'hp';
      // pool heat type
      buildSelect(document.getElementById('poolHeatType'), POOL_HEAT_DEF);
      document.getElementById('poolHeatType').value = 'hp';
      // prices/appliances
      buildPriceInputs(document.getElementById('prices'));
      buildApplianceList(document.getElementById('appliances'));
      // presets
      buildPresets('wallPresets', U_PRESETS.wall, 'wallU');
      buildPresets('roofPresets', U_PRESETS.roof, 'roofU');
      buildPresets('floorPresets',U_PRESETS.floor,'floorU');
      buildPresets('winPresets',  U_PRESETS.win,  'winU');
      // EV block (rechts) ‚Äî daarna listeners toevoegen
      const elecCol = document.querySelector('#appliances').parentElement;
      const evBlock = document.createElement('div'); evBlock.className='mt-6'; evBlock.innerHTML = `
        <h3 class=\"font-semibold mb-2\">Elektrische Auto (EV)</h3>
        <div class=\"space-y-3\">
          <div>
            <label class=\"block text-sm font-medium text-gray-700 mb-1\">Kilometers per week</label>
            <div class=\"flex\"><input id=\"evKmWeek\" class=\"w-full p-2 border-gray-300 border rounded-l-md text-sm\" value=\"100\"><span class=\"inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm\">km</span></div>
          </div>
          <div>
            <label class=\"block text-sm font-medium text-gray-700 mb-1\">Verbruik</label>
            <div class=\"flex\"><input id=\"evKwh100\" class=\"w-full p-2 border-gray-300 border rounded-l-md text-sm\" value=\"18\"><span class=\"inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm\">kWh/100km</span></div>
          </div>
          <div>
            <label class=\"block text-sm font-medium text-gray-700 mb-1\">Laadverlies</label>
            <div class=\"flex\"><input id=\"evLoss\" class=\"w-full p-2 border-gray-300 border rounded-l-md text-sm\" value=\"10\"><span class=\"inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm\">%</span></div>
          </div>
        </div>`;
      elecCol.appendChild(evBlock);
    }

    function runTests(){
      const s = gatherState();
      const r1 = computeResults(s);
      let passed = 0, total = 0;
      function test(name, cond){ total++; const ok = !!cond; if (ok) passed++; console[ok?'log':'error'](`%cTEST ${ok?'PASS':'FAIL'}: ${name}` , `color:${ok?'#16a34a':'#dc2626'}; font-weight:700;`); }
      // T1: Slechtere U-waarden -> hogere warmtevraag
      const s2 = {...s, wallU:s.wallU*2, roofU:s.roofU*2, floorU:s.floorU*2, winU:s.winU*2};
      const r2 = computeResults(s2);
      test('Warmtevraag stijgt bij hogere U-waarden', r2.heatDemand > r1.heatDemand);
      // T2: Meer PV -> lager netto-elektra (met cap actief)
      const s3 = {...s, pvKwp: s.pvKwp + 5};
      const r3 = computeResults(s3);
      test('Netto elektra daalt bij meer PV', r3.verbruik.nettoElec <= r1.verbruik.nettoElec);
      // T3: HRV verlaagt Hvent effectief
      const s4 = {...s, ventType:'hrv', hrvEta:0.8};
      const r4 = computeResults(s4);
      test('Hvent,eff < Hvent met HRV', r4.debug.HventEff < r4.debug.Hvent);
      // T4: AC aan verhoogt bruto-elektra
      const s5 = {...s, acOn:true, seer:4};
      const r5 = computeResults(s5);
      test('AC aan verhoogt bruto-elektra', r5.verbruik.brutoElec >= r1.verbruik.brutoElec);
      // T5: EV km/week omhoog -> bruto-elektra omhoog
      const s6 = {...s, evKmWeek: (s.evKmWeek||100)*5 };
      const r6 = computeResults(s6);
      test('EV km/week ‚Üë => bruto-elektra ‚Üë', r6.verbruik.brutoElec > r1.verbruik.brutoElec);
      // T6: Exportvergoeding NVT vs 0.04 maakt verschil (bij voldoende PV)
      const s7 = {...s, pvKwp: 9, pvSelfUse:60, pvExportMode:'nvt'};
      const r7 = computeResults(s7);
      const s8 = {...s7, pvExportMode:'vente'};
      const r8 = computeResults(s8);
      test('Exportvergoeding verlaagt totale kosten', r8.totalCost <= r7.totalCost);
      console.log(`%c${passed}/${total} tests geslaagd`, 'color:#111; background:#fde68a; padding:2px 6px; border-radius:4px;');
    }

    // ===== Boot =====
    document.addEventListener('DOMContentLoaded', ()=>{
      initUI();
      setVisibility();
      addInputListeners();
      computeAndRender();
      runTests();
    });
  </script>
</body>
</html>
