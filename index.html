<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Energie- & Kostencalculator Frankrijk | InfoFrankrijk.com</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --brand-color: #800000; }
    body { font-family: 'Inter', sans-serif; background-color: #f9fafb; }
    .tooltip { position: relative; display: inline-flex; }
    .tooltip .tooltip-text { visibility: hidden; width: 250px; background-color: #333; color: #fff; text-align: left; border-radius: 6px; padding: 8px; position: absolute; z-index: 10; bottom: 125%; left: 50%; margin-left: -125px; opacity: 0; transition: opacity 0.3s; font-weight: 400; }
    .tooltip:hover .tooltip-text { visibility: visible; opacity: 1; }
    @media print { .no-print { display: none !important; } #pdf-summary { display: block !important; } body { font-size: 10px; color: black; } h1, h2, h3 { color: black !important; } }
  </style>
</head>
<body>
  <div id="app"></div>

  <script type="text/babel">
    const { useState, useMemo, useCallback, useRef } = React;

    // --- Data & Constants ---
    const ZONES = [ { id: 'med', name: 'Méditerranée (zacht)', hdd: 1400, pool_temp: 22 }, { id: 'ouest', name: 'Zuid‑West / Atlantisch', hdd: 1900, pool_temp: 20 }, { id: 'paris', name: 'Noord / Parijs (Île-de-France)', hdd: 2200, pool_temp: 19 }, { id: 'centre', name: 'Centraal / Bourgogne', hdd: 2500, pool_temp: 19 }, { id: 'est', name: 'Oost / Elzas‑Lotharingen', hdd: 2800, pool_temp: 18 }, { id: 'mont', name: 'Bergen (koel)', hdd: 3400, pool_temp: 17 }, ];
    const PV_YIELD = { med: 1450, ouest: 1250, paris: 1150, centre: 1200, est: 1150, mont: 1100 };
    const DEFAULT_APPLIANCES = [ { key: 'fridge', label: 'Koelkast/vriezer', kwh: 250, on: true }, { key: 'wash', label: 'Wassen/drogen', kwh: 220, on: true }, { key: 'dish', label: 'Vaatwasser', kwh: 160, on: true }, { key: 'it', label: 'IT & randapparatuur', kwh: 150, on: true }, { key: 'tv', label: 'TV & media', kwh: 120, on: true }, { key: 'small', label: 'Kleine verbruikers', kwh: 150, on: true }, { key: 'lighting', label: 'Verlichting (LED)', kwh: 180, on: true }, ];
    const PRICE_DEFAULTS_USER = { elec: 0.25, gas: 1.20, fioul: 1.15, pellet: 0.60, wood: 85, propaan: 1.80, petroleum: 2.00 };
    const ENERGY_UNITS = { elec: '€/kWh', gas: '€/m³', fioul: '€/L', pellet: '€/kg', wood: '€/stère', propaan: '€/L', petroleum: '€/L' };
    const KWH_CONVERSION = { elec: 1, gas: 10, fioul: 10, pellet: 5, wood: 1800, propaan: 7.1, petroleum: 10 };
    const HEAT_MAIN = [ { key: 'elec', label: 'Elektrisch (direct)', eff: 1, priceKey: 'elec' }, { key: 'hp', label: 'Warmtepomp (SCOP)', eff: 3.0, priceKey: 'elec', scop: true }, { key: 'gas', label: 'Aardgas (ketel η)', eff: 0.9, priceKey: 'gas', eta: true }, { key: 'fioul', label: 'Fioul/mazout (η)', eff: 0.85, priceKey: 'fioul', eta: true }, { key: 'pellet', label: 'Pellet‑CV (η)', eff: 0.9, priceKey: 'pellet', eta: true }, { key: 'wood', label: 'Hout‑CV (η)', eff: 0.7, priceKey: 'wood', eta: true }, ];
    const HEAT_AUX = [ { key: 'none', label: 'Geen bijverwarming', eff: 1, priceKey: null }, { key: 'inverter', label: 'Inverter‑airco (SCOP)', eff: 3.2, priceKey: 'elec', scop: true }, { key: 'elec', label: 'Elektrisch (direct)', eff: 1, priceKey: 'elec' }, { key: 'pellet', label: 'Houtpelletkachel (η)', eff: 0.85, priceKey: 'pellet', eta: true }, { key: 'wood', label: 'Houtkachel (η)', eff: 0.6, priceKey: 'wood', eta: true }, { key: 'petroleum', label: 'Petroleumkachel (η)', eff: 0.9, priceKey: 'petroleum', eta: true }, ];
    const DHW_TYPES = [ { key: 'elec', label: 'Boiler elektrisch', eff: 1, priceKey: 'elec' }, { key: 'gas', label: 'Gasgeiser/ketel (η)', eff: 0.9, priceKey: 'gas', eta: true }, { key: 'hp', label: 'WP‑boiler (SCOP)', eff: 2.5, priceKey: 'elec', scop: true }, { key: 'solar', label: 'Zonneboiler', eff: 2.0, priceKey: 'elec', note: 'Hulp‑elektra*' }, ];
    const POOL_HEAT = [ { key: 'none', label: 'Geen verwarming', eff: Infinity, priceKey: null }, { key: 'elec', label: 'Elektrisch', eff: 1, priceKey: 'elec' }, { key: 'gas', label: 'Gas (η)', eff: 0.9, priceKey: 'gas', eta: true }, { key: 'hp', label: 'Warmtepomp (SCOP)', eff: 4, priceKey: 'elec', scop: true }, ];
    const U_PRESETS = { wall: {'Ongeïsoleerd (~1975)': 2.0, 'Matig (~5cm)': 0.8, 'Goed (~10cm)': 0.4, 'Zeer goed (15cm+)': 0.25}, roof: {'Ongeïsoleerd': 3.0, 'Matig (~10cm)': 0.5, 'Goed (~20cm)': 0.25, 'Zeer goed (30cm+)': 0.15}, floor: {'Op zand': 2.2, 'Kruipruimte': 1.2, 'Matig geïsoleerd': 0.8, 'Goed geïsoleerd': 0.3}, win: {'Enkel glas': 5.5, 'Oud dubbelglas': 2.8, 'Modern HR(+)': 1.6, 'Triple HR++': 1.0} };
    const FAQ_CONTENT = [ { q: "Hoe betrouwbaar is de uitkomst?", a: "De tool gebruikt fysisch onderbouwde formules en realistische default-waarden. Het blijft een benadering, geen officieel DPE/audit. Nauwkeurigheid stijgt met goede invoer." }, { q: "Wat betekenen U-waarde, R-waarde en Σ(U·A)?", a: "<b>U-waarde</b> (W/m²K): warmtedoorgang; hoe lager, hoe beter. <b>R-waarde</b> (m²K/W): warmteweerstand; hoe hoger, hoe beter. Het transmissieverlies wordt geschat via <b>Htr = Σ(U · A)</b>, in W/K." }, { q: "Wat is n (ACH) en Hvent?", a: "<b>n (ACH)</b> = luchtwisselingen per uur. Ventilatieverlies: <b>Hvent = 0,34 · n · V</b> (W/K), met V het verwarmde volume in m³. De factor 0,34 is een fysische constante voor lucht." }, { q: "Wat zijn HDD (graaddagen)?", a: "<b>HDD</b> (Heating Degree Days) is een maat voor de jaarlijkse stookbehoefte. Jaarwarmtevraag: <b>E ≈ H · HDD · 24 / 1000</b> (in kWh/j)." }, { q: "Wat is SCOP/COP?", a: "<b>SCOP</b> (Seasonal COP) is de seizoensprestatie van een warmtepomp. Elektriciteitsvraag ≈ warmtevraag / SCOP. Bij vorst daalt de momentane COP." } ];

    // --- Helper Components ---
    const fmt = new Intl.NumberFormat('nl-NL', { maximumFractionDigits: 0 });
    const money = (x) => new Intl.NumberFormat('nl-NL', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 }).format(x);
    const num = (v, d = 0) => { const n = parseFloat(String(v).replace(',', '.')); return Number.isFinite(n) ? n : d; };

    const Icon = ({ path, className = "w-6 h-6" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className={className}><path d={path} /></svg>;
    const icons = { building: "M3.75 21.75a.75.75 0 01.75-.75h15a.75.75 0 010 1.5h-15a.75.75 0 01-.75-.75zM4.5 9.75a.75.75 0 01.75-.75h13.5a.75.75 0 010 1.5H5.25a.75.75 0 01-.75-.75zM4.5 15.75a.75.75 0 01.75-.75h13.5a.75.75 0 010 1.5H5.25a.75.75 0 01-.75-.75zM8.25 2.25a.75.75 0 01.75.75v16.5a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM15.75 2.25a.75.75 0 01.75.75v16.5a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75z", fire: "M15.362 4.362a1.75 1.75 0 012.474 0 1.75 1.75 0 010 2.474l-5.333 5.333-3.724-3.724a.75.75 0 011.06-1.06l2.664 2.664 5.333-5.333a.75.75 0 01-1.06-1.06l-5.333 5.333-2.664-2.664a1.75 1.75 0 010-2.474 1.75 1.75 0 012.474 0l2.664 2.664 5.333-5.333z", bolt: "M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.25 4.5h13.5c.828 0 1.5.672 1.5 1.5v3.75c0 .828-.672 1.5-1.5 1.5H5.25c-.828 0-1.5-.672-1.5-1.5V6c0-.828.672-1.5 1.5-1.5z", beaker: "M9.75 21.75a.75.75 0 01-.75-.75V11.25a.75.75 0 011.5 0v9.75a.75.75 0 01-.75-.75zM14.25 21.75a.75.75 0 01-.75-.75V11.25a.75.75 0 011.5 0v9.75a.75.75 0 01-.75-.75zM12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm0 18a8.25 8.25 0 100-16.5 8.25 8.25 0 000 16.5z", currency: "M12 1.5a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0112 1.5zM18.75 6a.75.75 0 000-1.5h-1.5a.75.75 0 000 1.5h1.5zM12 21a.75.75 0 01-.75-.75v-1.5a.75.75 0 011.5 0v1.5A.75.75 0 0112 21zM5.25 6a.75.75 0 000-1.5h-1.5a.75.75 0 000 1.5h1.5z", faq: "M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z", debug: "M11.42 15.17L17.17 20.92M5.58 11.42L11.33 17.17M12.75 5.58L18.5 11.33M6.92 6.92L12.67 12.67M3.08 15.17L8.83 20.92M9.75 3.08L15.5 8.83M16.58 5.58L22.33 11.33M11.33 1.25L17.08 7M18.5 1.25L24.25 7" };
    
    const Tooltip = ({ text }) => (
      <div className="tooltip">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-4 h-4 text-gray-400 cursor-help"><path strokeLinecap="round" strokeLinejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z" /></svg>
        <span className="tooltip-text">{text}</span>
      </div>
    );
    
    const AccordionSection = ({ icon, title, number, children, initiallyOpen = false }) => {
        const [isOpen, setIsOpen] = useState(initiallyOpen);
        return (
            <div className="bg-white border border-gray-200 rounded-xl shadow-sm">
                <button onClick={() => setIsOpen(!isOpen)} className="w-full flex items-center justify-between p-4 text-left">
                    <div className="flex items-center gap-4">
                        <div className="w-8 h-8 flex items-center justify-center bg-gray-100 rounded-full text-[var(--brand-color)]">{icon}</div>
                        <span className="font-semibold text-lg text-gray-800">{number}. {title}</span>
                    </div>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className={`w-5 h-5 text-gray-500 transition-transform duration-300 ${isOpen ? 'rotate-180' : ''}`}><path fillRule="evenodd" d="M5.22 8.22a.75.75 0 011.06 0L10 11.94l3.72-3.72a.75.75 0 111.06 1.06l-4.25 4.25a.75.75 0 01-1.06 0L5.22 9.28a.75.75 0 010-1.06z" clipRule="evenodd" /></svg>
                </button>
                <div className={`grid transition-[grid-template-rows] duration-500 ease-in-out ${isOpen ? 'grid-rows-[1fr]' : 'grid-rows-[0fr]'}`}>
                    <div className="overflow-hidden"><div className="p-4 pt-0">{children}</div></div>
                </div>
            </div>
        );
    };

    const NumberInput = ({ label, value, onChange, unit, tooltip, ...props }) => (
      <div>
          <label className="block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1">{label} {tooltip && <Tooltip text={tooltip} />}</label>
          <div className="flex">
              <input type="text" inputMode="decimal" value={value} onChange={e => onChange(e.target.value)} className="w-full p-2 border-gray-300 border rounded-l-md text-sm" {...props} />
              {unit && <span className="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">{unit}</span>}
          </div>
      </div>
    );
    
    // --- Main App Component ---
    function App() {
        // --- State declarations ---
        const [zone, setZone] = useState('paris');
        const [setpoint, setSetpoint] = useState('20');
        const [wallA, setWallA] = useState('120'), [wallU, setWallU] = useState('0.5');
        const [roofA, setRoofA] = useState('100'), [roofU, setRoofU] = useState('0.25');
        const [floorA, setFloorA] = useState('100'), [floorU, setFloorU] = useState('0.35');
        const [winA, setWinA] = useState('20'), [winU, setWinU] = useState('1.5');
        const [volume, setVolume] = useState('250');
        const [ach, setAch] = useState('0.5');
        const [warmupPct, setWarmupPct] = useState('15');
        const [userPrices, setUserPrices] = useState({ ...PRICE_DEFAULTS_USER });
        const [mainType, setMainType] = useState('hp');
        const [mainScop, setMainScop] = useState('3.2');
        const [mainEta, setMainEta] = useState('0.9');
        const [auxType, setAuxType] = useState('wood');
        const [auxSharePreset, setAuxSharePreset] = useState('25');
        const [auxShareCustom, setAuxShareCustom] = useState('25');
        const [auxScop, setAuxScop] = useState('3.2');
        const [auxEta, setAuxEta] = useState('0.85');
        const [pvKwp, setPvKwp] = useState('3');
        const [pvSelfUse, setPvSelfUse] = useState('60');
        const [dhwType, setDhwType] = useState('hp');
        const [dhwScop, setDhwScop] = useState('2.5');
        const [dhwEta, setDhwEta] = useState('0.9');
        const [showers, setShowers] = useState('2');
        const [litersPer, setLitersPer] = useState('55');
        const [coldT, setColdT] = useState('12');
        const [hotT, setHotT] = useState('40');
        const [appls, setAppls] = useState(DEFAULT_APPLIANCES);
        const [evKmWeek, setEvKmWeek] = useState('100');
        const [evKwh100, setEvKwh100] = useState('18');
        const [evLoss, setEvLoss] = useState('10');
        const [poolHas, setPoolHas] = useState(false);
        const [poolVol, setPoolVol] = useState('30');
        const [poolTargetT, setPoolTargetT] = useState('27');
        const [poolSeason, setPoolSeason] = useState('5');
        const [poolHeatType, setPoolHeatType] = useState('hp');
        const [poolHpScop, setPoolHpScop] = useState('4');
        const [poolEta, setPoolEta] = useState('0.9');
        const [poolPumpW, setPoolPumpW] = useState('450');
        const [poolPumpH, setPoolPumpH] = useState('8');
        const [poolCover, setPoolCover] = useState('true');
        const [poolWind, setPoolWind] = useState('1');
        const pdfSummaryRef = useRef(null);

        // --- Calculations ---
        const results = useMemo(() => {
            const pricesKwh = Object.keys(userPrices).reduce((acc, key) => {
                acc[key] = num(userPrices[key]) / (KWH_CONVERSION[key] || 1);
                return acc;
            }, {});
            
            const auxShare = auxSharePreset === 'custom' ? num(auxShareCustom) : num(auxSharePreset);

            const hdd = ZONES.find(z => z.id === zone)?.hdd || 2200;
            const UA = num(wallA) * num(wallU) + num(roofA) * num(roofU) + num(floorA) * num(floorU) + num(winA) * num(winU);
            const Vloss = 0.34 * num(volume) * num(ach);
            const heatDemandBase = (UA + Vloss) * hdd * 24 / 1000;
            const heatDemand = heatDemandBase * (1 + num(warmupPct) / 100);
            
            const auxFrac = auxType === 'none' ? 0 : Math.min(0.9, num(auxShare) / 100);
            const mainFrac = 1 - auxFrac;
            
            const mainDef = HEAT_MAIN.find(h => h.key === mainType);
            const auxDef = HEAT_AUX.find(h => h.key === auxType) || {};
            const mainEff = mainDef?.scop ? num(mainScop, 3.2) : (mainDef?.eta ? num(mainEta, 0.9) : (mainDef?.eff || 1));
            const auxEff = auxDef?.scop ? num(auxScop, 3.2) : (auxDef?.eta ? num(auxEta, 0.85) : 1);
            const mainInput = heatDemand * mainFrac / mainEff;
            const auxInput = auxDef.key === 'none' ? 0 : (heatDemand * auxFrac / auxEff);
            const mainCost = (pricesKwh[mainDef?.priceKey] || 0) * mainInput;
            const auxCost = (pricesKwh[auxDef?.priceKey] || 0) * auxInput;

            const pvYield = num(pvKwp) > 0 ? num(pvKwp) * (PV_YIELD[zone] || 1150) : 0;
            const pvSelf = pvYield * (num(pvSelfUse) / 100);
            
            const dhwThermal = (num(showers) * num(litersPer) * 365 * Math.max(0, num(hotT) - num(coldT)) * 4.186) / 3600;
            const dhwDef = DHW_TYPES.find(d => d.key === dhwType);
            const dhwEff = dhwDef?.scop ? num(dhwScop, 2.5) : (dhwDef?.eta ? num(dhwEta, 0.9) : 1);
            const dhwInput = dhwThermal / dhwEff;
            const dhwCost = (pricesKwh[dhwDef?.priceKey] || 0) * dhwInput;
            
            const applKwh = appls.reduce((s, a) => s + (a.on ? num(a.kwh, 0) : 0), 0);
            const evKwhYear = (num(evKmWeek) * 52) * (num(evKwh100) / 100) * (1 + num(evLoss) / 100);

            let pool = { kwh: 0, cost: 0, elec: 0, gas: 0 };
            if (poolHas) {
                const days = num(poolSeason) * 30;
                const pumpKwh = (num(poolPumpW) / 1000) * num(poolPumpH) * days;
                const ambientTemp = ZONES.find(z => z.id === zone)?.pool_temp || 19;
                const deltaT = Math.max(0, num(poolTargetT) - ambientTemp);
                const thermalLossFactor = (poolCover === 'true' ? 0.5 : 1.0) * num(poolWind);
                const thermalDaily = num(poolVol) * deltaT * 1.16 * thermalLossFactor;
                const thermal = thermalDaily * days;

                const def = POOL_HEAT.find(h => h.key === poolHeatType);
                const eff = def?.scop ? num(poolHpScop, 4) : (def?.eta ? num(poolEta, 0.9) : 1);
                const input = def.key === 'none' ? 0 : (thermal / eff);
                const elecUse = pumpKwh + (def?.priceKey === 'elec' ? input : 0);
                const gasUse = (def?.priceKey === 'gas' ? input : 0);
                const poolCost = elecUse * (pricesKwh.elec || 0) + gasUse * (pricesKwh.gas || 0);
                pool = { kwh: pumpKwh + input, cost: poolCost, elec: elecUse, gas: gasUse };
            }
            
            const elecHeatingInput = (mainDef?.priceKey === 'elec' ? mainInput : 0) + (auxDef?.priceKey === 'elec' ? auxInput : 0);
            const elecDhwInput = (dhwDef?.priceKey === 'elec') ? dhwInput : 0;
            const elecTotalGross = elecHeatingInput + elecDhwInput + applKwh + evKwhYear + pool.elec;
            const elecNet = Math.max(0, elecTotalGross - pvSelf);
            const pvSelfValue = pvSelf * (pricesKwh.elec || 0);

            const nonElecHeatingCost = (mainDef?.priceKey !== 'elec' ? mainCost : 0) + (auxDef?.priceKey !== 'elec' ? auxCost : 0);
            const nonElecDhwCost = (dhwDef?.priceKey !== 'elec' ? dhwCost : 0);
            const nonElecPoolCost = pool.gas * (pricesKwh.gas || 0);
            
            const totalCost = (elecNet * pricesKwh.elec) + nonElecHeatingCost + nonElecDhwCost + nonElecPoolCost;

            return {
                totalCost, perMonth: totalCost / 12,
                heatDemand,
                costs: { verwarming: mainCost + auxCost, tapwater: dhwCost, apparaten: applKwh * pricesKwh.elec, ev: evKwhYear * pricesKwh.elec, zwembad: pool.cost, pvWaarde: -pvSelfValue },
                verbruik: { nettoElec: elecNet, brutoElec: elecTotalGross, pvEigen: pvSelf, warmte: mainInput + auxInput, tapwater: dhwInput, overig: applKwh + evKwhYear + pool.kwh },
                inputs: { zone, setpoint, wallA, wallU, roofA, roofU, floorA, floorU, winA, winU, volume, ach, mainType, auxType, dhwType, pvKwp, evKmWeek },
                debug: { heatDemand, mainFrac, auxFrac, mainEff, mainInput, auxInput, elecHeatingInput, elecTotalGross, pvSelf, elecNet, totalCost, UA, Vloss }
            };
        }, [ zone, setpoint, wallA, wallU, roofA, roofU, floorA, floorU, winA, winU, volume, ach, warmupPct, userPrices, mainType, mainScop, mainEta, auxType, auxSharePreset, auxShareCustom, auxScop, auxEta, pvKwp, pvSelfUse, dhwType, dhwScop, dhwEta, showers, litersPer, coldT, hotT, appls, evKmWeek, evKwh100, evLoss, poolHas, poolVol, poolTargetT, poolSeason, poolHeatType, poolHpScop, poolEta, poolPumpW, poolPumpH, poolCover, poolWind ]);

        const handlePdfDownload = () => {
          const { jsPDF } = window.jspdf;
          const content = pdfSummaryRef.current;
          if (content) {
            html2canvas(content, { scale: 2, useCORS: true }).then(canvas => {
              try {
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgData = canvas.toDataURL('image/png');
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const imgHeight = canvas.height * pdfWidth / canvas.width;
                
                pdf.setFontSize(16);
                pdf.text("Samenvatting Energiecalculator", 14, 15);
                
                // Fit image on one page, scaling if necessary
                const pageHeight = pdf.internal.pageSize.getHeight();
                let finalImgHeight = imgHeight;
                if (imgHeight > (pageHeight - 30)) {
                  finalImgHeight = pageHeight - 30;
                }
                
                pdf.addImage(imgData, 'PNG', 10, 25, pdfWidth - 20, finalImgHeight);
                pdf.save("samenvatting-energiecalculator.pdf");
              } catch(e) {
                console.error("PDF generation failed:", e);
                alert("Er is een fout opgetreden bij het genereren van de PDF.");
              }
            });
          }
        };
        
        const Select = ({ label, value, onChange, options, tooltip }) => (
            <div>
                <label className="block text-sm font-medium text-gray-700 mb-1 flex items-center gap-1">{label} {tooltip && <Tooltip text={tooltip} />}</label>
                <select value={value} onChange={e => onChange(e.target.value)} className="w-full p-2 border-gray-300 border rounded-md text-sm">
                    {options.map(o => <option key={o.key ?? o.id ?? o.value} value={o.key ?? o.id ?? o.value}>{o.label ?? o.name}</option>)}
                </select>
            </div>
        );

        const SummaryCard = ({ title, value, unit, children }) => (
            <div className="bg-gray-50 p-3 rounded-lg border border-gray-200">
                <div className="text-xs text-gray-600">{title}</div>
                <div className="text-xl font-bold text-[var(--brand-color)]">{fmt.format(value)} <span className="text-sm font-normal text-gray-500">{unit}</span></div>
                {children && <div className="text-xs text-gray-500 mt-1">{children}</div>}
            </div>
        );
        
        return (
            <div className="pb-20">
                <header className="bg-white border-b border-gray-200 p-4 no-print">
                    <div className="max-w-7xl mx-auto flex justify-between items-center">
                      <div>
                        <h1 className="text-2xl font-bold text-[var(--brand-color)]">Energie- & Kostencalculator Frankrijk</h1>
                        <p className="text-gray-600">Een compleet model voor uw woning: van isolatie tot zonnepanelen.</p>
                      </div>
                      <button onClick={handlePdfDownload} className="bg-[var(--brand-color)] text-white px-4 py-2 rounded-lg font-semibold flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-5 h-5"><path d="M10.75 2.75a.75.75 0 00-1.5 0v8.614L6.295 8.23a.75.75 0 00-1.09 1.03l4.25 4.5a.75.75 0 001.09 0l4.25-4.5a.75.75 0 00-1.09-1.03l-2.955 3.134V2.75z" /><path d="M3.5 12.75a.75.75 0 00-1.5 0v2.5A2.75 2.75 0 004.75 18h10.5A2.75 2.75 0 0018 15.25v-2.5a.75.75 0 00-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5z" /></svg>
                        Download Samenvatting
                      </button>
                    </div>
                </header>

                <main className="max-w-7xl mx-auto p-4 grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div className="lg:col-span-2 space-y-4">
                        <AccordionSection number={1} title="Klimaat & Woning" icon={<Icon path={icons.building} />} initiallyOpen={true}>
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <Select label="Klimaatzone" value={zone} onChange={setZone} options={ZONES} />
                                <NumberInput label="Binnen temperatuur" value={setpoint} onChange={setSetpoint} unit="°C" />
                                <NumberInput label="Verwarmd volume" value={volume} onChange={setVolume} unit="m³" />
                                <NumberInput label="Luchtwisseling (n)" value={ach} onChange={setAch} unit="1/uur" step="0.1" tooltip="Een maat voor kieren en ventilatie. Kies 0,5 voor een modern, goed geïsoleerd huis; 1,0-1,5 voor een ouder, 'ademend' huis."/>
                            </div>
                            <div className="mt-4 p-4 bg-gray-50 rounded-lg border">
                              <h3 className="text-md font-semibold mb-3">Isolatie (Oppervlakte & U-waarde)</h3>
                              <div className="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                                {Object.entries(U_PRESETS).map(([key, presets]) => {
                                  const name = {wall:'Muur', roof:'Dak', floor:'Vloer', win:'Ramen'}[key];
                                  const area = {wall:wallA, roof:roofA, floor:floorA, win:winA}[key];
                                  const uValue = {wall:wallU, roof:roofU, floor:floorU, win:winU}[key];
                                  const setArea = {wall:setWallA, roof:setRoofA, floor:setFloorA, win:setWinA}[key];
                                  const setUValue = {wall:setWallU, roof:setRoofU, floor:setFloorU, win:setWinU}[key];

                                  return (<div key={key}>
                                    <div className="grid grid-cols-2 gap-2">
                                      <NumberInput label={`${name} (A)`} value={area} onChange={setArea} unit="m²" />
                                      <NumberInput label="U-waarde" value={uValue} onChange={setUValue} unit="U" step="0.05" tooltip="Warmtedoorgangscoëfficiënt. Hoe lager, hoe beter de isolatie."/>
                                    </div>
                                    <div className="flex flex-wrap gap-1 mt-2">
                                      {Object.entries(presets).map(([label, value]) => (
                                        <button key={label} onClick={() => setUValue(String(value))} className="text-xs px-2 py-1 bg-gray-200 hover:bg-gray-300 rounded">{label}</button>
                                      ))}
                                    </div>
                                  </div>)
                                })}
                              </div>
                            </div>
                        </AccordionSection>

                        <AccordionSection number={2} title="Verwarming & Tapwater" icon={<Icon path={icons.fire} />}>
                             <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h3 className="font-semibold mb-2">Ruimteverwarming</h3>
                                    <div className="space-y-4">
                                        <Select label="Hoofdverwarming" value={mainType} onChange={setMainType} options={HEAT_MAIN} />
                                        {mainType === 'hp' && <NumberInput label="SCOP Hoofd-WP" value={mainScop} onChange={setMainScop} step="0.1" tooltip="Seizoensgemiddeld rendement van de warmtepomp. Bijv. 3.2 betekent dat 1 kWh elektra 3.2 kWh warmte levert." />}
                                        {HEAT_MAIN.find(h=>h.key===mainType)?.eta && <NumberInput label="Rendement η Hoofd" value={mainEta} onChange={setMainEta} step="0.01" tooltip="Efficiëntie van de ketel. 0.9 = 90% van de brandstof wordt nuttige warmte."/>}
                                        <Select label="Bijverwarming" value={auxType} onChange={setAuxType} options={HEAT_AUX} />
                                        {auxType !== 'none' && (<div>
                                          <Select label="Aandeel bijverwarming" value={auxSharePreset} onChange={setAuxSharePreset} options={[ {value: '10', label: 'Incidenteel (~10%)'}, {value: '25', label: 'Regelmatig (~25%)'}, {value: '50', label: 'Vaak (~50%)'}, {value: '70', label: 'Bijna dagelijks (~70%)'}, {value: 'custom', label: 'Zelf invullen...'} ]} />
                                          {auxSharePreset === 'custom' && <NumberInput label="Zelf invullen" value={auxShareCustom} onChange={setAuxShareCustom} unit="%" />}
                                        </div>)}
                                        {auxType === 'inverter' && <NumberInput label="SCOP Bij-WP (Airco)" value={auxScop} onChange={setAuxScop} step="0.1" tooltip="Seizoensgemiddeld rendement van de airco in verwarmingsmodus."/>}
                                        {HEAT_AUX.find(h=>h.key===auxType)?.eta && <NumberInput label="Rendement η Bij" value={auxEta} onChange={setAuxEta} step="0.01" tooltip="Efficiëntie van de kachel/haard. Een open haard heeft een zeer laag rendement."/>}
                                    </div>
                                </div>
                                 <div>
                                    <h3 className="font-semibold mb-2">Warm Tapwater (ECS)</h3>
                                    <div className="space-y-4">
                                         <Select label="Type tapwater systeem" value={dhwType} onChange={setDhwType} options={DHW_TYPES} />
                                         {dhwType === 'hp' && <NumberInput label="SCOP WP-boiler" value={dhwScop} onChange={setDhwScop} step="0.1" />}
                                         {DHW_TYPES.find(d=>d.key===dhwType)?.eta && <NumberInput label="Rendement η" value={dhwEta} onChange={setDhwEta} step="0.01" />}
                                         <NumberInput label="Douches per dag" value={showers} onChange={setShowers} step="0.5" />
                                         <NumberInput label="Liters per douche" value={litersPer} onChange={setLitersPer} unit="L" />
                                    </div>
                                </div>
                             </div>
                        </AccordionSection>
                        
                        <AccordionSection number={3} title="Elektra: Verbruikers & PV" icon={<Icon path={icons.bolt} />}>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h3 className="font-semibold mb-2">Zonnepanelen (PV)</h3>
                                    <div className="space-y-4">
                                        <NumberInput label="PV Systeem" value={pvKwp} onChange={setPvKwp} unit="kWp" step="0.1" />
                                        <NumberInput label="Eigenverbruik" value={pvSelfUse} onChange={setPvSelfUse} unit="%" tooltip="Percentage van de opgewekte zonnestroom dat u direct zelf verbruikt. De rest wordt aan het net geleverd."/>
                                    </div>
                                    <h3 className="font-semibold mb-2 mt-6">Elektrische Auto (EV)</h3>
                                    <div className="space-y-4">
                                        <NumberInput label="Kilometers per week" value={evKmWeek} onChange={setEvKmWeek} unit="km" />
                                        <NumberInput label="Verbruik" value={evKwh100} onChange={setEvKwh100} unit="kWh/100km" />
                                    </div>
                                </div>
                                <div>
                                    <h3 className="font-semibold mb-2">Apparaten & Verlichting</h3>
                                    <div className="space-y-2">
                                        {appls.map((a, idx) => (
                                            <div key={a.key} className="flex items-center justify-between bg-gray-50 p-2 rounded-md border">
                                                <label className="flex items-center gap-2 text-sm">
                                                    <input type="checkbox" checked={a.on} onChange={e => setAppls(appls.map((item, i) => i === idx ? { ...item, on: e.target.checked } : item))} />
                                                    {a.label}
                                                </label>
                                                <input type="text" inputMode="decimal" value={a.kwh} onChange={e => setAppls(appls.map((item, i) => i === idx ? { ...item, kwh: e.target.value } : item))} className="w-20 p-1 border rounded text-sm text-right" />
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </AccordionSection>
                        
                        <AccordionSection number={4} title="Optioneel: Zwembad" icon={<Icon path={icons.beaker} />}>
                             <label className="flex items-center gap-2 mb-4">
                                <input type="checkbox" checked={poolHas} onChange={e => setPoolHas(e.target.checked)} />
                                Activeer zwembadmodule
                            </label>
                            {poolHas && <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <NumberInput label="Volume" value={poolVol} onChange={setPoolVol} unit="m³" />
                                <NumberInput label="Doel temperatuur" value={poolTargetT} onChange={setPoolTargetT} unit="°C" />
                                <NumberInput label="Seizoen" value={poolSeason} onChange={setPoolSeason} unit="mnd" />
                                <Select label="Verwarming" value={poolHeatType} onChange={setPoolHeatType} options={POOL_HEAT} />
                                {poolHeatType === 'hp' && <NumberInput label="SCOP WP" value={poolHpScop} onChange={setPoolHpScop} step="0.1" />}
                                <NumberInput label="Pomp vermogen" value={poolPumpW} onChange={setPoolPumpW} unit="W" />
                                <NumberInput label="Pomp uren/dag" value={poolPumpH} onChange={setPoolPumpH} unit="uur" />
                                <Select label="Afdekking" value={poolCover} onChange={e => setPoolCover(e.target.value)} options={[{value: 'true', label: 'Ja'}, {value: 'false', label: 'Nee'}]} />
                            </div>}
                        </AccordionSection>

                        <AccordionSection number={5} title="Energieprijzen" icon={<Icon path={icons.currency} />}>
                           <p className="text-xs text-gray-500 mb-4">Voer hier uw eigen tarieven in per gangbare eenheid. De calculator rekent dit om naar een prijs per kWh voor de berekening. Dit zijn indicatieve waarden, geen live data.</p>
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                {Object.keys(ENERGY_UNITS).map(key => (
                                    <NumberInput key={key} label={{'elec':'Elektriciteit', 'gas':'Gas', 'fioul':'Fioul', 'pellet':'Houtpellets', 'wood':'Stookhout', 'propaan':'Propaan', 'petroleum':'Petroleum'}[key]} value={userPrices[key]} onChange={val => setUserPrices(p => ({ ...p, [key]: val }))} unit={ENERGY_UNITS[key]} step="0.01" />
                                ))}
                            </div>
                        </AccordionSection>
                        
                        <AccordionSection number={6} title="Veelgestelde Vragen & Rekenregels" icon={<Icon path={icons.faq} />}>
                           {FAQ_CONTENT.map(item => (
                             <details key={item.q} className="mb-2"><summary className="cursor-pointer font-medium text-sm">{item.q}</summary><p className="mt-2 text-sm text-neutral-700 pl-4 border-l-2 ml-2" dangerouslySetInnerHTML={{__html: item.a}}></p></details>
                           ))}
                           <h4 className="font-semibold mt-4 mb-2">Rekengrondslagen (kort overzicht)</h4>
                           <ul className="text-xs text-neutral-600 space-y-1 list-disc pl-5">
                            <li>Transmissie: Htr = Σ(U · A) [W/K]</li>
                            <li>Ventilatie: Hvent = 0,34 · n · V [W/K]</li>
                            <li>Jaarwarmtevraag: E ≈ (Htr + Hvent) · HDD · 24 / 1000 [kWh/j]</li>
                            <li>Warmtepomp/airco: el-vraag = warmtevraag / SCOP</li>
                           </ul>
                        </AccordionSection>

                        <AccordionSection number={7} title="Debug Paneel (voor controle)" icon={<Icon path={icons.debug} />}>
                           <div className="text-xs font-mono bg-gray-800 text-white p-4 rounded-lg overflow-x-auto">
                            <h4 className="font-semibold mb-2 text-yellow-400">Reken-Audit</h4>
                            <p>UA (transmissie): {results.debug.UA.toFixed(2)} W/K</p><p>Hvent (ventilatie): {results.debug.Vloss.toFixed(2)} W/K</p>
                            <p>Warmtevraag: {fmt.format(results.debug.heatDemand)} kWh</p>
                            <p>Verdeling H/B: {fmt.format(results.debug.mainFrac*100)}% / {fmt.format(results.debug.auxFrac*100)}%</p>
                            <p>Efficiëntie Hoofd: {results.debug.mainEff.toFixed(2)}</p>
                            <p>Input Hoofd: {fmt.format(results.debug.mainInput)} kWh</p>
                            <p>Input Bij: {fmt.format(results.debug.auxInput)} kWh</p>
                            <p className="mt-2 border-t border-gray-600 pt-2">Totaal Elektra Bruto: {fmt.format(results.debug.elecTotalGross)} kWh</p>
                            <p>PV Eigen Verbruik: {fmt.format(results.debug.pvSelf)} kWh</p>
                            <p>Totaal Elektra Netto: {fmt.format(results.debug.elecNet)} kWh</p>
                            <p className="mt-2 border-t border-gray-600 pt-2 font-bold text-green-400">Eindkosten: {money(results.debug.totalCost)}</p>
                           </div>
                        </AccordionSection>
                    </div>

                    <div className="lg:col-span-1 space-y-4 lg:sticky top-4 self-start no-print">
                        <div className="bg-white p-4 rounded-xl border border-gray-200 shadow-lg">
                            <div className="text-center">
                                <div className="text-sm text-gray-600">Totale Geschatte Jaarkosten</div>
                                <div className="text-4xl font-bold my-2 text-[var(--brand-color)]">{money(results.totalCost)}</div>
                                <div className="text-gray-500">{money(results.perMonth)} / maand</div>
                            </div>
                            <div className="mt-4 space-y-2 border-t pt-4">
                                {Object.entries(results.costs).map(([key, value]) => (
                                    <div key={key} className="flex justify-between text-sm">
                                        <span className="text-gray-600 capitalize">{key.replace('Waarde', ' Waarde')}</span>
                                        <span className={`font-medium ${value < 0 ? 'text-green-600' : 'text-gray-800'}`}>{money(value)}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                         <div className="bg-white p-4 rounded-xl border border-gray-200">
                             <h3 className="font-semibold mb-2">Energiebalans (per jaar)</h3>
                             <div className="space-y-3">
                                 <SummaryCard title="Netto Elektra van net" value={results.verbruik.nettoElec} unit="kWh">Bruto: {fmt.format(results.verbruik.brutoElec)} kWh | PV Eigen: {fmt.format(results.verbruik.pvEigen)} kWh</SummaryCard>
                                 <SummaryCard title="Warmte (input, alle bronnen)" value={results.verbruik.warmte} unit="kWh eq." />
                                 <SummaryCard title="Tapwater (input)" value={results.verbruik.tapwater} unit="kWh" />
                                 <SummaryCard title="Overig (App, EV, Zwembad)" value={results.verbruik.overig} unit="kWh" />
                             </div>
                         </div>
                    </div>
                </main>
                
                <div className="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-sm border-t border-gray-200 p-3 no-print shadow-[0_-4px_12px_rgba(0,0,0,0.06)]">
                    <div className="max-w-7xl mx-auto flex items-center justify-center lg:justify-end">
                        <div className="text-center">
                            <div className="text-sm text-gray-600">Totale Jaarkosten</div>
                            <div className="text-2xl font-bold text-[var(--brand-color)]">{money(results.totalCost)}</div>
                        </div>
                    </div>
                </div>
                
                <div id="pdf-content-wrapper" className="hidden" ref={pdfSummaryRef}>
                  <div className="p-8 bg-white text-black">
                    <h2 className="text-2xl font-bold mb-6 text-black">Samenvatting Energiecalculator</h2>
                    <div className="grid grid-cols-2 gap-x-8 gap-y-3">
                      <div className="col-span-2 border-t pt-3 space-y-1">
                        <h3 className="text-lg font-semibold text-black">Resultaten</h3>
                        <p><b>Totale Jaarkosten:</b> {money(results.totalCost)}</p>
                        <p><b>Warmtevraag:</b> {fmt.format(results.heatDemand)} kWh/jaar</p>
                        <p><b>Netto Elektra van Net:</b> {fmt.format(results.verbruik.nettoElec)} kWh/jaar</p>
                      </div>
                      <div className="col-span-2 border-t pt-3 space-y-1">
                         <h3 className="text-lg font-semibold text-black">Invoer</h3>
                        <p><b>Klimaatzone:</b> {ZONES.find(z=>z.id === results.inputs.zone)?.name || 'n/a'}</p>
                        <p><b>Hoofdverwarming:</b> {HEAT_MAIN.find(h=>h.key === results.inputs.mainType)?.label || 'n/a'}</p>
                      </div>
                      <div className="col-span-2 border-t pt-3">
                        <h3 className="text-lg font-semibold text-black">Isolatie (U-waarden)</h3>
                        <p>Muur: {results.inputs.wallU} | Dak: {results.inputs.roofU} | Vloer: {results.inputs.floorU} | Ramen: {results.inputs.winU}</p>
                      </div>
                    </div>
                  </div>
                </div>
            </div>
        );
    }

    ReactDOM.createRoot(document.getElementById('app')).render(<App />);
  </script>
</body>
</html>