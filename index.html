<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Energie Prestatie Calculator ‚Äì InfoFrankrijk</title>
  <meta name="description" content="Een complete energiecalculator met warmteverlies (U¬∑A + ventilatie), HDD, kosten, hoofd- en bijverwarming, PV, zwembad en gedetailleerde toelichting."/>
  <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body { margin: 0; background: #f8f9fa; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, system-ui, Arial, sans-serif; }
    .text-brand { color: #800000; }
    .sticky-sidebar { position: sticky; top: 1rem; }
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,.6); display: flex; align-items: center; justify-content: center; padding: 1rem; z-index: 50; }
    .no-spin::-webkit-outer-spin-button, .no-spin::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .no-spin { -moz-appearance: textfield; }
    .tooltip-container { position: relative; display: inline-flex; align-items: center; }
    .tooltip-icon { cursor: pointer; }
    .tooltip-box { visibility: hidden; opacity: 0; transition: opacity 0.2s, visibility 0.2s; }
    .tooltip-container:hover .tooltip-box { visibility: visible; opacity: 1; }
  </style>
</head>
<body>
<div id="root"></div>
<script>
  // Fallback data in case an external API is not available
  const ENERGY_API = { getFallbackPrices() { return { electricity: 0.25, gas: 0.085, fioul_per_l: 1.15, pellets_per_kg: 0.35, wood_per_kwh: 0.05, petroleum_per_l: 1.80, source: "Invulbaar ¬∑ indicatief" }; } };
  window.ENERGY_API = ENERGY_API;
</script>
<script type="text/babel">
const { useState, useEffect, useMemo, useRef } = React;

// --- Helper Components & Data ---
const Icon = { calc: () => <>üßÆ</>, home: () => <>üè†</>, euro: () => <>üí∞</>, info: () => <>‚ÑπÔ∏è</>, chart: () => <>üìä</>, file: () => <>üìÑ</>, close: () => <>‚úï</> };

const Tooltip = ({ text }) => (
  <div className="tooltip-container ml-2">
    <span className="tooltip-icon text-brand font-bold">?</span>
    <div className="tooltip-box absolute bottom-full mb-2 w-64 bg-gray-800 text-white text-xs rounded py-1 px-2 z-10">
      {text}
    </div>
  </div>
);

const klimaatzones = {
  H1a: { naam: 'H1a - Noordoost (Reims, Metz)', factor: 1.2, gemTemp: -5, hdd: 2800, zon: 1050 },
  H1b: { naam: 'H1b - Noord/Centrum (Parijs, Lille)', factor: 1.1, gemTemp: -3, hdd: 2600, zon: 1100 },
  H1c: { naam: 'H1c - West (Brest, Caen)', factor: 1.0, gemTemp: 2, hdd: 2300, zon: 1000 },
  H2a: { naam: 'H2a - Midden-west (Poitiers, Tours)', factor: 0.9, gemTemp: 0, hdd: 2400, zon: 1250 },
  H2b: { naam: 'H2b - Midden-oost (Lyon, Dijon)', factor: 0.95, gemTemp: -2, hdd: 2500, zon: 1200 },
  H2c: { naam: 'H2c - Zuidwest (Bordeaux, Toulouse)', factor: 0.8, gemTemp: 3, hdd: 2100, zon: 1350 },
  H2d: { naam: 'H2d - Zuidoost (Avignon, Montpellier)', factor: 0.7, gemTemp: 4, hdd: 2000, zon: 1450 },
  H3:  { naam: 'H3 - Mediterraan (Nice, Marseille)', factor: 0.6, gemTemp: 6, hdd: 1600, zon: 1500 }
};

const uWAARDE_PRESETS = {
  muur:  { 'Onge√Øsoleerd (voor 1975)': 2.0, 'Licht ge√Øsoleerd (~5 cm)': 0.8, 'Goed (~10 cm)': 0.4, 'Zeer goed (‚â• 15 cm)': 0.25 },
  raam:  { 'Enkel glas': 5.5, 'Oud dubbelglas': 3.0, 'Modern HR(+)': 1.8, 'Triple HR++': 1.0 },
  dak:   { 'Onge√Øsoleerd': 3.0, 'Matig (~10 cm)': 0.5, 'Goed (~20 cm)': 0.25, 'Zeer goed (‚â• 30 cm)': 0.15 },
  vloer: { 'Onge√Øsoleerd': 2.2, 'Matig': 1.2, 'Redelijk': 0.8, 'Goed': 0.3 }
};

const gebruikOpties = {
  volledig: { naam: 'Volledig jaar', factor: 1.0 },
  secondaire_zomer: { naam: 'Vakantiewoning (zomer)', factor: 0.3 },
  secondaire_winter: { naam: 'Vakantiewoning (winter)', factor: 0.4 },
  weekend: { naam: 'Alleen weekends', factor: 0.25 }
};

function f0(x) { return (x || 0).toFixed(0); }
function f1(x) { return (x || 0).toFixed(1); }

// --- Main App Component ---
function App() {
  const [inputs, setInputs] = useState({
    // Isolatie & transmissie
    muurA: 100, raamA: 20, dakA: 80, vloerA: 80,
    muurU: 1.8, raamU: 5.0, dakU: 2.5, vloerU: 0.8,
    // Klimaat & gebruik
    t_in: 20, zone: 'H2a', gebruik: 'volledig', verwarmdeRuimtes: 'heel', ventilatieGedrag: 'normaal',
    // Ventilatie
    volume: 250, n_ach: 0.5,
    // HDD (override) & PV
    hddCustom: '', pvN: 0, pvOri: 'zuid', pvTilt: 'optimaal',
    // Verwarming ‚Äì hoofd & bij
    hoofd: 'gas', etaMain: 90, mainSCOP: 3.2,
    bij: 'geen', bijIntensity: 'incidenteel', bijSCOP: 3.0,
    // Prijzen
    elPrice: ENERGY_API.getFallbackPrices().electricity, gasPrice: ENERGY_API.getFallbackPrices().gas,
    fioulPrice: ENERGY_API.getFallbackPrices().fioul_per_l, pelletPrice: ENERGY_API.getFallbackPrices().pellets_per_kg,
    woodPrice: ENERGY_API.getFallbackPrices().wood_per_kwh, petroleumPrice: ENERGY_API.getFallbackPrices().petroleum_per_l,
    // Zwembad
    poolEnabled: false, poolA: 24, poolSeasonDays: 150, poolPumpW: 550, poolPumpH: 8,
    poolCover: 'solar', poolWind: 'normaal', poolHeat: 'geen', poolTargetT: 28, poolAirT: 22, poolSCOP: 4
  });

  const [showBreakdown, setShowBreakdown] = useState(false);
  const breakdownRef = useRef(null);

  const zone = klimaatzones[inputs.zone];
  const hdd = inputs.hddCustom !== '' ? Math.max(0, parseFloat(inputs.hddCustom) || 0) : zone.hdd;
  const t_out = zone.gemTemp;
  const dT = inputs.t_in - t_out;

  const results = useMemo(() => {
    const A = (a) => Math.max(0, parseFloat(a) || 0); const U = (u) => Math.max(0, parseFloat(u) || 0);
    // Transmissie & ventilatie
    const Htr = U(inputs.muurU) * A(inputs.muurA) + U(inputs.raamU) * A(inputs.raamA) + U(inputs.dakU) * A(inputs.dakA) + U(inputs.vloerU) * A(inputs.vloerA);
    const Hvent = 0.34 * Math.max(0, parseFloat(inputs.n_ach) || 0) * Math.max(0, parseFloat(inputs.volume) || 0);
    const Htot = Htr + Hvent;
    const P = Htot * dT;

    // Gedrag & gebruik
    const gf_room = inputs.verwarmdeRuimtes === 'leef' ? 0.7 : inputs.verwarmdeRuimtes === 'min' ? 0.5 : 1.0;
    const gf_vent = inputs.ventilatieGedrag === 'veel' ? 1.2 : inputs.ventilatieGedrag === 'open' ? 1.5 : 1.0;
    const useFactor = (gebruikOpties[inputs.gebruik]?.factor) || 1.0;
    const gf = gf_room * gf_vent;

    // Jaar-warmtevraag
    const E_kWh = Htot * hdd * 24 / 1000 * zone.factor * gf * useFactor;

    // Verdeling per element
    const dMuur = U(inputs.muurU) * A(inputs.muurA) * Htot * 24 * hdd / 1000; const dRaam = U(inputs.raamU) * A(inputs.raamA) * Htot * 24 * hdd / 1000;
    const dDak = U(inputs.dakU) * A(inputs.dakA) * Htot * 24 * hdd / 1000; const dVloer = U(inputs.vloerU) * A(inputs.vloerA) * Htot * 24 * hdd / 1000;
    const dVent = Hvent * Htot * 24 * hdd / 1000;
    const pct = (x) => E_kWh > 0 ? (x / (dMuur+dRaam+dDak+dVloer+dVent) * 100) : 0;

    // PV (indicatief)
    const oriFac = { zuid: 1.0, zuidwest: 0.95, zuidoost: 0.95, oost: 0.85, west: 0.85 };
    const tiltFac = { vlak: 0.85, optimaal: 1.0, steil: 0.9 };
    const pvYield = inputs.pvN * zone.zon * (oriFac[inputs.pvOri] || 1) * (tiltFac[inputs.pvTilt] || 1);
    let pvSelf = pvYield * 0.7;

    // Splitsing hoofd/bij op warmtevraag
    const bijMap = { incidenteel: 0.9, regelmatig: 0.7, hoofdverwarming: 0.2 };
    const hoofdFrac = inputs.bij === 'geen' ? 1.0 : (bijMap[inputs.bijIntensity] || 0.9);
    const kWhHoofd = E_kWh * hoofdFrac; const kWhBij = E_kWh - kWhHoofd;

    const p = { el: Math.max(0, +inputs.elPrice || 0), gas: Math.max(0, +inputs.gasPrice || 0), fioul: Math.max(0, +inputs.fioulPrice || 0), pellet: Math.max(0, +inputs.pelletPrice || 0), wood: Math.max(0, +inputs.woodPrice || 0), pet: Math.max(0, +inputs.petroleumPrice || 0) };

    const toCostMain = () => {
      const eta = Math.max(1, +inputs.etaMain || 90) / 100;
      if (inputs.hoofd === 'gas') return { el: 0, other: (kWhHoofd / eta) * p.gas };
      if (inputs.hoofd === 'fioul') return { el: 0, other: ((kWhHoofd / eta) / 10) * p.fioul };
      if (inputs.hoofd === 'elektrisch') { let elUsed = kWhHoofd; const elPay = Math.max(0, elUsed - pvSelf); pvSelf -= elUsed - elPay; return { el: elPay * p.el, other: 0 }; }
      if (inputs.hoofd === 'warmtepomp') { const scop = Math.max(1, +inputs.mainSCOP || 3.2); let elUsed = kWhHoofd / scop; const elPay = Math.max(0, elUsed - pvSelf); pvSelf -= elUsed - elPay; return { el: elPay * p.el, other: 0 }; }
      if (inputs.hoofd === 'hout') return { el: 0, other: (kWhHoofd / eta) * p.wood };
      if (inputs.hoofd === 'pellets') return { el: 0, other: ((kWhHoofd / eta) / 4.8) * p.pellet };
      return { el: 0, other: 0 };
    };

    const toCostBij = () => {
      if (kWhBij <= 0) return { el: 0, other: 0 };
      switch (inputs.bij) {
        case 'elektrisch': { let elUsed = kWhBij; const elPay = Math.max(0, elUsed - pvSelf); pvSelf -= elUsed - elPay; return { el: elPay * p.el, other: 0 }; }
        case 'inverter_ac': { const scop = Math.max(1, +inputs.bijSCOP || 3); let elUsed = kWhBij / scop; const elPay = Math.max(0, elUsed - pvSelf); pvSelf -= elUsed - elPay; return { el: elPay * p.el, other: 0 }; }
        case 'houtkachel': return { el: 0, other: (kWhBij / 0.75) * p.wood };
        case 'open_haard': return { el: 0, other: (kWhBij / 0.15) * p.wood };
        case 'pellets': return { el: 0, other: ((kWhBij / 0.88) / 4.8) * p.pellet };
        case 'petroleum': return { el: 0, other: ((kWhBij / 0.95) / 10) * p.pet };
        default: return { el: 0, other: 0 };
      }
    };

    const mainC = toCostMain();
    const bijC = toCostBij();

    // Zwembad
    let euro_pool_heat = 0, euro_pool_pump = 0;
    if (inputs.poolEnabled) {
      const days = Math.max(0, +inputs.poolSeasonDays || 0);
      const pool_pump_kWh = (Math.max(0, +inputs.poolPumpW || 0) / 1000) * Math.max(0, +inputs.poolPumpH || 0) * days;
      const Awater = Math.max(0, +inputs.poolA || 0);
      const dTpool = Math.max(0, (+inputs.poolTargetT || 28) - (+inputs.poolAirT || 22));
      let Ueff = 18; // W/m¬≤K indicatief
      const coverRed = { geen: 1.0, solar: 0.5, lamellen: 0.35 }[inputs.poolCover] || 1.0;
      const windFac = { beschut: 0.9, normaal: 1.0, winderig: 1.3 }[inputs.poolWind] || 1.0;
      Ueff = Ueff * coverRed * windFac;
      const Q = Ueff * Awater * dTpool * (days * 24) / 1000;
      if (inputs.poolHeat === 'wp') { const scop = Math.max(1, +inputs.poolSCOP || 4); let elUsed = Q / scop; const elPay = Math.max(0, elUsed - pvSelf); pvSelf -= elUsed - elPay; euro_pool_heat = elPay * p.el; }
      else if (inputs.poolHeat === 'elektra') { let elUsed = Q; const elPay = Math.max(0, elUsed - pvSelf); pvSelf -= elUsed - elPay; euro_pool_heat = elPay * p.el; }
      else if (inputs.poolHeat === 'gas') { euro_pool_heat = Q * p.gas; }
      let pumpElUsed = pool_pump_kWh; const pumpElPay = Math.max(0, pumpElUsed - pvSelf); pvSelf -= pumpElUsed - pumpElPay; euro_pool_pump = pumpElPay * p.el;
    }

    const totalEuro = mainC.el + mainC.other + bijC.el + bijC.other + euro_pool_heat + euro_pool_pump;

    return {
      Htr, Hvent, Htot, P, E_kWh,
      verdeling: { pct: { muur: pct(dMuur), raam: pct(dRaam), dak: pct(dDak), vloer: pct(dVloer), ventilatie: pct(dVent) } },
      costs: { heat_main: mainC.el + mainC.other, heat_bij: bijC.el + bijC.other, poolHeat: euro_pool_heat, poolPump: euro_pool_pump, total: totalEuro },
      pv: { yield: pvYield, selfUsedAfter: pvSelf }, dT, t_out
    };
  }, [inputs, zone, dT, hdd]);

  const update = (k, v) => setInputs(s => ({ ...s, [k]: v }));
  const setPreset = (type, key) => update(type + "U", uWAARDE_PRESETS[type][key]);

  function downloadPDF() {
    const { jsPDF } = window.jspdf; if (!breakdownRef.current) return;
    html2canvas(breakdownRef.current, { scale: 2 }).then(cv => { const pdf = new jsPDF('p', 'mm', 'a4'); const w = pdf.internal.pageSize.getWidth(); const h = cv.height * w / cv.width; pdf.addImage(cv.toDataURL('image/png'), 'PNG', 10, 10, w - 20, h - 20); pdf.save('energie-rapport.pdf'); });
  }

  return (
    <div className="max-w-6xl mx-auto p-4">
      <div className="bg-white p-5 rounded-lg shadow-sm text-center mb-4">
        <h1 className="text-2xl md:text-3xl font-bold text-brand flex items-center justify-center gap-2"><Icon.calc /> Energie Prestatie Calculator</h1>
        <p className="text-sm text-gray-600">Een complete module voor warmteverlies, jaarverbruik, kosten en renovatie-inzicht.</p>
      </div>

      <div className="flex flex-col lg:flex-row gap-4">
        {/* --- Left Column: Results --- */}
        <div className="lg:w-80 flex-shrink-0">
          <div className="sticky-sidebar">
            <div className="bg-white rounded-lg border shadow-sm p-4">
              <h3 className="font-bold text-brand mb-2"><Icon.euro /> Jaarlijkse energiekosten</h3>
              <div className="text-4xl font-extrabold tracking-tight text-gray-900">‚Ç¨{f0(results.costs.total)}</div>
              <div className="text-xs text-gray-600 mt-1">Ruimteverwarming, zwembad & PV-verrekening</div>
              <div className="grid grid-cols-2 gap-2 text-xs mt-3">
                <div className="bg-gray-50 rounded p-2"><div className="text-gray-500">Totaal H (W/K)</div><div className="font-semibold">{f1(results.Htot)}</div></div>
                <div className="bg-gray-50 rounded p-2"><div className="text-gray-500">ŒîT (K)</div><div className="font-semibold">{f1(results.dT)}</div></div>
                <div className="bg-gray-50 rounded p-2"><div className="text-gray-500">P ontwerp (W)</div><div className="font-semibold">{f0(results.P)}</div></div>
                <div className="bg-gray-50 rounded p-2"><div className="text-gray-500">Warmtevraag (kWh/j)</div><div className="font-semibold">{f0(results.E_kWh)}</div></div>
              </div>
              <button className="mt-3 w-full bg-brand text-white py-2 rounded hover:opacity-90" onClick={() => setShowBreakdown(true)}>Gedetailleerd overzicht</button>
            </div>
            <div className="bg-white rounded-lg border shadow-sm p-4 mt-4">
              <h3 className="font-bold text-brand mb-2"><Icon.chart /> Verdeling warmteverlies</h3>
              {results.E_kWh > 0 ? (
                <div className="flex items-end gap-2 h-44">
                  {['muur', 'raam', 'dak', 'vloer', 'ventilatie'].map(k => {
                    const v = results.verdeling.pct[k] || 0;
                    return (
                      <div key={k} className="flex-1 flex flex-col items-center">
                        <div className="text-xs text-gray-600 mb-1">{f0(v)}%</div>
                        <div className="w-full bg-brand rounded-t flex items-center justify-center text-white text-[10px]" style={{ height: `${Math.max(15, v * 1.5)}px` }}>{k}</div>
                      </div>
                    )
                  })}
                </div>
              ) : <div className="text-sm text-gray-500">Voer gegevens in om de verdeling te zien.</div>}
            </div>
          </div>
        </div>

        {/* --- Right Column: Inputs --- */}
        <div className="flex-1 space-y-4">
          <div className="bg-white rounded-lg border shadow-sm p-4">
            <h2 className="font-bold text-brand mb-3">1. Locatie & Jaarinschatting</h2>
            <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-3">
              <div>
                <label className="text-sm text-gray-700">Klimaatzone</label>
                <select value={inputs.zone} onChange={e => update('zone', e.target.value)} className="w-full p-2 border rounded"><option value="" disabled>Kies zone</option>{Object.keys(klimaatzones).map(z => <option key={z} value={z}>{klimaatzones[z].naam}</option>)}</select>
              </div>
              <div>
                <label className="text-sm text-gray-700">Gewenste T binnen (¬∞C)</label>
                <input type="number" className="w-full p-2 border rounded no-spin" value={inputs.t_in} step="0.5" onChange={e => update('t_in', e.target.value)} />
              </div>
              <div>
                <label className="text-sm text-gray-700 flex items-center">HDD (optioneel) <Tooltip text="Heating Degree Days (graaddagen). Een maat voor de jaarlijkse warmtevraag. Leeg laten om de standaardwaarde van de gekozen klimaatzone te gebruiken." /></label>
                <input type="number" className="w-full p-2 border rounded no-spin" placeholder={klimaatzones[inputs.zone].hdd} value={inputs.hddCustom} onChange={e => update('hddCustom', e.target.value)} />
              </div>
              <div>
                <label className="text-sm text-gray-700">Gebruik woning</label>
                <select value={inputs.gebruik} onChange={e => update('gebruik', e.target.value)} className="w-full p-2 border rounded">{Object.keys(gebruikOpties).map(g => <option key={g} value={g}>{gebruikOpties[g].naam}</option>)}</select>
              </div>
            </div>
          </div>

          <div className="bg-white rounded-lg border shadow-sm p-4">
            <h2 className="font-bold text-brand mb-3">2. Gebouw & Ventilatie</h2>
            <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-3">
               <div>
                <label className="text-sm text-gray-700">Verwarmd volume V (m¬≥)</label>
                <input type="number" className="w-full p-2 border rounded no-spin" value={inputs.volume} onChange={e => update('volume', e.target.value)} />
              </div>
              <div>
                <label className="text-sm text-gray-700 flex items-center">Ventilatie n (1/u) <Tooltip text="Luchtwisselingen per uur (ACH). 0.3-0.5 voor een modern, luchtdicht huis met mechanische ventilatie. 0.7-1.5 voor een ouder, 'ademend' huis." /></label>
                <input type="number" className="w-full p-2 border rounded no-spin" value={inputs.n_ach} step="0.05" onChange={e => update('n_ach', e.target.value)} />
              </div>
               <div>
                <label className="text-sm text-gray-700">Verwarmde ruimtes</label>
                <select value={inputs.verwarmdeRuimtes} onChange={e => update('verwarmdeRuimtes', e.target.value)} className="w-full p-2 border rounded"><option value="heel">Heel huis</option><option value="leef">Alleen leefruimtes</option><option value="min">Minimaal</option></select>
              </div>
              <div>
                <label className="text-sm text-gray-700">Ventilatiegedrag</label>
                <select value={inputs.verwarmdeRuimtes} onChange={e => update('ventilatieGedrag', e.target.value)} className="w-full p-2 border rounded"><option value="normaal">Normaal</option><option value="veel">Veel ventileren</option><option value="open">Ramen vaak open</option></select>
              </div>
            </div>
          </div>
          
          <div className="bg-white rounded-lg border shadow-sm p-4">
            <h2 className="font-bold text-brand mb-3">3. Isolatie & Oppervlaktes</h2>
            <div className="grid md:grid-cols-2 gap-4">
              {['muur', 'raam', 'dak', 'vloer'].map(k => (
                <div key={k}>
                  <label className="block text-sm font-medium text-gray-700 mb-1 flex items-center">{k.charAt(0).toUpperCase() + k.slice(1)} <Tooltip text={`U-waarde (W/m¬≤K) is de isolatiewaarde. Hoe lager, hoe beter. De presets zijn typische waarden.`} /></label>
                  <input type="number" className="w-full p-2 border rounded no-spin mb-2" placeholder="Oppervlakte A (m¬≤)" value={inputs[k + 'A']} onChange={e => update(k + 'A', e.target.value)} />
                  <div className="flex flex-wrap gap-1 mb-2">
                    {Object.keys(uWAARDE_PRESETS[k]).map(p => (<button key={p} onClick={() => setPreset(k, p)} className="px-2 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200">{p}</button>))}
                  </div>
                  <input type="number" step="0.01" className="w-full p-2 border rounded no-spin" placeholder={`U-waarde van ${k}`} value={inputs[k + 'U']} onChange={e => update(k + 'U', e.target.value)} />
                </div>
              ))}
            </div>
          </div>

          <div className="bg-white rounded-lg border shadow-sm p-4">
            <h2 className="font-bold text-brand mb-3">4. Verwarming & Zonnepanelen</h2>
            <div className="grid md:grid-cols-2 lg:grid-cols-5 gap-3">
              <div>
                <label className="text-sm text-gray-700">Hoofdverwarming</label>
                <select value={inputs.hoofd} onChange={e => update('hoofd', e.target.value)} className="w-full p-2 border rounded"><option value="gas">Gas</option><option value="fioul">Fioul</option><option value="elektrisch">Elektrisch (direct)</option><option value="warmtepomp">Warmtepomp (lucht-water)</option><option value="hout">Hout (CV)</option><option value="pellets">Pelletketel</option></select>
              </div>
              {inputs.hoofd === 'warmtepomp' ? (
                <div><label className="text-sm text-gray-700 flex items-center">SCOP <Tooltip text="Seasonal COP. Het seizoensgemiddelde rendement. Een SCOP van 3.5 betekent dat 1 kWh elektriciteit 3.5 kWh warmte levert over een heel jaar." /></label><input type="number" step="0.1" className="w-full p-2 border rounded no-spin" value={inputs.mainSCOP} onChange={e => update('mainSCOP', e.target.value)} /></div>
              ) : (
                <div><label className="text-sm text-gray-700">Rendement (%)</label><input type="number" className="w-full p-2 border rounded no-spin" value={inputs.etaMain} onChange={e => update('etaMain', e.target.value)} /></div>
              )}
              <div>
                <label className="text-sm text-gray-700">Bijverwarming</label>
                <select value={inputs.bij} onChange={e => update('bij', e.target.value)} className="w-full p-2 border rounded"><option value="geen">Geen</option><option value="houtkachel">Houtkachel</option><option value="open_haard">Open haard</option><option value="inverter_ac">Inverter airco (lucht-lucht)</option><option value="pellets">Pelletkachel</option><option value="petroleum">Petroleum</option><option value="elektrisch">Elektrisch</option></select>
              </div>
              <div>
                <label className="text-sm text-gray-700">Intensiteit 'bij'</label>
                <select value={inputs.bijIntensity} onChange={e => update('bijIntensity', e.target.value)} className="w-full p-2 border rounded" disabled={inputs.bij === 'geen'}><option value="incidenteel">Incidenteel (~10%)</option><option value="regelmatig">Regelmatig (~30%)</option><option value="hoofdverwarming">Hoog aandeel (~80%)</option></select>
              </div>
              {inputs.bij === 'inverter_ac' && (
                <div><label className="text-sm text-gray-700">SCOP (airco)</label><input type="number" step="0.1" className="w-full p-2 border rounded no-spin" value={inputs.bijSCOP} onChange={e => update('bijSCOP', e.target.value)} /></div>
              )}
            </div>
            <div className="grid md:grid-cols-3 gap-3 mt-3">
              <div>
                <label className="text-sm text-gray-700">PV-panelen (aantal)</label>
                <input type="number" className="w-full p-2 border rounded no-spin" value={inputs.pvN} onChange={e => update('pvN', e.target.value)} />
              </div>
              <div>
                <label className="text-sm text-gray-700">Ori√´ntatie</label>
                <select value={inputs.pvOri} onChange={e => update('pvOri', e.target.value)} className="w-full p-2 border rounded" disabled={inputs.pvN <= 0}><option value="zuid">Zuid</option><option value="zuidwest">Zuidwest</option><option value="zuidoost">Zuidoost</option><option value="oost">Oost</option><option value="west">West</option></select>
              </div>
              <div>
                <label className="text-sm text-gray-700">Hellingshoek</label>
                <select value={inputs.pvTilt} onChange={e => update('pvTilt', e.target.value)} className="w-full p-2 border rounded" disabled={inputs.pvN <= 0}><option value="optimaal">Optimaal (~35¬∞)</option><option value="vlak">Vlak</option><option value="steil">Steil (>45¬∞)</option></select>
              </div>
            </div>
          </div>
          
          <div className="bg-white rounded-lg border shadow-sm p-4">
            <h2 className="font-bold text-brand mb-3">5. Zwembad (Optioneel)</h2>
            <div className="flex items-center justify-between">
              <label className="flex items-center gap-2 text-sm font-medium"><input type="checkbox" checked={inputs.poolEnabled} onChange={e => update('poolEnabled', e.target.checked)} /> Zwembad meerekenen</label>
            </div>
            {inputs.poolEnabled && (
              <div className="grid md:grid-cols-3 gap-3 mt-3">
                <div><label className="text-sm text-gray-700">Oppervlak (m¬≤)</label><input type="number" className="w-full p-2 border rounded no-spin" value={inputs.poolA} onChange={e => update('poolA', e.target.value)} /></div>
                <div><label className="text-sm text-gray-700">Seizoen (dagen)</label><input type="number" className="w-full p-2 border rounded no-spin" value={inputs.poolSeasonDays} onChange={e => update('poolSeasonDays', e.target.value)} /></div>
                <div><label className="text-sm text-gray-700">Pompvermogen (W)</label><input type="number" className="w-full p-2 border rounded no-spin" value={inputs.poolPumpW} onChange={e => update('poolPumpW', e.target.value)} /></div>
                <div><label className="text-sm text-gray-700">Pompuren/dag</label><input type="number" className="w-full p-2 border rounded no-spin" value={inputs.poolPumpH} onChange={e => update('poolPumpH', e.target.value)} /></div>
                <div><label className="text-sm text-gray-700">Afdekking</label><select className="w-full p-2 border rounded" value={inputs.poolCover} onChange={e => update('poolCover', e.target.value)}><option value="geen">Geen</option><option value="solar">Solar cover</option><option value="lamellen">Lamellen</option></select></div>
                <div><label className="text-sm text-gray-700">Windblootstelling</label><select className="w-full p-2 border rounded" value={inputs.poolWind} onChange={e => update('poolWind', e.target.value)}><option value="beschut">Beschut</option><option value="normaal">Normaal</option><option value="winderig">Winderig</option></select></div>
                <div><label className="text-sm text-gray-700">Verwarming</label><select className="w-full p-2 border rounded" value={inputs.poolHeat} onChange={e => update('poolHeat', e.target.value)}><option value="geen">Geen</option><option value="wp">Warmtepomp</option><option value="elektra">Elektrisch</option><option value="gas">Gas</option></select></div>
                <div><label className="text-sm text-gray-700">Doel T (¬∞C)</label><input type="number" className="w-full p-2 border rounded no-spin" value={inputs.poolTargetT} onChange={e => update('poolTargetT', e.target.value)} /></div>
                {inputs.poolHeat === 'wp' && (<div><label className="text-sm text-gray-700">SCOP zwembad-WP</label><input type="number" step="0.1" className="w-full p-2 border rounded no-spin" value={inputs.poolSCOP} onChange={e => update('poolSCOP', e.target.value)} /></div>)}
              </div>
            )}
          </div>
          
          <div className="bg-white rounded-lg border shadow-sm p-4">
             <h2 className="font-bold text-brand mb-3">6. Energieprijzen</h2>
             <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-2">
                <div><label className="text-xs">Stroom ‚Ç¨/kWh</label><input type="number" step="0.001" className="w-full p-1 border rounded no-spin" value={inputs.elPrice} onChange={e => update('elPrice', e.target.value)} /></div>
                <div><label className="text-xs">Gas ‚Ç¨/kWh</label><input type="number" step="0.001" className="w-full p-1 border rounded no-spin" value={inputs.gasPrice} onChange={e => update('gasPrice', e.target.value)} /></div>
                <div><label className="text-xs">Fioul ‚Ç¨/L</label><input type="number" step="0.01" className="w-full p-1 border rounded no-spin" value={inputs.fioulPrice} onChange={e => update('fioulPrice', e.target.value)} /></div>
                <div><label className="text-xs">Pellets ‚Ç¨/kg</label><input type="number" step="0.01" className="w-full p-1 border rounded no-spin" value={inputs.pelletPrice} onChange={e => update('pelletPrice', e.target.value)} /></div>
                <div><label className="text-xs">Hout ‚Ç¨/kWh</label><input type="number" step="0.01" className="w-full p-1 border rounded no-spin" value={inputs.woodPrice} onChange={e => update('woodPrice', e.target.value)} /></div>
                <div><label className="text-xs">Petroleum ‚Ç¨/L</label><input type="number" step="0.01" className="w-full p-1 border rounded no-spin" value={inputs.petroleumPrice} onChange={e => update('petroleumPrice', e.target.value)} /></div>
             </div>
          </div>
        </div>
      </div>

      {/* --- Modal & Floating Frame --- */}
      {showBreakdown && (
        <div className="modal" onClick={() => setShowBreakdown(false)}>
          <div className="bg-white rounded-lg shadow-xl p-6 max-w-2xl w-full" onClick={e => e.stopPropagation()}>
            <div ref={breakdownRef} className="p-4">
              <h3 className="text-xl font-bold mb-4 text-brand">Berekeningsoverzicht</h3>
              <div className="grid md:grid-cols-2 gap-4 text-sm">
                <div className="bg-gray-50 rounded p-3"><h4 className="font-semibold mb-1">Ontwerp</h4><p>ŒîT = {f1(dT)} K (binnen {f1(inputs.t_in)}¬∞C, buiten {f0(t_out)}¬∞C)</p><p>H_tr (transmissie) = {f1(results.Htr)} W/K</p><p>H_vent (ventilatie) = {f1(results.Hvent)} W/K</p><p>H_totaal = <b>{f1(results.Htot)} W/K</b></p><p>P_ontwerp = <b>{f0(results.P)} W</b></p></div>
                <div className="bg-gray-50 rounded p-3"><h4 className="font-semibold mb-1">Jaarverbruik</h4><p>HDD = {f0(hdd)} ¬∑ zonefactor {zone.factor}</p><p>Gedragsfactor toegepast</p><p>Warmtevraag ‚âà <b>{f0(results.E_kWh)} kWh/j</b></p></div>
                <div className="bg-gray-50 rounded p-3"><h4 className="font-semibold mb-1">Kosten</h4><p>Hoofd + bijverwarming: ‚Ç¨{f0(results.costs.heat_main + results.costs.heat_bij)}</p>{inputs.poolEnabled && <p>Zwembad (totaal): ‚Ç¨{f0(results.costs.poolHeat + results.costs.poolPump)}</p>}<p>Totaal: <b>‚Ç¨{f0(results.costs.total)}</b></p></div>
                <div className="bg-gray-50 rounded p-3"><h4 className="font-semibold mb-1">Verdeling Verlies</h4><ul className="list-disc list-inside">{Object.keys(results.verdeling.pct).map(k => <li key={k}>{k}: {f0(results.verdeling.pct[k])}%</li>)}</ul></div>
              </div>
            </div>
            <div className="flex gap-2 mt-4"><button className="bg-brand text-white px-4 py-2 rounded" onClick={downloadPDF}><Icon.file /> Download PDF</button><button className="bg-gray-200 px-4 py-2 rounded" onClick={() => setShowBreakdown(false)}>Sluiten</button></div>
          </div>
        </div>
      )}

      <div className="fixed z-40 left-0 right-0 bottom-0">
        <div className="bg-white/95 backdrop-blur-sm border-t shadow-lg">
          <div className="max-w-6xl mx-auto px-4 py-2 flex flex-wrap items-center justify-between gap-x-4 gap-y-1">
            <div className="font-semibold text-gray-800">Totaal per jaar: <span className="text-2xl font-extrabold text-brand">‚Ç¨{f0(results.costs.total)}</span></div>
            <div className="text-sm text-gray-600">Per maand: <span className="font-bold">‚Ç¨{f0(results.costs.total / 12)}</span></div>
            <div className="text-xs text-gray-500">Ruimteverw.: ‚Ç¨{f0(results.costs.heat_main + results.costs.heat_bij)}{inputs.poolEnabled ? ` ¬∑ Zwembad: ‚Ç¨${f0(results.costs.poolHeat + results.costs.poolPump)}` : ''}</div>
          </div>
        </div>
      </div>
       <div className="text-center text-xs text-gray-500 mt-4 pb-20">
            <p>Disclaimer: Deze tool geeft een indicatie op basis van gestandaardiseerde rekenmethodes (o.a. EN ISO 13789, 6946). Resultaten zijn afhankelijk van de juistheid van de ingevoerde data en specifiek gebruikersgedrag.</p>
            <p>Voor offici√´le audits (DPE/audit √©nerg√©tique) is software vereist die is gevalideerd door het CSTB en conform de Franse RT/RE-regelgeving.</p>
        </div>
    </div>
  );
}

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>