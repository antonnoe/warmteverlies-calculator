<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Warmteverliescalculator ‚Äì Gecombineerde Module</title>
  <meta name="description" content="Calculator met U¬∑A + 0,34¬∑n¬∑V, HDD, PV, hoofd- & bijverwarming (SCOP/rendement), zwembad en kosten. Geschikt voor GitHub Pages & iFrame."/>
  <!-- React & deps (use production for speed, keep Babel for JSX in single-file setup) -->
  <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <script defer src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Tailwind (CDN) -->
  <script defer src="https://cdn.tailwindcss.com"></script>
  <!-- PDF utilities -->
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    :root{ --brand:#800000 }
    html,body{height:100%}
    body{margin:0;background:#f8f9fa;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,system-ui,Arial}
    .text-brand{color:var(--brand)}
    .sticky{position:sticky;top:1rem}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;padding:1rem;z-index:50}
    .no-spin::-webkit-outer-spin-button,.no-spin::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}
    .no-spin{ -moz-appearance: textfield; }
    .qbtn{cursor:pointer;display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;border-radius:9999px;background:var(--brand);color:#fff;font-size:12px;margin-left:6px}
    .errbar{position:fixed;left:0;right:0;top:0;background:#b91c1c;color:#fff;padding:.5rem .75rem;z-index:60;font-size:12px;display:none}
    .errbar pre{white-space:pre-wrap;word-break:break-word;margin:0}
  </style>
</head>
<body>
<div id="root"></div>
<div id="err" class="errbar"></div>
<script>
  // Minimal error surface so cross-origin iFrames don't swallow details
  window.addEventListener('error', function(e){
    var bar=document.getElementById('err');
    if(!bar) return; bar.style.display='block';
    bar.innerHTML = '<strong>Runtime error:</strong> <pre>'+ (e.error && e.error.stack ? e.error.stack : (e.message||'Unknown')) +'</pre>';
  });
  window.addEventListener('unhandledrejection', function(e){
    var bar=document.getElementById('err');
    if(!bar) return; bar.style.display='block';
    bar.innerHTML = '<strong>Unhandled promise:</strong> <pre>'+ (e.reason && e.reason.stack ? e.reason.stack : (e.reason||'Unknown')) +'</pre>';
  });

  // Expose indicative default prices (user can override in UI)
  window.ENERGY_API = { getFallbackPrices(){ return {
    electricity:0.25, gas:0.085, fioul_per_l:1.15, pellets_per_kg:0.35, wood_per_kwh:0.05, petroleum_per_l:1.80, source:"Invulbaar ¬∑ indicatief"
  }; } };
</script>

<!-- Application -->
<script type="text/babel">
const {useState,useMemo,useRef} = React;

// URL-parameters voor compacte embed
const params = new URLSearchParams(window.location.search);
const UI_COMPACT = params.get('compact') === '1' || params.get('embed') === '1';

const Icon = { calc:()=><>üßÆ</>, euro:()=><>üí∞</>, info:()=><>‚ÑπÔ∏è</>, chart:()=><>üìä</>, file:()=><>üìÑ</>, up:()=><>‚ñ¥</>, down:()=><>‚ñæ</> };

const ZONES = {
  H1a:{naam:'H1a - Noordoost (Reims, Metz)', factor:1.2, gemTemp:-5, hdd:2800, zon:1050},
  H1b:{naam:'H1b - Noord/Centrum (Parijs, Lille)', factor:1.1, gemTemp:-3, hdd:2600, zon:1100},
  H1c:{naam:'H1c - West (Brest, Caen)', factor:1.0, gemTemp: 2, hdd:2300, zon:1000},
  H2a:{naam:'H2a - Midden-west (Poitiers, Tours)', factor:0.9, gemTemp: 0, hdd:2400, zon:1250},
  H2b:{naam:'H2b - Midden-oost (Lyon, Dijon)', factor:0.95,gemTemp:-2, hdd:2500, zon:1200},
  H2c:{naam:'H2c - Zuidwest (Bordeaux, Toulouse)', factor:0.8, gemTemp: 3, hdd:2100, zon:1350},
  H2d:{naam:'H2d - Zuidoost (Avignon, Montpellier)', factor:0.7, gemTemp: 4, hdd:2000, zon:1450},
  H3 :{naam:'H3 - Mediterraan (Nice, Marseille)', factor:0.6, gemTemp: 6, hdd:1600, zon:1500}
};

const U_PRESETS = {
  muur:{'Onge√Øsoleerd (voor 1975)':2.0,'Licht ge√Øsoleerd (~5 cm)':0.8,'Goed (~10 cm)':0.4,'‚â• 15 cm':0.25},
  raam:{'Enkel glas':5.5,'Dubbel':3.0,'HR dubbel':1.8,'Triple HR++':1.0},
  dak :{'Onge√Øsoleerd':3.0,'~10 cm':0.5,'~20 cm':0.25,'‚â• 30 cm':0.15},
  vloer:{'Onge√Øsoleerd':2.2,'Matig':1.2,'Redelijk':0.8,'Goed':0.3}
};

const USE = { volledig:{naam:'Volledig jaar',factor:1.0}, secondaire_zomer:{naam:'Zomer+tussenseizoen',factor:0.3}, secondaire_winter:{naam:'Winter-weekends',factor:0.4}, weekend:{naam:'Alleen weekends',factor:0.25} };

const f0=x=> (Number(x)||0).toFixed(0), f1=x=> (Number(x)||0).toFixed(1);

function App(){
  const prices0 = window.ENERGY_API.getFallbackPrices();
  const [inputs,setInputs]=useState({
    // Transmissie
    muurA:100, raamA:20, dakA:80, vloerA:80,
    muurU:1.8, raamU:5.0, dakU:2.5, vloerU:0.8,
    // Klimaat & gebruik
    t_in:20, zone:'H2a', gebruik:'volledig', verwarmdeRuimtes:'heel', ventilatieGedrag:'normaal',
    // Ventilatie
    volume:250, n_ach:0.5,
    // HDD & PV
    hddCustom:'', pvN:0, pvOri:'zuid', pvTilt:'optimaal',
    // Verwarming hoofd/bij
    hoofd:'gas', etaMain:90, mainSCOP:3.2,
    bij:'geen', bijIntensity:'incidenteel', bijSCOP:3.0,
    // Prijzen (invulbaar)
    elPrice:prices0.electricity, gasPrice:prices0.gas, fioulPrice:prices0.fioul_per_l,
    pelletPrice:prices0.pellets_per_kg, woodPrice:prices0.wood_per_kwh, petroleumPrice:prices0.petroleum_per_l,
    // Zwembad
    poolEnabled:false, poolA:24, poolSeasonDays:150, poolPumpW:550, poolPumpH:8, poolCover:'solar', poolWind:'normaal', poolHeat:'geen', poolTargetT:28, poolAirT:22, poolSCOP:4
  });
  const [showBreakdown,setShowBreakdown]=useState(false);
  const [helpTopic,setHelpTopic]=useState(null);
  const breakdownRef=useRef(null);

  const zone = ZONES[inputs.zone];
  const hdd = inputs.hddCustom!==''? Math.max(0, +inputs.hddCustom||0) : zone.hdd;
  const t_out = zone.gemTemp; const dT = inputs.t_in - t_out;

  const results = useMemo(()=>{
    const A=v=>Math.max(0,+v||0), U=v=>Math.max(0,+v||0);
    const Htr = U(inputs.muurU)*A(inputs.muurA) + U(inputs.raamU)*A(inputs.raamA) + U(inputs.dakU)*A(inputs.dakA) + U(inputs.vloerU)*A(inputs.vloerA);
    const Hvent = 0.34 * Math.max(0,+inputs.n_ach||0) * Math.max(0,+inputs.volume||0);
    const Htot = Htr + Hvent; const P = Htot * dT;
    const gf_room = inputs.verwarmdeRuimtes==='leef'?0.7 : inputs.verwarmdeRuimtes==='min'?0.5 : 1.0;
    const gf_vent = inputs.ventilatieGedrag==='veel'?1.2 : inputs.ventilatieGedrag==='open'?1.5 : 1.0;
    const useFactor = (USE[inputs.gebruik]?.factor)||1.0; const gf = gf_room * gf_vent;
    const E_kWh = Htot * hdd * 24 / 1000 * zone.factor * gf * useFactor;
    // Verdeling
    const dMuur = U(inputs.muurU)*A(inputs.muurA)*dT, dRaam=U(inputs.raamU)*A(inputs.raamA)*dT, dDak=U(inputs.dakU)*A(inputs.dakA)*dT, dVloer=U(inputs.vloerU)*A(inputs.vloerA)*dT;
    const brutto = dMuur+dRaam+dDak+dVloer; const pct=x=> brutto>0? x/brutto*100:0;
    // PV (indicatief)
    const oriFac={zuid:1.0,zuidwest:0.95,zuidoost:0.95,oost:0.85,west:0.85}; const tiltFac={vlak:0.85,optimaal:1.0,steil:0.9};
    const pvYield = inputs.pvN * zone.zon * (oriFac[inputs.pvOri]||1) * (tiltFac[inputs.pvTilt]||1);
    let pvSelf = pvYield * 0.7; // eenvoudige eigen verbruik factor
    // Splits hoofd/bij
    const bijMap = { incidenteel:0.9, regelmatig:0.7, hoofdverwarming:0.2 };
    const hoofdFrac = inputs.bij==='geen' ? 1.0 : (bijMap[inputs.bijIntensity]||0.9);
    const kWhHoofd = E_kWh * hoofdFrac; const kWhBij = E_kWh - kWhHoofd;
    // Prijzen
    const PZ = { el:Math.max(0,+inputs.elPrice||0), gas:Math.max(0,+inputs.gasPrice||0), fioul:Math.max(0,+inputs.fioulPrice||0), pellet:Math.max(0,+inputs.pelletPrice||0), wood:Math.max(0,+inputs.woodPrice||0), pet:Math.max(0,+inputs.petroleumPrice||0) };
    // Hoofd kosten
    const mainCost = ()=>{ const eta = Math.max(1,+inputs.etaMain||90)/100; switch(inputs.hoofd){
      case 'gas':{ const bought=kWhHoofd/eta; return {euro:bought*PZ.gas, elUsed:0}; }
      case 'fioul':{ const liters=(kWhHoofd/eta)/10; return {euro:liters*PZ.fioul, elUsed:0}; }
      case 'elektrisch':{ let elUsed=kWhHoofd; const elPay=Math.max(0,elUsed-pvSelf); pvSelf=Math.max(0,pvSelf-elUsed); return {euro:elPay*PZ.el, elUsed}; }
      case 'warmtepomp':{ const scop=Math.max(1,+inputs.mainSCOP||3.2); let elUsed=kWhHoofd/scop; const elPay=Math.max(0,elUsed-pvSelf); pvSelf=Math.max(0,pvSelf-elUsed); return {euro:elPay*PZ.el, elUsed}; }
      case 'hout':{ const bought=kWhHoofd/eta; return {euro:bought*PZ.wood, elUsed:0}; }
      case 'pellets':{ const kg=(kWhHoofd/eta)/4.8; return {euro:kg*PZ.pellet, elUsed:0}; }
      default:return {euro:0, elUsed:0}; }
    };
    // Bij kosten
    const bijCost = ()=>{ if(kWhBij<=0) return {euro:0, elUsed:0}; switch(inputs.bij){
      case 'elektrisch':{ let elUsed=kWhBij; const elPay=Math.max(0,elUsed-pvSelf); pvSelf=Math.max(0,pvSelf-elUsed); return {euro:elPay*PZ.el, elUsed}; }
      case 'inverter_ac':{ const scop=Math.max(1,+inputs.bijSCOP||3); let elUsed=kWhBij/scop; const elPay=Math.max(0,elUsed-pvSelf); pvSelf=Math.max(0,pvSelf-elUsed); return {euro:elPay*PZ.el, elUsed}; }
      case 'houtkachel':{ const euro=(kWhBij/0.75)*PZ.wood; return {euro, elUsed:0}; }
      case 'open_haard':{ const euro=(kWhBij/0.15)*PZ.wood; return {euro, elUsed:0}; }
      case 'pellets':{ const euro=((kWhBij/0.88)/4.8)*PZ.pellet; return {euro, elUsed:0}; }
      case 'petroleum':{ const euro=((kWhBij/0.95)/10)*PZ.pet; return {euro, elUsed:0}; }
      default:return {euro:0, elUsed:0}; }
    };
    const mainC=mainCost(); const bijC=bijCost();
    // Zwembad
    let pool_kWh=0, pool_pump_kWh=0, euro_pool_heat=0, euro_pool_pump=0;
    if(inputs.poolEnabled){
      const days=Math.max(0,+inputs.poolSeasonDays||0);
      pool_pump_kWh=(Math.max(0,+inputs.poolPumpW||0)/1000)*Math.max(0,+inputs.poolPumpH||0)*days;
      const Awater=Math.max(0,+inputs.poolA||0); const dTpool=Math.max(0,(+inputs.poolTargetT||28)-(+inputs.poolAirT||22));
      let Ueff=18; const coverRed={geen:1.0, solar:0.5, lamellen:0.35}[inputs.poolCover]||1.0; const windFac={beschut:0.9, normaal:1.0, winderig:1.3}[inputs.poolWind]||1.0; Ueff=Ueff*coverRed*windFac;
      const hours=days*24; const Q=Ueff*Awater*dTpool*hours/1000;
      if(inputs.poolHeat==='wp'){ const scop=Math.max(1,+inputs.poolSCOP||4); pool_kWh=Q/scop; let elUsed=pool_kWh; const elPay=Math.max(0,elUsed-pvSelf); pvSelf=Math.max(0,pvSelf-elUsed); euro_pool_heat=elPay*PZ.el; }
      else if(inputs.poolHeat==='elektra'){ let elUsed=Q; const elPay=Math.max(0,elUsed-pvSelf); pvSelf=Math.max(0,pvSelf-elUsed); euro_pool_heat=elPay*PZ.el; pool_kWh=Q; }
      else if(inputs.poolHeat==='gas'){ euro_pool_heat=Q*PZ.gas; pool_kWh=Q; }
      euro_pool_pump = pool_pump_kWh * PZ.el; // pomp-elektra (PV-correctie buiten scope)
    }
    const totalEuro = mainC.euro + bijC.euro + euro_pool_heat + euro_pool_pump;
    return {
      Htr,Hvent,Htot:P?Htot:0,P,E_kWh,
      verdeling:{muur:dMuur,raam:dRaam,dak:dDak,vloer:dVloer, pct:{muur:pct(dMuur),raam:pct(dRaam),dak:pct(dDak),vloer:pct(dVloer)}},
      costs:{ heat_main:mainC.euro, heat_bij:bijC.euro, poolHeat:euro_pool_heat, poolPump:euro_pool_pump, total:totalEuro },
      pv:{yield:pvYield,selfRemaining:pvSelf}, dT, t_out,
      aux:{ kWhHoofd, kWhBij }
    };
  },[inputs, zone, dT, hdd]);

  const update=(k,v)=> setInputs(s=>({...s,[k]:v}));
  const setPreset=(type,key)=> update(type+"U", U_PRESETS[type][key]);

  function downloadPDF(){ const { jsPDF } = window.jspdf||{}; if(!jsPDF) return; if(!breakdownRef.current) return; html2canvas(breakdownRef.current,{scale:2}).then(cv=>{ const pdf=new jsPDF('p','mm','a4'); const w=pdf.internal.pageSize.getWidth(); const h=cv.height*w/cv.width; pdf.addImage(cv.toDataURL('image/png'),'PNG',10,10,w-20,Math.min(h-20,270)); pdf.save('warmteverlies-rapport.pdf'); }); }

  return (
    <div className="max-w-6xl mx-auto p-4">
      <div className="bg-white p-5 rounded-lg shadow-sm text-center mb-4">
        <h1 className="text-2xl md:text-3xl font-bold text-brand flex items-center justify-center gap-2"><Icon.calc/> Warmteverlies ‚Äì Gecombineerde Calculator</h1>
        <p className="text-sm text-gray-600">Œ£(U¬∑A) + 0,34¬∑n¬∑V ¬∑ ŒîT, HDD‚Äëjaarinschatting, hoofd/bijverwarming, PV en zwembad.</p>
      </div>

      <div className="flex flex-col lg:flex-row gap-4">
        {/* KPI & chart */}
        <div className="lg:w-80 flex-shrink-0">
          <div className="sticky">
            {!UI_COMPACT && (
            <div className="bg-white rounded-lg border shadow-sm p-4">
              <h3 className="font-bold text-brand mb-2"><Icon.euro/> Jaarlijkse kosten</h3>
              <div className="text-4xl font-extrabold tracking-tight text-gray-900">‚Ç¨{f0(results.costs.total)}</div>
              <div className="text-xs text-gray-600 mt-1">ruimteverwarming & zwembad (pomp/verw.)</div>
              <div className="grid grid-cols-2 gap-2 text-xs mt-3">
                <div className="bg-gray-50 rounded p-2"><div className="text-gray-500">Totaal H (W/K)</div><div className="font-semibold">{f1(results.Htot)}</div></div>
                <div className="bg-gray-50 rounded p-2"><div className="text-gray-500">ŒîT (K)</div><div className="font-semibold">{f1(results.dT)}</div></div>
                <div className="bg-gray-50 rounded p-2"><div className="text-gray-500">P ontwerp (W)</div><div className="font-semibold">{f0(results.P)}</div></div>
                <div className="bg-gray-50 rounded p-2"><div className="text-gray-500">Warmtevraag (kWh/j)</div><div className="font-semibold">{f0(results.E_kWh)}</div></div>
              </div>
              <div className="mt-3 flex gap-2">
                <button className="flex-1 bg-[var(--brand)] text-white py-2 rounded hover:opacity-90" onClick={()=>setShowBreakdown(true)}>Berekeningsoverzicht</button>
                <button className="flex-1 bg-gray-800 text-white py-2 rounded hover:opacity-90" onClick={()=>setHelpTopic('overview')}>Rekenregels & Bron</button>
              </div>
            </div>
            )}
            <div className="bg-white rounded-lg border shadow-sm p-4 mt-4">
              <h3 className="font-bold text-brand mb-2"><Icon.chart/> Verdeling warmteverlies</h3>
              {results.P>0? (
                <div className="flex items-end gap-3 h-44">
                  {['muur','raam','dak','vloer'].map(k=>{
                    const v = results.verdeling.pct[k]||0; const h = Math.max(20, v*1.6);
                    return (
                      <div key={k} className="flex-1 flex flex-col items-center">
                        <div className="text-xs text-gray-600 mb-1">{f0(v)}%</div>
                        <div className="w-full bg-[var(--brand)] rounded-t h-[20px] flex items-center justify-center text-white text-[10px]" style={{height:h}}>{k}</div>
                      </div>
                    )
                  })}
                </div>
              ):<div className="text-sm text-gray-500">Voer gegevens in om de verdeling te zien.</div>}
            </div>
          </div>
        </div>

        {/* INPUTS */}
        <div className="flex-1 space-y-4">
          {/* Locatie & jaar */}
          <section className="bg-white rounded-lg border shadow-sm p-4">
            <h2 className="font-bold text-brand mb-3">Locatie & Jaarinschatting <button className="qbtn" title="Uitleg HDD & zones" onClick={()=>setHelpTopic('hdd')}>?</button></h2>
            <div className="grid md:grid-cols-4 gap-3">
              <label>Klimaatzone
                <select value={inputs.zone} onChange={e=>update('zone',e.target.value)} className="w-full p-2 border rounded">
                  {Object.keys(ZONES).map(z=> <option key={z} value={z}>{ZONES[z].naam}</option>)}
                </select>
              </label>
              <label>Gewenste binnentemp (¬∞C)
                <input type="number" className="w-full p-2 border rounded no-spin" value={inputs.t_in} step="0.5" onChange={e=>update('t_in',e.target.value)} />
              </label>
              <label>HDD (optioneel, leeg=zone)
                <input type="number" className="w-full p-2 border rounded no-spin" placeholder={ZONES[inputs.zone].hdd} value={inputs.hddCustom} onChange={e=>update('hddCustom',e.target.value)} />
              </label>
              <label>Gebruik
                <select value={inputs.gebruik} onChange={e=>update('gebruik',e.target.value)} className="w-full p-2 border rounded">
                  {Object.keys(USE).map(g=> <option key={g} value={g}>{USE[g].naam}</option>)}
                </select>
              </label>
            </div>
            <p className="text-xs text-gray-600 mt-2">Buitentemp (ontwerp) voor zone: <b>{f0(t_out)}¬∞C</b> ¬∑ HDD default: <b>{ZONES[inputs.zone].hdd}</b></p>
          </section>

          {/* Gedrag & ventilatie */}
          <section className="bg-white rounded-lg border shadow-sm p-4">
            <h2 className="font-bold text-brand mb-3">Gedrag & Ventilatie <button className="qbtn" title="n (ACH) & ventilatie" onClick={()=>setHelpTopic('ach')}>?</button></h2>
            <div className="grid md:grid-cols-4 gap-3">
              <label>Verwarmde ruimtes
                <select value={inputs.verwarmdeRuimtes} onChange={e=>update('verwarmdeRuimtes',e.target.value)} className="w-full p-2 border rounded">
                  <option value="heel">Heel huis</option>
                  <option value="leef">Alleen leefruimtes</option>
                  <option value="min">Minimaal</option>
                </select>
              </label>
              <label>Ventilatiegedrag
                <select value={inputs.ventilatieGedrag} onChange={e=>update('ventilatieGedrag',e.target.value)} className="w-full p-2 border rounded">
                  <option value="normaal">Normaal</option>
                  <option value="veel">Veel ventileren</option>
                  <option value="open">Ramen vaak open</option>
                </select>
              </label>
              <label>Verwarmd volume V (m¬≥)
                <input type="number" className="w-full p-2 border rounded no-spin" value={inputs.volume} onChange={e=>update('volume',e.target.value)} />
              </label>
              <label>Ventilatievoud n (ACH, 1/h)
                <input type="number" className="w-full p-2 border rounded no-spin" value={inputs.n_ach} step="0.05" onChange={e=>update('n_ach',e.target.value)} />
              </label>
            </div>
            <p className="text-xs text-gray-600 mt-2">H<sub>vent</sub>=0,34¬∑n¬∑V. Kies n‚âà0,3‚Äì0,5 voor redelijk luchtdicht + mechanische ventilatie; 0,7‚Äì1,0 voor oudere woningen.</p>
          </section>

          {/* Transmissie */}
          <section className="bg-white rounded-lg border shadow-sm p-4">
            <h2 className="font-bold text-brand mb-3">Oppervlaktes & Isolatie (U‚Äëwaarden) <button className="qbtn" title="U-waarden & Œ£(U¬∑A)" onClick={()=>setHelpTopic('uvalue')}>?</button></h2>
            <div className="grid md:grid-cols-2 gap-4">
              {['muur','raam','dak','vloer'].map(k=> (
                <div key={k}>
                  <label className="block text-sm font-medium text-gray-700 mb-1">{k.charAt(0).toUpperCase()+k.slice(1)}</label>
                  <input type="number" className="w-full p-2 border rounded no-spin mb-2" placeholder="Oppervlak m¬≤" value={inputs[k+'A']} onChange={e=>update(k+'A',e.target.value)} />
                  <div className="flex flex-wrap gap-1 mb-2">
                    {Object.keys(U_PRESETS[k]).map(p=> (
                      <button key={p} onClick={()=>setPreset(k,p)} className="px-2 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200">{p}</button>
                    ))}
                  </div>
                  <input type="number" step="0.01" className="w-full p-2 border rounded no-spin" placeholder="U (W/m¬≤K)" value={inputs[k+'U']} onChange={e=>update(k+'U',e.target.value)} />
                </div>
              ))}
            </div>
          </section>

          {/* Energie & Kosten */}
          <section className="bg-white rounded-lg border shadow-sm p-4">
            <h2 className="font-bold text-brand mb-3">Energie & Kosten <button className="qbtn" title="SCOP/COP & prijzen" onClick={()=>setHelpTopic('scop')}>?</button></h2>
            <div className="grid md:grid-cols-5 gap-3">
              <label>Hoofdverwarming
                <select value={inputs.hoofd} onChange={e=>update('hoofd',e.target.value)} className="w-full p-2 border rounded">
                  <option value="gas">Gas</option>
                  <option value="fioul">Fioul</option>
                  <option value="elektrisch">Elektrisch (direct)</option>
                  <option value="warmtepomp">Warmtepomp (lucht-water)</option>
                  <option value="hout">Hout (CV)</option>
                  <option value="pellets">Pelletketel</option>
                </select>
              </label>
              {inputs.hoofd==='warmtepomp' ? (
                <label>SCOP hoofd
                  <input type="number" className="w-full p-2 border rounded no-spin" value={inputs.mainSCOP} onChange={e=>update('mainSCOP',e.target.value)} />
                </label>
              ):(
                <label>Rendement hoofd (%)
                  <input type="number" className="w-full p-2 border rounded no-spin" value={inputs.etaMain} onChange={e=>update('etaMain',e.target.value)} />
                </label>
              )}
              <label>Bijverwarming
                <select value={inputs.bij} onChange={e=>update('bij',e.target.value)} className="w-full p-2 border rounded">
                  <option value="geen">Geen</option>
                  <option value="houtkachel">Houtkachel</option>
                  <option value="open_haard">Open haard</option>
                  <option value="inverter_ac">Inverter airco (lucht-lucht)</option>
                  <option value="pellets">Pellets</option>
                  <option value="petroleum">Petroleum</option>
                  <option value="elektrisch">Elektrisch</option>
                </select>
              </label>
              <label>Gebruik bijverwarming
                <select value={inputs.bijIntensity} onChange={e=>update('bijIntensity',e.target.value)} className="w-full p-2 border rounded" disabled={inputs.bij==='geen'}>
                  <option value="incidenteel">Incidenteel (¬± 10%)</option>
                  <option value="regelmatig">Regelmatig (¬± 30%)</option>
                  <option value="hoofdverwarming">Hoog aandeel (¬± 80%)</option>
                </select>
              </label>
              {inputs.bij==='inverter_ac' && (
                <label>SCOP bij (airco)
                  <input type="number" className="w-full p-2 border rounded no-spin" value={inputs.bijSCOP} onChange={e=>update('bijSCOP',e.target.value)} />
                </label>
              )}
            </div>

            <div className="grid md:grid-cols-5 gap-3 mt-3">
              <label>PV-panelen (aantal)
                <input type="number" className="w-full p-2 border rounded no-spin" value={inputs.pvN} onChange={e=>update('pvN',e.target.value)} />
              </label>
              <label>Ori√´ntatie
                <select value={inputs.pvOri} onChange={e=>update('pvOri',e.target.value)} className="w-full p-2 border rounded" disabled={inputs.pvN<=0}>
                  <option value="zuid">Zuid</option>
                  <option value="zuidwest">Zuidwest</option>
                  <option value="zuidoost">Zuidoost</option>
                  <option value="oost">Oost</option>
                  <option value="west">West</option>
                </select>
              </label>
              <label>Hellingshoek
                <select value={inputs.pvTilt} onChange={e=>update('pvTilt',e.target.value)} className="w-full p-2 border rounded" disabled={inputs.pvN<=0}>
                  <option value="optimaal">Optimaal</option>
                  <option value="vlak">Vlak</option>
                  <option value="steil">Steil</option>
                </select>
              </label>
              <div className="md:col-span-2">
                <label>Energiedragerprijzen (invulbaar) <button className="qbtn" title="Prijzen uitleg" onClick={()=>setHelpTopic('prices')}>?</button></label>
                <div className="grid grid-cols-2 gap-2 text-xs mt-1">
                  <label>Stroom ‚Ç¨/kWh<input type="number" step="0.001" className="w-full p-1 border rounded no-spin" value={inputs.elPrice} onChange={e=>update('elPrice',e.target.value)} /></label>
                  <label>Gas ‚Ç¨/kWh<input type="number" step="0.001" className="w-full p-1 border rounded no-spin" value={inputs.gasPrice} onChange={e=>update('gasPrice',e.target.value)} /></label>
                  <label>Fioul ‚Ç¨/L<input type="number" step="0.01" className="w-full p-1 border rounded no-spin" value={inputs.fioulPrice} onChange={e=>update('fioulPrice',e.target.value)} /></label>
                  <label>Pellets ‚Ç¨/kg<input type="number" step="0.01" className="w-full p-1 border rounded no-spin" value={inputs.pelletPrice} onChange={e=>update('pelletPrice',e.target.value)} /></label>
                  <label>Hout ‚Ç¨/kWh<input type="number" step="0.01" className="w-full p-1 border rounded no-spin" value={inputs.woodPrice} onChange={e=>update('woodPrice',e.target.value)} /></label>
                  <label>Petroleum ‚Ç¨/L<input type="number" step="0.01" className="w-full p-1 border rounded no-spin" value={inputs.petroleumPrice} onChange={e=>update('petroleumPrice',e.target.value)} /></label>
                </div>
                <p className="text-[11px] text-gray-500 mt-1">Pas prijzen aan voor jouw contract. Defaults zijn indicatief.</p>
              </div>
            </div>
          </section>

          {/* Zwembad */}
          <section className="bg-white rounded-lg border shadow-sm p-4">
            <div className="flex items-center justify-between">
              <h2 className="font-bold text-brand">Zwembad (optioneel)</h2>
              <label className="flex items-center gap-2 text-sm"><input type="checkbox" checked={inputs.poolEnabled} onChange={e=>update('poolEnabled',e.target.checked)} /> Inschakelen</label>
            </div>
            {inputs.poolEnabled && (
              <div className="grid md:grid-cols-3 gap-3 mt-3">
                <label>Oppervlak (m¬≤)
                  <input type="number" className="w-full p-2 border rounded no-spin" value={inputs.poolA} onChange={e=>update('poolA',e.target.value)} />
                </label>
                <label>Seizoen (dagen)
                  <input type="number" className="w-full p-2 border rounded no-spin" value={inputs.poolSeasonDays} onChange={e=>update('poolSeasonDays',e.target.value)} />
                </label>
                <label>Pompvermogen (W)
                  <input type="number" className="w-full p-2 border rounded no-spin" value={inputs.poolPumpW} onChange={e=>update('poolPumpW',e.target.value)} />
                </label>
                <label>Pompuren/dag
                  <input type="number" className="w-full p-2 border rounded no-spin" value={inputs.poolPumpH} onChange={e=>update('poolPumpH',e.target.value)} />
                </label>
                <label>Afdekking
                  <select className="w-full p-2 border rounded" value={inputs.poolCover} onChange={e=>update('poolCover',e.target.value)}>
                    <option value="geen">Geen</option>
                    <option value="solar">Solar cover</option>
                    <option value="lamellen">Lamellen</option>
                  </select>
                </label>
                <label>Windblootstelling
                  <select className="w-full p-2 border rounded" value={inputs.poolWind} onChange={e=>update('poolWind',e.target.value)}>
                    <option value="beschut">Beschut</option>
                    <option value="normaal">Normaal</option>
                    <option value="winderig">Winderig</option>
                  </select>
                </label>
                <label>Verwarming
                  <select className="w-full p-2 border rounded" value={inputs.poolHeat} onChange={e=>update('poolHeat',e.target.value)}>
                    <option value="geen">Geen</option>
                    <option value="wp">Warmtepomp</option>
                    <option value="elektra">Elektrisch</option>
                    <option value="gas">Gas</option>
                  </select>
                </label>
                <label>Doel water T (¬∞C)
                  <input type="number" className="w-full p-2 border rounded no-spin" value={inputs.poolTargetT} onChange={e=>update('poolTargetT',e.target.value)} />
                </label>
                <label>Gem. buiten T (¬∞C)
                  <input type="number" className="w-full p-2 border rounded no-spin" value={inputs.poolAirT} onChange={e=>update('poolAirT',e.target.value)} />
                </label>
                {inputs.poolHeat==='wp' && (
                  <label>SCOP zwembad-WP
                    <input type="number" className="w-full p-2 border rounded no-spin" value={inputs.poolSCOP} onChange={e=>update('poolSCOP',e.target.value)} />
                  </label>
                )}
              </div>
            )}
          </section>

          {/* Bronnen */}
          <section className="bg-white rounded-lg border shadow-sm p-4 text-xs text-gray-600">
            <h2 className="font-bold text-brand mb-2"><Icon.info/> Bronnen & rekengrondslagen</h2>
            <p>Transmissie: EN ISO 6946/13789 (U/R). Ventilatie: 0,34¬∑n¬∑V (œÅ¬∑c<sub>p</sub>‚âà1,2 kg/m¬≥¬∑1000 J/kgK / 3600). Jaar: H¬∑HDD¬∑24/1000. Zwembad: oppervlaktemodel met convectie/radiatie/verdamping en afdekkingsreductie (indicatief). Warmtepompen/airco: el‚Äëvraag = warmtevraag/SCOP (seizoensprestatie).</p>
            <p>Voor offici√´le audits (DPE/audit √©nerg√©tique) gelden Th‚ÄëB√¢t/RE2020 en CSTB‚Äëgevalideerde software.</p>
          </section>
        </div>
      </div>

      {/* Breakdown modal */}
      {showBreakdown && (
        <div className="modal" onClick={()=>setShowBreakdown(false)}>
          <div className="bg-white rounded-lg shadow-xl p-4 max-w-2xl w-full" onClick={e=>e.stopPropagation()}>
            <div ref={breakdownRef}>
              <h3 className="text-xl font-bold mb-2">Berekeningsoverzicht</h3>
              <div className="grid md:grid-cols-2 gap-3 text-sm">
                <div className="bg-gray-50 rounded p-2">
                  <h4 className="font-semibold mb-1">Ontwerp</h4>
                  <p>ŒîT = {f1(dT)} K (binnen {f1(inputs.t_in)}¬∞C, buiten {f0(zone.gemTemp)}¬∞C)</p>
                  <p>H<sub>tr</sub> = Œ£(U¬∑A) = {f1(results.Htr)} W/K</p>
                  <p>H<sub>vent</sub> = 0,34¬∑n¬∑V = {f1(results.Hvent)} W/K</p>
                  <p>H<sub>tot</sub> = {f1(results.Htot)} W/K</p>
                  <p>P<sub>ontwerp</sub> = H<sub>tot</sub>¬∑ŒîT = <b>{f0(results.P)} W</b></p>
                </div>
                <div className="bg-gray-50 rounded p-2">
                  <h4 className="font-semibold mb-1">Jaar</h4>
                  <p>HDD = {f0(hdd)} ¬∑ zonefactor {ZONES[inputs.zone].factor}</p>
                  <p>Gedrag (ruimtes/ventilatie) toegepast</p>
                  <p>Warmtevraag ‚âà <b>{f0(results.E_kWh)} kWh/j</b></p>
                </div>
                <div className="bg-gray-50 rounded p-2">
                  <h4 className="font-semibold mb-1">Kosten</h4>
                  <p>Hoofd: ‚Ç¨{f0(results.costs.heat_main)} ¬∑ Bij: ‚Ç¨{f0(results.costs.heat_bij)}</p>
                  {inputs.poolEnabled && <p>Zwembad verwarming: ‚Ç¨{f0(results.costs.poolHeat)} ¬∑ Pomp: ‚Ç¨{f0(results.costs.poolPump)}</p>}
                  <p>Totaal: <b>‚Ç¨{f0(results.costs.total)}</b></p>
                </div>
                <div className="bg-gray-50 rounded p-2">
                  <h4 className="font-semibold mb-1">Verdeling verlies</h4>
                  <ul className="list-disc list-inside">
                    <li>Muren: {f0(results.verdeling.pct.muur)}%</li>
                    <li>Ramen: {f0(results.verdeling.pct.raam)}%</li>
                    <li>Dak: {f0(results.verdeling.pct.dak)}%</li>
                    <li>Vloer: {f0(results.verdeling.pct.vloer)}%</li>
                  </ul>
                </div>
              </div>
            </div>
            <div className="flex gap-2 mt-3">
              <button className="bg-[var(--brand)] text-white px-3 py-2 rounded" onClick={downloadPDF}><Icon.file/> Download PDF</button>
              <button className="bg-gray-200 px-3 py-2 rounded" onClick={()=>setShowBreakdown(false)}>Sluiten</button>
            </div>
          </div>
        </div>
      )}

      {/* Help modal */}
      {helpTopic && (
        <div className="modal" onClick={()=>setHelpTopic(null)}>
          <div className="bg-white rounded-lg shadow-xl p-4 max-w-xl w-full" onClick={e=>e.stopPropagation()}>
            <div className="flex items-center justify-between mb-2">
              <h3 className="text-xl font-bold">Uitleg & rekenregels</h3>
              <button className="qbtn" onClick={()=>setHelpTopic(null)} title="Sluiten">‚úï</button>
            </div>
            <div className="prose prose-sm max-w-none">
              {helpTopic==='overview' && (
                <div>
                  <p>Steady‚Äëstate benadering:</p>
                  <ul className="list-disc ml-5">
                    <li><b>Transmissie</b>: H<sub>tr</sub>=Œ£(U¬∑A).</li>
                    <li><b>Ventilatie</b>: H<sub>vent</sub>=0,34¬∑n¬∑V.</li>
                    <li><b>Ontwerpvermogen</b>: P=H<sub>tot</sub>¬∑ŒîT.</li>
                    <li><b>Jaar</b>: E‚âàH¬∑HDD¬∑24/1000.</li>
                    <li><b>WP/airco</b>: el‚Äëvraag = warmtevraag/SCOP.</li>
                  </ul>
                </div>
              )}
              {helpTopic==='hdd' && (
                <div>
                  <h4 className="font-semibold mb-1">Heating Degree Days (HDD)</h4>
                  <p>HDD somt per dag het temperatuurverschil op tussen binnensetpoint en buitentemperatuur. Jaar ‚âà H ¬∑ HDD ¬∑ 24 / 1000.</p>
                </div>
              )}
              {helpTopic==='ach' && (
                <div>
                  <h4 className="font-semibold mb-1">n (ACH) ‚Äì luchtwisselingen per uur</h4>
                  <p>H<sub>vent</sub> = 0,34 ¬∑ n ¬∑ V (W/K). 0,3‚Äì0,5 luchtdicht + mechanisch; 0,7‚Äì1,0 ouder huis.</p>
                </div>
              )}
              {helpTopic==='uvalue' && (
                <div>
                  <h4 className="font-semibold mb-1">U-waarden</h4>
                  <p>H<sub>tr</sub> = Œ£(U ¬∑ A). U via EN ISO 6946; vloer/grond gedetailleerd via EN ISO 13370 (hier vereenvoudigd als U<sub>vloer</sub>).</p>
                </div>
              )}
              {helpTopic==='scop' && (
                <div>
                  <h4 className="font-semibold mb-1">SCOP/COP & prijzen</h4>
                  <p>Warmtepomp/airco: elektriciteitsvraag = warmtevraag/SCOP. Vul contractprijzen in; defaults zijn indicatief.</p>
                </div>
              )}
              {helpTopic==='prices' && (
                <div>
                  <h4 className="font-semibold mb-1">Prijzen energiedragers</h4>
                  <p>‚Ç¨ per kWh/L/kg ‚Äì worden direct toegepast in de kosten. Pas aan naar jouw contract.</p>
                </div>
              )}
            {helpTopic==='faq' && (
              <div>
                <h4 className="font-semibold mb-2">Veelgestelde vragen</h4>
                <details className="mb-2"><summary className="cursor-pointer font-medium">1) Hoe betrouwbaar is de uitkomst?</summary><div className="mt-1">De tool gebruikt fysische formules en realistische defaults. Het blijft een benadering; nauwkeurigheid stijgt met goede invoer (U/A, n/ACH, HDD, SCOP, prijzen).</div></details>
                <details className="mb-2"><summary className="cursor-pointer font-medium">2) Wat betekenen U-, R- en Œ£(U¬∑A)?</summary><div className="mt-1"><b>U</b> (W/m¬≤K): lager is beter. <b>R</b> (m¬≤K/W): hoger is beter. Transmissie: H<sub>tr</sub>=Œ£(U¬∑A).</div></details>
                <details className="mb-2"><summary className="cursor-pointer font-medium">3) Wat is n (ACH) en H<sub>vent</sub>?</summary><div className="mt-1">H<sub>vent</sub>=0,34¬∑n¬∑V; n‚âà0,3‚Äì0,5 (luchtdicht+MV), 0,7‚Äì1,0 (ouder huis).</div></details>
                <details className="mb-2"><summary className="cursor-pointer font-medium">4) HDD en ŒîT?</summary><div className="mt-1">HDD = som temperatuurdeficits; Jaar: E‚âàH¬∑HDD¬∑24/1000. ŒîT = T_in ‚àí T_out,zone.</div></details>
                <details className="mb-2"><summary className="cursor-pointer font-medium">5) SCOP/COP (WP/airco)</summary><div className="mt-1">Elektriciteitsvraag = warmtevraag/SCOP; bij vorst zakt momentane COP.</div></details>
                <details className="mb-2"><summary className="cursor-pointer font-medium">6) Bijverwarming en intensiteit</summary><div className="mt-1">Type + intensiteit verdelen de jaarwarmtevraag; kosten per energiedrager berekend.</div></details>
                <details className="mb-2"><summary className="cursor-pointer font-medium">7) Zonnepanelen & eigen verbruik</summary><div className="mt-1">Opbrengst via instraling√óori√´ntatie√óhelling; ~70% eigen verbruik eerst verrekend met elektrische verbruikers.</div></details>
                <details className="mb-2"><summary className="cursor-pointer font-medium">8) Zwembad</summary><div className="mt-1">Pomp: W√óuren√ódagen. Verwarming: oppervlaktemodel + afdekking/wind; WP-SCOP of gas/elektra.</div></details>
                <details><summary className="cursor-pointer font-medium">Rekengrondslagen (kort)</summary><div className="mt-1 text-sm"><ul className="list-disc ml-5"><li>H_tr=Œ£(U¬∑A) [W/K]</li><li>H_vent=0,34¬∑n¬∑V [W/K]</li><li>P=H_tot¬∑ŒîT [W]</li><li>E‚âàH¬∑HDD¬∑24/1000 [kWh/j]</li><li>WP/airco: el=warmtevraag/SCOP</li><li>PV: opbrengst‚âàpanelen√óinstraling√óori√´ntatie√óhelling; eigenverbruik ~70%</li><li>Zwembad: indicatief oppervlaktemodel + afdekking/wind</li><li>Kosten: verbruik √ó ingevoerde prijzen</li></ul></div></details>
                <div className="mt-3 text-xs text-gray-600">Direct openen buiten WordPress? <a className="underline" href="https://antonnoe.github.io/warmteverlies-calculator/?compact=1" target="_blank" rel="noopener">Klik hier‚Ä¶</a></div>
              </div>
            )}
            </div>
            <div className="text-[11px] text-gray-500 mt-3">Dit is een indicatieve benadering. Nauwkeurigheid neemt toe met goede invoer (U, A, n, HDD, SCOP, prijzen).</div>
            <div className="flex justify-end mt-3"><button className="bg-[var(--brand)] text-white px-3 py-2 rounded" onClick={()=>setHelpTopic(null)}>Sluiten</button></div>
          </div>
        </div>
      )}

      {/* Floating finance frame ‚Äì full width */}
      <div className="fixed z-40 left-0 right-0 bottom-0">
        <div className="bg-white border-t shadow-xl">
          <div className="max-w-6xl mx-auto px-3 py-2">
            <div className="flex items-center gap-3">
              <div className="font-bold text-sm text-gray-700">Financi√´le doorrekening</div>
              <button className="px-2 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200 border" onClick={()=>setHelpTopic('faq')} title="Veelgestelde vragen">FAQ</button>
              <div className="ml-auto text-2xl font-extrabold text-gray-900">‚Ç¨{f0(results.costs.total)} <span className="text-sm font-normal text-gray-500">/jaar</span></div>
            </div>
            <div className="text-xs text-gray-600">‚âà ‚Ç¨{f0(results.costs.total/12)} per maand ¬∑ Hoofd ‚Ç¨{f0(results.costs.heat_main)} ¬∑ Bij ‚Ç¨{f0(results.costs.heat_bij)}{inputs.poolEnabled?` ¬∑ Zwembad verw. ‚Ç¨${f0(results.costs.poolHeat)} ¬∑ pomp ‚Ç¨${f0(results.costs.poolPump)}`:''}</div>
          </div>
        </div>
      </div>
    </div>
  );
}

ReactDOM.render(<App/>, document.getElementById('root'))
</script>
  
<!-- Auto-resize iFrame naar ouder (WordPress) via postMessage -->
<script>
  (function () {
    function postH() {
      var h = Math.max(
        document.documentElement.scrollHeight,
        document.body.scrollHeight
      );
      // Stuur de hoogte in pixels naar de ouder (WP)
      try {
        window.parent.postMessage(
          { type: "warmteverlies-calculator-height", height: h },
          "*"
        );
      } catch (e) { /* ignore */ }
    }
    window.addEventListener("load", postH);
    window.addEventListener("resize", postH);
    var ro = new ResizeObserver(postH);
    ro.observe(document.body);
    setInterval(postH, 1500);
  })();
</script>
</body>
</html>
