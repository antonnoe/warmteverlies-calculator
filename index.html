<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warmteverlies Calculator Frankrijk - InfoFrankrijk.com</title>
    <meta name="description" content="Bereken het warmteverlies van je Franse woning. Inclusief klimaatzones, U-waarden en actuele energieprijzen 2024.">
    <meta name="author" content="Communities Abroad">
    
    <!-- React & Dependencies -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- PDF Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Styling -->
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
        }
        
        .text-brand-red { color: #800000 !important; }
        h1, h2, h3 { color: #800000 !important; }
        
        .calculator-wrapper {
            max-width: 80rem; /* 1280px */
            margin: 0 auto;
            padding: 1rem;
        }

        .calculator-layout {
            display: flex;
            flex-direction: row-reverse; /* Inputs rechts, resultaten links */
            align-items: flex-start;
            gap: 1.5rem;
        }

        .results-container {
            width: 340px;
            flex-shrink: 0;
            position: sticky;
            top: 1rem;
        }

        .inputs-container {
            flex-grow: 1;
            min-width: 0;
        }
        
        .mobile-fab-stack, .modal-overlay { display: none; }

        @media (max-width: 1024px) {
            .calculator-layout {
                flex-direction: column;
            }
            .results-container {
                display: none;
            }
            .mobile-fab-stack {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
                position: fixed;
                bottom: 1.5rem;
                right: 1.5rem;
                z-index: 1000;
                align-items: flex-end;
            }
            .fab-button {
                background-color: #800000;
                color: white;
                border-radius: 9999px;
                height: 3.5rem;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                cursor: pointer;
                transition: all 0.2s ease;
                width: 3.5rem; /* Standaard breedte voor icoon-knoppen */
            }
            .fab-button-costs {
                width: auto; /* Automatische breedte voor de kostenknop */
                padding: 0 1.25rem; /* Horizontale padding */
            }
            .fab-button:hover { transform: scale(1.05); }
        }
        
        .modal-overlay {
            position: fixed;
            inset: 0;
            z-index: 2000;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .modal-content {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .loading { display: flex; justify-content: center; align-items: center; height: 100vh; flex-direction: column; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #800000; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        input[type="number"] { -moz-appearance: textfield; }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p style="margin-top: 20px; color: #666;">Calculator wordt geladen...</p>
    </div>
    
    <div id="root"></div>
    
    <script>
        const ENERGY_API = {
            getFallbackPrices() {
                return { gas: 0.0847, electricity: 0.2516, fioul: 1.15, pellets: 0.35, source: 'CRE - Commission de r√©gulation de l\'√©nergie' };
            }
        };
        window.ENERGY_API = ENERGY_API;
    </script>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;
        
        // Icon Components
        const Calculator = () => <span>üßÆ</span>;
        const Home = () => <span>üè†</span>;
        const Thermometer = () => <span>üå°Ô∏è</span>;
        const Euro = () => <span>üí∞</span>;
        const TrendingDown = () => <span>üìâ</span>;
        const MapPin = () => <span>üìç</span>;
        const Sun = () => <span>‚òÄÔ∏è</span>;
        const Beach = () => <span>üèñÔ∏è</span>;
        const Fire = () => <span>üî•</span>;
        const Info = () => <span>‚ÑπÔ∏è</span>;
        const Edit = () => <span>‚úèÔ∏è</span>;
        const Chart = () => <span>üìä</span>;
        const Download = () => <span>üìÑ</span>;

        // Main App Component
        const WarmteverliesCalculator = () => {
            const [inputs, setInputs] = useState({
                muurOppervlakte: 100, raamOppervlakte: 20, dakOppervlakte: 80, vloerOppervlakte: 80,
                muurUwaarde: 1.8, raamUwaarde: 5.0, dakUwaarde: 2.5, vloerUwaarde: 0.8,
                binnenTemp: 20, klimaatzone: 'H2a', woningGebruik: 'volledig',
                verwarmdeRuimtes: 'heel_huis', ventilatieGedrag: 'normaal',
                hoofdverwarmingType: 'gas', bijverwarmingType: 'geen',
                bijverwarmingIntensiteit: 'incidenteel', zonnepanelenAantal: 0,
                zonnepanelenOrientatie: 'zuid', zonnepanelenHelling: 'optimaal'
            });

            const [results, setResults] = useState({});
            const [energyPrices, setEnergyPrices] = useState(ENERGY_API.getFallbackPrices());
            const [isCalculating, setIsCalculating] = useState(true);
            const [activeTab, setActiveTab] = useState('invoer');
            const [isCostsModalOpen, setIsCostsModalOpen] = useState(false);
            const [isBreakdownModalOpen, setIsBreakdownModalOpen] = useState(false);
            const [isGeneratingPdf, setIsGeneratingPdf] = useState(false);
            const breakdownRef = useRef(null);

            const klimaatzones = {
                'H1a': { naam: 'H1a - Noordoost (Reims, Metz)', factor: 1.2, gemTemp: -5, verwarmingsDagen: 200, zonOpbrengst: 1050 },
                'H1b': { naam: 'H1b - Noord/Centrum (Parijs, Lille)', factor: 1.1, gemTemp: -3, verwarmingsDagen: 185, zonOpbrengst: 1100 },
                'H1c': { naam: 'H1c - West (Brest, Caen)', factor: 1.0, gemTemp: 2, verwarmingsDagen: 175, zonOpbrengst: 1000 },
                'H2a': { naam: 'H2a - Midden-west (Poitiers, Tours)', factor: 0.9, gemTemp: 0, verwarmingsDagen: 170, zonOpbrengst: 1250 },
                'H2b': { naam: 'H2b - Midden-oost (Lyon, Dijon)', factor: 0.95, gemTemp: -2, verwarmingsDagen: 180, zonOpbrengst: 1200 },
                'H2c': { naam: 'H2c - Zuidwest (Bordeaux, Toulouse)', factor: 0.8, gemTemp: 3, verwarmingsDagen: 155, zonOpbrengst: 1350 },
                'H2d': { naam: 'H2d - Zuidoost (Avignon, Montpellier)', factor: 0.7, gemTemp: 4, verwarmingsDagen: 145, zonOpbrengst: 1450 },
                'H3': { naam: 'H3 - Mediterraan (Nice, Marseille)', factor: 0.6, gemTemp: 6, verwarmingsDagen: 120, zonOpbrengst: 1500 }
            };

            const uWaardePresets = {
                muur: {'Onge√Øsoleerd (voor 1975)': 2.0, 'Licht ge√Øsoleerd (~5cm)': 0.8, 'Goed ge√Øsoleerd (~10cm)': 0.4, 'Zeer goed (15cm+)': 0.25},
                raam: {'Enkel glas': 5.5, 'Standaard dubbel glas': 3.0, 'Dubbel glas (HR)': 1.8, 'Triple glas (HR++)': 1.0},
                dak: {'Onge√Øsoleerd': 3.0, 'Licht ge√Øsoleerd (~10cm)': 0.5, 'Goed ge√Øsoleerd (~20cm)': 0.25, 'Zeer goed (30cm+)': 0.15},
                vloer: {'Onge√Øsoleerd (op zand)': 2.2, 'Houten vloer (kruipruimte)': 1.2, 'Matig ge√Øsoleerd': 0.8, 'Goed ge√Øsoleerd (modern)': 0.3}
            };
            
            const woningGebruikOpties = {'volledig': { naam: 'Volledig jaar', factor: 1.0 },'secondaire_zomer': { naam: 'Zomer + tussenseizoen', factor: 0.3 },'secondaire_winter': { naam: 'Winter weekends', factor: 0.4 },'weekend': { naam: 'Alleen weekends', factor: 0.25 }};
            const zonOrientatieFactoren = {'zuid': 1.0,'zuidwest': 0.95,'zuidoost': 0.95,'oost': 0.85,'west': 0.85};
            const zonHellingFactoren = {'vlak': 0.85,'optimaal': 1.0,'steil': 0.9};

            useEffect(() => {
                const timer = setTimeout(() => { document.getElementById('loading').style.display = 'none'; }, 500);
                return () => clearTimeout(timer);
            }, []);

            const updateInput = (field, value) => setInputs(prev => ({ ...prev, [field]: value }));
            const setPreset = (type, preset) => updateInput(`${type}Uwaarde`, uWaardePresets[type][preset]);

            useEffect(() => {
                setIsCalculating(true);
                const handler = setTimeout(() => {
                    const safe = (val, def = 0) => parseFloat(val) || def;
                    const getBuitenTemp = () => klimaatzones[inputs.klimaatzone]?.gemTemp || 0;
                    
                    const safeInputs = {
                        muurOppervlakte: safe(inputs.muurOppervlakte), raamOppervlakte: safe(inputs.raamOppervlakte),
                        dakOppervlakte: safe(inputs.dakOppervlakte), vloerOppervlakte: safe(inputs.vloerOppervlakte),
                        muurUwaarde: safe(inputs.muurUwaarde), raamUwaarde: safe(inputs.raamUwaarde),
                        dakUwaarde: safe(inputs.dakUwaarde), vloerUwaarde: safe(inputs.vloerUwaarde),
                        binnenTemp: safe(inputs.binnenTemp, 20), zonnepanelenAantal: parseInt(inputs.zonnepanelenAantal, 10) || 0
                    };

                    const klimaatInfo = klimaatzones[inputs.klimaatzone];
                    const buitenTemp = getBuitenTemp();
                    const tempDiff = Math.abs(safeInputs.binnenTemp - buitenTemp);
                    
                    const muurVerlies = safeInputs.muurOppervlakte * safeInputs.muurUwaarde * tempDiff;
                    const raamVerlies = safeInputs.raamOppervlakte * safeInputs.raamUwaarde * tempDiff;
                    const dakVerlies = safeInputs.dakOppervlakte * safeInputs.dakUwaarde * tempDiff;
                    const vloerVerlies = safeInputs.vloerOppervlakte * safeInputs.vloerUwaarde * tempDiff;
                    const bruttoVerlies = muurVerlies + raamVerlies + dakVerlies + vloerVerlies;
                    
                    const gedragsFactorObject = {
                        verwarmdeRuimtes: inputs.verwarmdeRuimtes === 'leefruimtes' ? 0.7 : (inputs.verwarmdeRuimtes === 'minimaal' ? 0.5 : 1.0),
                        ventilatieGedrag: inputs.ventilatieGedrag === 'veel_ventileren' ? 1.2 : (inputs.ventilatieGedrag === 'ramen_open' ? 1.5 : 1.0)
                    };
                    const gedragsFactor = gedragsFactorObject.verwarmdeRuimtes * gedragsFactorObject.ventilatieGedrag;

                    const totaalVerlies = bruttoVerlies * klimaatInfo.factor * gedragsFactor;
                    const gebruiksFactor = woningGebruikOpties[inputs.woningGebruik]?.factor || 1.0;
                    const verwarmingsDagen = klimaatInfo.verwarmingsDagen * gebruiksFactor;
                    const jaarlijkseKwh = (totaalVerlies / 1000) * 12 * verwarmingsDagen;
                    
                    const hoofdverwarmingPercentages = { 'incidenteel': 0.9, 'regelmatig': 0.7, 'hoofdverwarming': 0.2 };
                    const hoofdverwarmingPercentage = inputs.bijverwarmingType !== 'geen' ? hoofdverwarmingPercentages[inputs.bijverwarmingIntensiteit] : 1.0;
                    
                    const hoofdverwarmingKwh = jaarlijkseKwh * hoofdverwarmingPercentage;
                    const bijverwarmingKwh = jaarlijkseKwh * (1 - hoofdverwarmingPercentage);
                    
                    const totaalZonOpbrengst = safeInputs.zonnepanelenAantal * klimaatInfo.zonOpbrengst * zonOrientatieFactoren[inputs.zonnepanelenOrientatie] * zonHellingFactoren[inputs.zonnepanelenHelling];
                    const zonBesparingKwh = totaalZonOpbrengst * 0.7;
                    
                    const kostenCalculaties = {
                        hoofd: { type: inputs.hoofdverwarmingType, kWh: hoofdverwarmingKwh },
                        bij: { type: inputs.bijverwarmingType, kWh: bijverwarmingKwh }
                    };

                    const berekenKosten = (type, kWh, zonKwh) => {
                        if (type === 'gas') return kWh * energyPrices.gas;
                        if (type === 'elektriciteit') return Math.max(0, kWh - zonKwh) * energyPrices.electricity;
                        if (type === 'fioul') return (kWh / 10) * energyPrices.fioul;
                        if (type === 'pellets') return (kWh / 4.8) * energyPrices.pellets;
                        if (type === 'hout') return kWh * 0.05;
                        return 0;
                    };

                    const hoofdverwarmingKosten = berekenKosten(kostenCalculaties.hoofd.type, kostenCalculaties.hoofd.kWh, zonBesparingKwh);
                    const resterendeZonKwh = Math.max(0, zonBesparingKwh - (kostenCalculaties.hoofd.type === 'elektriciteit' ? kostenCalculaties.hoofd.kWh : 0));
                    const bijverwarmingKosten = berekenKosten(kostenCalculaties.bij.type, kostenCalculaties.bij.kWh, resterendeZonKwh);
                    
                    setResults({
                        buitenTemp, tempDiff, klimaatInfo, gebruiksFactor, gedragsFactorObject,
                        hoofdverwarmingKwh, bijverwarmingKwh, hoofdverwarmingKosten, bijverwarmingKosten,
                        zonBesparingKwh,
                        muurVerlies, raamVerlies, dakVerlies, vloerVerlies, bruttoVerlies,
                        totaalVerlies, jaarlijkseKwh,
                        totaleJaarKosten: hoofdverwarmingKosten + bijverwarmingKosten,
                        zonBesparing: zonBesparingKwh * energyPrices.electricity,
                        percentages: {
                            muur: bruttoVerlies > 0 ? (muurVerlies / bruttoVerlies) * 100 : 0,
                            raam: bruttoVerlies > 0 ? (raamVerlies / bruttoVerlies) * 100 : 0,
                            dak: bruttoVerlies > 0 ? (dakVerlies / bruttoVerlies) * 100 : 0,
                            vloer: bruttoVerlies > 0 ? (vloerVerlies / bruttoVerlies) * 100 : 0
                        }
                    });
                    setIsCalculating(false);
                }, 400);

                return () => clearTimeout(handler);
            }, [inputs, energyPrices]);
            
            const handleGeneratePdf = () => {
                const { jsPDF } = window.jspdf;
                const input = breakdownRef.current;
                if (!input) return;

                setIsGeneratingPdf(true);
                html2canvas(input, { scale: 2 }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
                    pdf.addImage(imgData, 'PNG', 10, 10, pdfWidth - 20, pdfHeight - 20);
                    pdf.save('warmteverlies-rapport.pdf');
                    setIsGeneratingPdf(false);
                });
            };
            
            // Sub-components defined inside the main component
            const KostenOverzicht = ({ openBreakdown }) => (
                <div className="bg-white p-4 rounded-lg border shadow-lg space-y-3">
                    <h3 className="text-lg font-bold text-brand-red flex items-center justify-between">
                        <span><Euro /> Jaarlijkse Kosten</span>
                        <button onClick={openBreakdown} className="text-gray-400 hover:text-brand-red" title="Toon berekeningsoverzicht">
                            <Info />
                        </button>
                    </h3>
                    <div className="p-3 bg-indigo-50 rounded-lg border border-indigo-200 text-center">
                        <div className="flex justify-center items-center">
                            <span className="text-3xl md:text-4xl text-indigo-400 mr-2">‚Ç¨</span>
                            <span className="text-4xl md:text-5xl font-bold text-indigo-900 tracking-tight">
                                {isCalculating ? '...' : (results.totaleJaarKosten || 0).toFixed(0)}
                            </span>
                        </div>
                        <div className="text-xs text-gray-600 mt-1 truncate">
                            {inputs.hoofdverwarmingType}{inputs.bijverwarmingType !== 'geen' && ` + ${inputs.bijverwarmingType}`}
                        </div>
                    </div>
                    {inputs.zonnepanelenAantal > 0 && (
                        <div className="p-2 bg-yellow-100 rounded text-center text-sm">
                            <strong>Zonbesparing:</strong> <span className="font-bold text-green-700">‚Ç¨{(results.zonBesparing || 0).toFixed(0)}</span>/jaar
                        </div>
                    )}
                    <div className="p-2 bg-gray-50 rounded text-xs text-gray-700 space-y-1">
                        <div><strong>Totaal verlies:</strong> {(results.totaalVerlies / 1000 || 0).toFixed(1)} kW</div>
                        <div><strong>Jaarverbruik:</strong> {(results.jaarlijkseKwh || 0).toFixed(0)} kWh</div>
                    </div>
                </div>
            );

            const HeatLossChart = ({ results }) => {
                if (!results.bruttoVerlies) return <div className="bg-white p-6 rounded-lg border shadow-sm text-center text-gray-500">Voer data in voor de analyse.</div>;
                const data = [
                    { naam: 'Muren', verlies: results.muurVerlies, percentage: results.percentages.muur, kleur: '#ff6b35' },
                    { naam: 'Ramen', verlies: results.raamVerlies, percentage: results.percentages.raam, kleur: '#4ecdc4' },
                    { naam: 'Dak', verlies: results.dakVerlies, percentage: results.percentages.dak, kleur: '#45b7d1' },
                    { naam: 'Vloer', verlies: results.vloerVerlies, percentage: results.percentages.vloer, kleur: '#96ceb4' }
                ].sort((a, b) => b.verlies - a.verlies);
                const maxVerlies = Math.max(...data.map(d => d.verlies), 1);
                return (
                    <div className="bg-white p-6 rounded-lg border shadow-sm"><h3 className="text-xl font-bold mb-4 flex items-center gap-2"><TrendingDown /> Warmteverlies Verdeling</h3><div className="flex items-end justify-center gap-4" style={{ height: 220 }}>{data.map(item => (<div key={item.naam} className="flex flex-col items-center flex-grow w-1/4"><div className="text-sm font-semibold mb-2 text-gray-700">{item.percentage.toFixed(0)}%</div><div className="w-full rounded-t transition-all duration-500 flex items-center justify-center text-white text-xs font-bold p-1" style={{ height: `${Math.max((item.verlies / maxVerlies) * 180, 20)}px`, backgroundColor: item.kleur, minHeight: '20px' }}><span className="truncate">{item.verlies.toFixed(0)}W</span></div><div className="text-sm mt-2 text-center font-medium">{item.naam}</div></div>))}</div></div>
                );
            };
            
            const HouseVisualization = ({ results }) => {
                 if (!results.bruttoVerlies) return null;
                 const getColor = p => { if (p > 40) return '#ef4444'; if (p > 25) return '#f97316'; if (p > 15) return '#f59e0b'; return '#22c55e'; };
                 return (
                     <div className="bg-white p-6 rounded-lg border shadow-sm"><h3 className="text-xl font-bold mb-4 flex items-center gap-2"><Home/> Visueel Overzicht</h3><div className="flex justify-center"><svg width="300" height="250" viewBox="0 0 300 250" className="max-w-full"><polygon points="50,100 150,50 250,100" fill={getColor(results.percentages?.dak || 0)} stroke="#333" strokeWidth="2" /><text x="150" y="85" textAnchor="middle" className="text-sm font-bold fill-white">Dak</text><rect x="50" y="100" width="200" height="100" fill={getColor(results.percentages?.muur || 0)} stroke="#333" strokeWidth="2" /><text x="150" y="155" textAnchor="middle" className="text-sm font-bold fill-white">Muren</text><rect x="80" y="120" width="50" height="50" fill={getColor(results.percentages?.raam || 0)} stroke="#333" strokeWidth="2" /><rect x="170" y="120" width="50" height="50" fill={getColor(results.percentages?.raam || 0)} stroke="#333" strokeWidth="2" /><path d="M50 200 L250 200 L270 220 L30 220 Z" fill={getColor(results.percentages?.vloer || 0)} stroke="#333" strokeWidth="2" /><text x="150" y="240" textAnchor="middle" className="text-xs font-bold">Vloer & Ramen</text></svg></div></div>
                 );
            };

            const BronnenEnInfo = ({ energySource }) => (
                <div className="mt-8 p-6 bg-white rounded-lg border shadow-sm text-xs text-gray-600">
                    <h2 className="text-lg font-bold mb-3 flex items-center gap-2"><Info /> Bronnen & Calculatiegrondslagen</h2>
                    <div className="space-y-2">
                        <p><strong>Klimaatgegevens & Bouwnormen:</strong> De gebruikte klimaatzones, verwarmingsdagen en isolatiewaarden (U-waarden) zijn gebaseerd op de Franse thermische bouwregulaties (RT2012 & RT2020). Deze worden jaarlijks gevalideerd.</p>
                        <p><strong>Energieprijzen:</strong> De prijzen voor gas en elektriciteit zijn gebaseerd op data van de <a href="https://www.cre.fr" target="_blank" rel="noopener" className="text-blue-600 underline">{energySource}</a>. Deze data wordt wekelijks geactualiseerd. Prijzen voor stookolie en pellets zijn indicatieve marktgemiddelden.</p>
                        <p><strong>Disclaimer:</strong> Deze calculator is een model en geeft indicatieve schattingen. Werkelijke verbruiken kunnen afwijken door specifieke omstandigheden en persoonlijk gebruik. Voor een officieel advies en een DPE (Diagnostic de Performance √ânerg√©tique), raadpleeg een gecertificeerde Franse energieadviseur.</p>
                    </div>
                </div>
            );
            
            const CalculationBreakdownModal = ({ isOpen, onClose }) => {
                if (!isOpen || !results.klimaatInfo) return null;
                const f = (num) => (num || 0).toFixed(0);
                const f2 = (num) => (num || 0).toFixed(2);
                
                return (
                    <div className="modal-overlay" onClick={onClose}>
                        <div className="modal-content" onClick={e => e.stopPropagation()}>
                            <div ref={breakdownRef} className="p-4">
                                <h2 className="text-xl font-bold mb-4">Berekeningsoverzicht</h2>
                                <div className="text-sm space-y-4">
                                    <div><h3 className="font-semibold text-gray-800 border-b pb-1 mb-2">Stap 1: Bruto Warmteverlies</h3>
                                        <p>Het temperatuurverschil is <strong className="text-blue-600">{f2(results.tempDiff)}¬∞C</strong> ({f(inputs.binnenTemp)}¬∞C binnen - {f(results.buitenTemp)}¬∞C buiten in zone {inputs.klimaatzone}).</p>
                                        <ul className="list-disc list-inside mt-1 text-gray-600">
                                            <li>Muren: {f(inputs.muurOppervlakte)}m¬≤ * {f2(inputs.muurUwaarde)}U * {f2(results.tempDiff)}¬∞C = <strong>{f(results.muurVerlies)} W</strong></li>
                                            <li>Ramen: {f(inputs.raamOppervlakte)}m¬≤ * {f2(inputs.raamUwaarde)}U * {f2(results.tempDiff)}¬∞C = <strong>{f(results.raamVerlies)} W</strong></li>
                                            <li>Dak: {f(inputs.dakOppervlakte)}m¬≤ * {f2(inputs.dakUwaarde)}U * {f2(results.tempDiff)}¬∞C = <strong>{f(results.dakVerlies)} W</strong></li>
                                            <li>Vloer: {f(inputs.vloerOppervlakte)}m¬≤ * {f2(inputs.vloerUwaarde)}U * {f2(results.tempDiff)}¬∞C = <strong>{f(results.vloerVerlies)} W</strong></li>
                                        </ul>
                                        <p className="mt-1">Totaal Bruto Verlies: <strong className="text-blue-600">{f(results.bruttoVerlies)} W</strong></p>
                                    </div>
                                    <div><h3 className="font-semibold text-gray-800 border-b pb-1 mb-2">Stap 2: Jaarlijks Energieverbruik</h3>
                                        <p>Het bruto verlies wordt gecorrigeerd met factoren voor het klimaat en uw gedrag.</p>
                                        <ul className="list-disc list-inside mt-1 text-gray-600">
                                            <li>Klimaatfactor ({results.klimaatInfo.naam}): <strong>x{f2(results.klimaatInfo.factor)}</strong></li>
                                            <li>Gebruiksfactor ({woningGebruikOpties[inputs.woningGebruik].naam}): <strong>x{f2(results.gebruiksFactor)}</strong></li>
                                            <li>Gedragsfactor (verwarmde ruimtes & ventilatie): <strong>x{f2(results.gedragsFactorObject.verwarmdeRuimtes * results.gedragsFactorObject.ventilatieGedrag)}</strong></li>
                                        </ul>
                                        <p className="mt-1">Dit resulteert in een jaarverbruik van <strong className="text-blue-600">{f(results.jaarlijkseKwh)} kWh</strong>, gebaseerd op {f(results.klimaatInfo.verwarmingsDagen * results.gebruiksFactor)} verwarmingsdagen.</p>
                                    </div>
                                    <div><h3 className="font-semibold text-gray-800 border-b pb-1 mb-2">Stap 3: Jaarlijkse Kosten</h3>
                                         <p>Het verbruik wordt verdeeld over hoofd- en bijverwarming.</p>
                                         <ul className="list-disc list-inside mt-1 text-gray-600">
                                            <li>Hoofdverwarming ({inputs.hoofdverwarmingType}): {f(results.hoofdverwarmingKwh)} kWh = <strong>‚Ç¨{f(results.hoofdverwarmingKosten)}</strong></li>
                                            {inputs.bijverwarmingType !== 'geen' && <li>Bijverwarming ({inputs.bijverwarmingType}): {f(results.bijverwarmingKwh)} kWh = <strong>‚Ç¨{f(results.bijverwarmingKosten)}</strong></li>}
                                         </ul>
                                         {inputs.zonnepanelenAantal > 0 && <p className="mt-1 text-green-700">Hierop wordt een besparing van <strong>‚Ç¨{f(results.zonBesparing)}</strong> door zonnepanelen toegepast.</p>}
                                         <p className="mt-2 text-lg">Totaal Geschatte Jaarkosten: <strong className="text-brand-red">‚Ç¨{f(results.totaleJaarKosten)}</strong></p>
                                    </div>
                                    <div><h3 className="font-semibold text-gray-800 border-b pb-1 mb-2">Bronnen & Disclaimer</h3>
                                         <p className="text-xs text-gray-500">Prijzen o.b.v. {energyPrices.source}. Dit is een model; werkelijke kosten kunnen afwijken. Raadpleeg een expert voor een DPE.</p>
                                    </div>
                                </div>
                            </div>
                            <div className="flex items-center gap-4 mt-6">
                                <button onClick={handleGeneratePdf} disabled={isGeneratingPdf} className="flex-1 p-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 flex items-center justify-center gap-2">
                                    <Download/> {isGeneratingPdf ? 'Moment...' : 'Download als PDF'}
                                </button>
                                <button onClick={onClose} className="flex-1 p-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">Sluiten</button>
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="calculator-wrapper">
                    <div className="text-center mb-6 bg-white p-6 rounded-lg shadow-sm">
                        <h1 className="text-2xl md:text-3xl font-bold mb-2 flex items-center justify-center gap-3">
                            <Calculator /> Warmteverlies Calculator Frankrijk
                        </h1>
                        <p className="text-gray-600">Bereken het warmteverlies van je woning en ontdek waar je energie verliest.</p>
                        <div className="text-sm text-gray-600 mt-2">
                            Een initiatief van <a href="https://www.infofrankrijk.com" target="_blank" rel="noopener" className="text-blue-600 underline">InfoFrankrijk.com</a>, <a href="https://www.nederlanders.fr" target="_blank" rel="noopener" className="text-blue-600 underline">Nederlanders.fr</a> en <a href="https://www.nedergids.nl" target="_blank" rel="noopener" className="text-blue-600 underline">Nedergids.nl</a>
                        </div>
                    </div>
                    
                    <div className="calculator-layout">
                        <div className="results-container">
                            <KostenOverzicht openBreakdown={() => setIsBreakdownModalOpen(true)} />
                            <div className="mt-6"><HeatLossChart results={results}/></div>
                            <div className="mt-6"><HouseVisualization results={results} /></div>
                        </div>

                        <div className="inputs-container">
                             <div style={{display: activeTab === 'invoer' ? 'block' : 'none' }} className="space-y-6">
                                <div className="bg-white p-6 rounded-lg border shadow-sm"><h2 className="text-xl font-bold mb-4 flex items-center gap-2"><MapPin /> Locatie & Klimaat</h2><div className="grid md:grid-cols-2 gap-4"><div><label className="block text-sm font-medium mb-2 text-gray-700">Klimaatzone Frankrijk</label><select value={inputs.klimaatzone} onChange={(e) => updateInput('klimaatzone', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg"><option value="H1a">H1a - Noordoost (Reims, Metz)</option><option value="H1b">H1b - Noord/Centrum (Parijs, Lille)</option><option value="H1c">H1c - West (Brest, Caen)</option><option value="H2a">H2a - Midden-west (Poitiers, Tours)</option><option value="H2b">H2b - Midden-oost (Lyon, Dijon)</option><option value="H2c">H2c - Zuidwest (Bordeaux, Toulouse)</option><option value="H2d">H2d - Zuidoost (Avignon, Montpellier)</option><option value="H3">H3 - Mediterraan (Nice, Marseille)</option></select></div><div><label className="block text-sm font-medium mb-2 text-gray-700">Gewenste binnen temperatuur (¬∞C)</label><input type="number" value={inputs.binnenTemp} onChange={(e) => updateInput('binnenTemp', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg" min="15" max="25" step="0.5" /></div></div></div>
                                <div className="bg-white p-6 rounded-lg border shadow-sm"><h2 className="text-xl font-bold mb-4 flex items-center gap-2"><Beach /> Woninggebruik & Gedrag</h2><div className="grid md:grid-cols-2 gap-4"><div><label className="block text-sm font-medium mb-2 text-gray-700">Type woninggebruik</label><select value={inputs.woningGebruik} onChange={(e) => updateInput('woningGebruik', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg"><option value="volledig">Volledig jaar</option><option value="secondaire_zomer">Zomer + tussenseizoen</option><option value="secondaire_winter">Winter weekends</option><option value="weekend">Alleen weekends</option></select></div><div><label className="block text-sm font-medium mb-2 text-gray-700">Verwarmde ruimtes</label><select value={inputs.verwarmdeRuimtes} onChange={(e) => updateInput('verwarmdeRuimtes', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg"><option value="heel_huis">Heel huis</option><option value="leefruimtes">Alleen leefruimtes</option><option value="minimaal">Minimaal (1-2 kamers)</option></select></div><div className="md:col-span-2"><label className="block text-sm font-medium mb-2 text-gray-700">Ventilatie gedrag</label><select value={inputs.ventilatieGedrag} onChange={(e) => updateInput('ventilatieGedrag', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg"><option value="normaal">Normaal</option><option value="veel_ventileren">Veel ventileren</option><option value="ramen_open">Ramen vaak open</option></select></div></div></div>
                                <div className="bg-white p-6 rounded-lg border shadow-sm"><h2 className="text-xl font-bold mb-4 flex items-center gap-2"><Fire /> Verwarmingssysteem</h2><div className="grid md:grid-cols-2 gap-4"><div><label className="block text-sm font-medium mb-2">Hoofdverwarming</label><select value={inputs.hoofdverwarmingType} onChange={(e) => updateInput('hoofdverwarmingType', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg"><option value="gas">Gas</option><option value="elektriciteit">Elektriciteit</option><option value="fioul">Stookolie (fioul)</option></select></div><div><label className="block text-sm font-medium mb-2">Bijverwarming</label><select value={inputs.bijverwarmingType} onChange={(e) => updateInput('bijverwarmingType', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg"><option value="geen">Geen</option><option value="elektrisch">Elektrisch</option><option value="hout">Hout</option><option value="pellets">Pellets</option></select></div><div className="md:col-span-2"><label className="block text-sm font-medium mb-2">Gebruik bijverwarming</label><select value={inputs.bijverwarmingIntensiteit} onChange={(e) => updateInput('bijverwarmingIntensiteit', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg" disabled={inputs.bijverwarmingType === 'geen'}><option value="incidenteel">Incidenteel (~10%)</option><option value="regelmatig">Regelmatig (~30%)</option><option value="hoofdverwarming">Intensief (~80%)</option></select></div></div></div>
                                <div className="bg-white p-6 rounded-lg border shadow-sm"><h2 className="text-xl font-bold mb-4 flex items-center gap-2"><Sun /> Zonnepanelen (optioneel)</h2><div className="grid md:grid-cols-3 gap-4"><div><label className="block text-sm font-medium mb-2">Aantal</label><input type="number" value={inputs.zonnepanelenAantal} onChange={(e) => updateInput('zonnepanelenAantal', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg" min="0" max="50"/></div><div><label className="block text-sm font-medium mb-2">Ori√´ntatie</label><select value={inputs.zonnepanelenOrientatie} onChange={(e) => updateInput('zonnepanelenOrientatie', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg" disabled={!inputs.zonnepanelenAantal > 0}><option value="zuid">Zuid</option><option value="zuidwest">Zuidwest</option><option value="zuidoost">Zuidoost</option><option value="oost">Oost</option><option value="west">West</option></select></div><div><label className="block text-sm font-medium mb-2">Hellingshoek</label><select value={inputs.zonnepanelenHelling} onChange={(e) => updateInput('zonnepanelenHelling', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg" disabled={!inputs.zonnepanelenAantal > 0}><option value="optimaal">Optimaal (30-45¬∞)</option><option value="vlak">Vlak dak (0-15¬∞)</option><option value="steil">Steil dak (45¬∞+)</option></select></div></div></div>
                                <div className="bg-white p-6 rounded-lg border shadow-sm"><h2 className="text-xl font-bold mb-4 flex items-center gap-2"><Home /> Oppervlaktes & <Thermometer/> Isolatie (U-waarden)</h2><div className="grid grid-cols-1 md:grid-cols-2 gap-6"><div><label className="block text-sm font-medium mb-2">Muren</label><input type="number" value={inputs.muurOppervlakte} onChange={(e) => updateInput('muurOppervlakte', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg mb-2" placeholder="Oppervlakte (m¬≤)"/><div className="flex gap-1 mb-2 flex-wrap">{Object.keys(uWaardePresets.muur).map(p => <button key={p} onClick={() => setPreset('muur', p)} className="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded hover:bg-blue-200">{p}</button>)}</div><input type="number" step="0.1" value={inputs.muurUwaarde} onChange={(e) => updateInput('muurUwaarde', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg" placeholder="U-waarde"/></div><div><label className="block text-sm font-medium mb-2">Ramen</label><input type="number" value={inputs.raamOppervlakte} onChange={(e) => updateInput('raamOppervlakte', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg mb-2" placeholder="Oppervlakte (m¬≤)"/><div className="flex gap-1 mb-2 flex-wrap">{Object.keys(uWaardePresets.raam).map(p => <button key={p} onClick={() => setPreset('raam', p)} className="px-2 py-1 text-xs bg-green-100 text-green-800 rounded hover:bg-green-200">{p}</button>)}</div><input type="number" step="0.1" value={inputs.raamUwaarde} onChange={(e) => updateInput('raamUwaarde', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg" placeholder="U-waarde"/></div><div><label className="block text-sm font-medium mb-2">Dak</label><input type="number" value={inputs.dakOppervlakte} onChange={(e) => updateInput('dakOppervlakte', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg mb-2" placeholder="Oppervlakte (m¬≤)"/><div className="flex gap-1 mb-2 flex-wrap">{Object.keys(uWaardePresets.dak).map(p => <button key={p} onClick={() => setPreset('dak', p)} className="px-2 py-1 text-xs bg-purple-100 text-purple-800 rounded hover:bg-purple-200">{p}</button>)}</div><input type="number" step="0.1" value={inputs.dakUwaarde} onChange={(e) => updateInput('dakUwaarde', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg" placeholder="U-waarde"/></div><div><label className="block text-sm font-medium mb-2">Vloer</label><input type="number" value={inputs.vloerOppervlakte} onChange={(e) => updateInput('vloerOppervlakte', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg mb-2" placeholder="Oppervlakte (m¬≤)"/><div className="flex gap-1 mb-2 flex-wrap">{Object.keys(uWaardePresets.vloer).map(p => <button key={p} onClick={() => setPreset('vloer', p)} className="px-2 py-1 text-xs bg-yellow-100 text-yellow-800 rounded hover:bg-yellow-200">{p}</button>)}</div><input type="number" step="0.1" value={inputs.vloerUwaarde} onChange={(e) => updateInput('vloerUwaarde', e.target.value)} className="w-full p-3 border border-gray-300 rounded-lg" placeholder="U-waarde"/></div></div></div>
                             </div>
                            <div style={{display: activeTab === 'analyse' ? 'block' : 'none' }} className="space-y-6">
                                <HeatLossChart results={results}/>
                                <HouseVisualization results={results}/>
                            </div>
                        </div>
                    </div>
                    
                    <BronnenEnInfo energySource={energyPrices.source} />

                    <CalculationBreakdownModal 
                        isOpen={isBreakdownModalOpen} 
                        onClose={() => setIsBreakdownModalOpen(false)}
                    />

                    {isCostsModalOpen && (
                        <div className="modal-overlay" onClick={() => setIsCostsModalOpen(false)}>
                            <div className="w-full max-w-md" onClick={e => e.stopPropagation()}>
                                <KostenOverzicht openBreakdown={() => { setIsCostsModalOpen(false); setIsBreakdownModalOpen(true); }} />
                            </div>
                        </div>
                    )}

                    <div className="mobile-fab-stack">
                        <button onClick={() => setActiveTab('invoer')} className="fab-button" title="Invoer"><span className="text-2xl"><Edit/></span></button>
                        <button onClick={() => setActiveTab('analyse')} className="fab-button" title="Analyse"><span className="text-2xl"><Chart/></span></button>
                        <button onClick={() => setIsCostsModalOpen(true)} className="fab-button fab-button-costs" title="Kosten">
                            <div className="flex items-center font-semibold text-lg">
                                <span className="mr-2 text-xl">‚Ç¨</span>
                                <span>{isCalculating ? '...' : (results.totaleJaarKosten || 0).toFixed(0)}</span>
                            </div>
                        </button>
                    </div>
                </div>
            );
        };
        
        ReactDOM.render(<WarmteverliesCalculator />, document.getElementById('root'));
    </script>
</body>
</html>

